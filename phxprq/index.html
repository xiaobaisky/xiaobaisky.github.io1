<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>OpenCore 简体中文参考手册 | haisky的草堂</title><meta name="keywords" content="opencore"><meta name="author" content="haisky"><meta name="copyright" content="haisky"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="你现在访问的是由 非官方 维护的 OpenCore 参考手册的简体中文翻译（以下简称本网站）。">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenCore 简体中文参考手册">
<meta property="og:url" content="https://www.hai2020.cn/phxprq/index.html">
<meta property="og:site_name" content="haisky的草堂">
<meta property="og:description" content="你现在访问的是由 非官方 维护的 OpenCore 参考手册的简体中文翻译（以下简称本网站）。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/xiaobaisky/2020cdn@master/imgs/timg.gif">
<meta property="article:published_time" content="2020-05-28T20:49:01.000Z">
<meta property="article:modified_time" content="2021-03-15T06:24:02.363Z">
<meta property="article:author" content="haisky">
<meta property="article:tag" content="opencore">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/xiaobaisky/2020cdn@master/imgs/timg.gif"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/xiaobaisky/2020cdn/imgs/favicon.png"><link rel="canonical" href="https://www.hai2020.cn/phxprq/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="manifest" href="/manifest.json"/><meta name="msapplication-TileColor" content="#212121"/><link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png"/><link rel="mask-icon" href="/img/safari-pinned-tab.svg" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-03-15 06:24:02'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><link rel="stylesheet" href="/css/custom.css"  media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xiaobaisky/cdn@master/css/button.css"><style type="text/css">#toggle-sidebar {bottom: 80px}</style><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/l-lin/font-awesome-animation/dist/font-awesome-animation.min.css"  media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 5.2.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" data-lazy-src="https://cdn.jsdelivr.net/gh/xiaobaisky/cdn/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-file-alt"></i><span> 文章</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于博客</span></a></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw fas fa-hands-helping"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/fcircle/"><i class="fa-fw fa fa-puzzle-piece"></i><span> 友链朋友圈</span></a></div><div class="menus_item"><a class="site-page" href="/artitalk/"><i class="fa-fw fas fa-comment-alt"></i><span> 闲言碎语</span></a></div><div class="menus_item"><a class="site-page" href="/box/"><i class="fa-fw fas fa-box"></i><span> 快捷链接</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/xiaobaisky/cdn/image/OC.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">haisky的草堂</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-file-alt"></i><span> 文章</span><i class="fas fa-chevron-down expand hide"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于博客</span></a></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw fas fa-hands-helping"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/fcircle/"><i class="fa-fw fa fa-puzzle-piece"></i><span> 友链朋友圈</span></a></div><div class="menus_item"><a class="site-page" href="/artitalk/"><i class="fa-fw fas fa-comment-alt"></i><span> 闲言碎语</span></a></div><div class="menus_item"><a class="site-page" href="/box/"><i class="fa-fw fas fa-box"></i><span> 快捷链接</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">OpenCore 简体中文参考手册</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-05-28T20:49:01.000Z" title="发表于 2020-05-28 20:49:01">2020-05-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-03-15T06:24:02.363Z" title="更新于 2021-03-15 06:24:02">2021-03-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/mac/">mac</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/mac/opencore/">opencore</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">39.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>155分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>OpenCore 简体中文参考手册(非官方)</p>
<hr>
<h2 id="阅读须知">阅读须知</h2>
<p>你现在访问的是由 <strong>非官方</strong> 维护的 OpenCore 参考手册的简体中文翻译（以下简称本网站）。</p>
<p><strong>本网站以及网站的维护人员和 OpenCore 的开发团队 <code>acidanthera</code> 以及 OpenCore 的文档版权所有者 <code>vit9696</code> 没有任何关系</strong>。本网站对 OpenCore 的 Logo（商标）的使用已经过 <code>acidanthera</code> 的授权。</p>
<p>由于 OpenCore 仍处于积极的维护之中，OpenCore 参考手册 仍然在高频率更新，本网站提供的内容 <strong>仅可供参考</strong>。本网站的内容和 OpenCore 官方的参考手册的任何出入，<strong>请以 OpenCore 官方的参考手册为准</strong>。</p>
<blockquote>
<p>本网站提供的翻译基于如下描述的 OpenCore 官方文档：</p>
<ul>
<li><strong>OpenCore 文档释出日期</strong>：2020.05.23</li>
<li><strong>OpenCore 文档版本</strong>：<a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg/commit/bffded3a52f5ac57c2e855020d517b5e311a89c8"><code>bffded3a52f5ac57c2e855020d517b5e311a89c8</code></a></li>
</ul>
<p>本网站提供的翻译适用于如下描述的 OpenCore 版本：</p>
<ul>
<li><strong>OpenCore 版本</strong>：0.5.9</li>
</ul>
</blockquote>
<p>本网站以及 <code>acidanthera</code> <strong>不会对因本网站引起的任何损失负责</strong>，包括但不限于 Kernel Panic、设备无法开机或正常使用、硬盘损坏或数据丢失、原子弹爆炸、第三次世界大战、<a target="_blank" rel="noopener" href="https://scp-wiki-cn.wikidot.com/">SCP 基金会</a> 无法阻止的全球 CK 级现实重构等。</p>
<h2 id="有用的链接">有用的链接</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg/blob/master/Docs/Configuration.pdf">OpenCore 官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg/blob/master/Docs/Differences/Differences.pdf">OpenCore 官方文档迭代</a></li>
<li><a target="_blank" rel="noopener" href="https://khronokernel.github.io/Opencore-Vanilla-Desktop-Guide/">OpenCore Vanilla Guide</a> — 从零开始的 OpenCore 台式机安装指南。本网站由考虑提供对该指南的简体中文翻译</li>
<li><a target="_blank" rel="noopener" href="https://blog.daliansky.net/OpenCore-BootLoader.html">精解 OpenCore | 黑果小兵</a> — 本网站的部分翻译参考的就是黑果小兵的这篇文章</li>
<li><a target="_blank" rel="noopener" href="https://blog.xjn819.com/?p=543">使用 OpenCore 引导黑苹果 | Xjn’s Blog</a> — 提供了很多排错和完善的指南</li>
</ul>
<h2 id="维护者">维护者</h2>
<p><strong>OpenCore 简体中文参考手册</strong> © <a target="_blank" rel="noopener" href="https://github.com/SukkaW">Sukka</a>.</p>
<p>由 <a target="_blank" rel="noopener" href="https://github.com/SukkaW">Sukka</a> 和 <a target="_blank" rel="noopener" href="https://github.com/SukkaW/OpenCore-Document-zh_Hans/contributors">众多的贡献者</a> 一起维护。</p>
<h1>1. 简介</h1>
<hr>
<p>本文档提供关于 OpenCore 用户配置文件的信息，以使 macOS 操作系统正常工作。你应当视本文档为 OpenCore 预期行为的解释。如果在已经发布的 OpenCore 版本中找到与文档中的描述存在偏差的行为，应当视为 OpenCore 存在 Bug 或文档出现错误，应通过 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/bugtracker">Acidanthera Bugtracker</a> 进行反馈。</p>
<p>本文档仅作为规范结构、并非用于提供手把手的配置教程。本文档的目标受众是程序员、工程师、有对 macOS 内部和 UEFI 有足够了解的人。因此本文档只提供英文版本，<strong>任何通过其他来源分发的文档和文档翻译都是非官方的，并且可能存在错误。</strong></p>
<blockquote>
<p>译者注：</p>
<ol>
<li>此处以及之后的「本文档」都指代 OpenCore 的官方文档（而非你现在访问的网站）。</li>
<li>你应当使用英语在 Acidanthera Bugtracker 进行反馈。</li>
</ol>
</blockquote>
<p>对于大部分用户来说，第三方提供的教程、工具可能更易于使用、受众更广。但是这类材料（译者注：即由第三方提供的，如「手把手的配置教程」）都容易收到其作者的喜好和品位、对本文档的误解、过时的理解等。如果您正在使用这些资料来源，例如 <a target="_blank" rel="noopener" href="https://dortania.github.io/OpenCore-Desktop-Guide">OpenCore Desktop Guide</a>（及其 <a target="_blank" rel="noopener" href="https://dortania.github.io/getting-started">父页面</a>）或者「OpenCore 非官方简体中文翻译」，请务必在参考本文档后再作出每个决定、并判断其后果。</p>
<p>在通过 Acidanthera Bugtracker 反馈任何问题之前，请确保你彻底理解了 OpenCore 的每个配置选项及其对应的概念。</p>
<h2 id="1-1-通用术语">1.1 通用术语</h2>
<ul>
<li><code>plist</code> — 是一种用 XML 编写的、储存 ASCII 属性列表格式的集合文件，又称 XML 1.0 版。 统一类型标识符（UTI）： <code>com.apple.property-list</code>。 plist 由多个 <code>plist object</code> 组成，这些对象组合在一起形成一种具有层次的结构。 由于 plist 格式的定义不明确，因此本文中的所有定义只有在运行 <code>plutil -lint</code> 有效后才能被应用。外部参考： <a target="_blank" rel="noopener" href="https://www.apple.com/DTDs/PropertyList-1.0.dtd">https://www.apple.com/DTDs/PropertyList-1.0.dtd</a>, <code>man plutil</code>。</li>
<li><code>plist type</code> — 指 plist 集合（<code>plist array</code>, <code>plist dictionary</code>, <code>plist key</code>）和基本类型（<code>plist string</code>, <code>plist data</code>, <code>plist date</code>, <code>plist boolean</code>, <code>plist integer</code>,  <code>plist real</code>）。</li>
<li><code>plist object</code> — 是用来定义 <code>plist type</code> 的实现形式，可以理解为值。</li>
<li><code>plist array</code> — 类数组集合，参数为 <code>array</code>。包含零个或多个  <code>plist object</code>。</li>
<li><code>plist dictionary</code> — 类地图（关联数组）集合，参数为 <code>dict</code> 。包含零个或多个 <code>plist key</code>。</li>
<li><code>plist key</code> — 包含一个以 <code>plist key</code> 名称命名的 <code>plist object</code>，参数为 <code>key</code>。由 7 位 ASCII 集的可打印字符组成。</li>
<li><code>plist string</code> — 7 位 ASCII 集的可打印字符串，参数为 <code>string</code>。</li>
<li><code>plist data</code> — base64 编码的对象，参数为 <code>data</code>。</li>
<li><code>plist date</code> — ISO-8601 日期表示法，参数为 <code>date</code>，不支持。</li>
<li><code>plist boolean</code> — 逻辑声明对象，其值为 true (1) 或 false (0)，参数为 <code>true</code> 和 <code>false</code>。</li>
<li><code>plist integer</code> — 带符号的 10 进制，参数为 <code>integer</code>。适用于以二进制补码表示的 64 位无符号整数，除非在特定的 <code>plist object</code> 描述中明确提及一个更小的、有或无符号的整数类型。</li>
<li><code>plist real</code> — 浮点数，参数为 <code>real</code>，不支持。</li>
<li><code>plist metadata</code> — 实现将 value 强制转换为 data。 允许传递 <code>plist string</code>，此时的结果用空结果字节序列（即 C 字符串）表示；允许传递 <code>plist integer</code>，此时的结果用二进制补码形式的 32 位小尾数字节序列表示；允许传递 <code>plist boolean</code>， 此时的值为一个字节：<code>01</code> 表示 <code>true</code>，<code>00</code> 表示 <code>false</code>；允许传递 <code>plist data</code> 本身。其他类型或更大的整数会导致未定义、非预期的行为。</li>
</ul>
<h1>2. 配置</h1>
<hr>
<h2 id="2-1-配置术语">2.1 配置术语</h2>
<ul>
<li><code>OC config</code> — OpenCore 的配置文件，格式为 plist，文件名为 <code>config.plist</code>。OpenCore 的配置文件具有可扩展性，并被设计为具有多个命名空间的结构。每个命名空间下允许具有 plist array 或 plist dictionary，在本文档相应部分中对其进行了描述</li>
<li><code>valid key</code> — OC Config 中的 plist key object。除了明确描述的 valid key 以外，以 <code>#</code> 符号开头的值（如 <code>#Hello</code>）也将被视为 valid key，并被表示为注释。虽然表示为注释的值会被丢弃，但是它们仍然是 valid key。其他的 plist key 都是无效、不合法的，它们的存在可能会导致未定义、非预期的行为。</li>
<li><code>valid value</code> — 有效、合法的 <code>plist object</code>，并能匹配一些特定的 <code>plist object</code> 描述中所有附加条件（若有）。</li>
<li><code>invalid value</code> — 指 <code>plist object</code> 本身是有效、合法的，但属于其他 <code>plist type</code>、与特定 <code>plist object</code> 描述中附加条件不符（例如 value range）或者在对应集合中缺如。<code>invalid value</code> 会被不确定的方式读取为这个 <code>plist obejct</code> 的任何可能值（即，重启前后的值可能会不同），可能报错也可能不报错。尽管读取 <code>invalid value</code> 相当于读取某些已定义的 <code>valid value</code>，但是将不兼容的值应用于主机系统可能会产生未定义、非预期的行为。</li>
<li><code>optional value</code> — 可缺少，或以特定 <code>plist object</code> 描述提供的特定方式（区别于 <code>invalid value</code>）读取的有效值。而其他情况下（译者注：未提供读取方式）的 <code>invalid value</code> 仍然会被应用。value 除非被明确标记为 <code>optional value</code>，否则必须存在，如果缺少则会被读取为 <code>invalid value</code>。</li>
<li><code>fatal behaviour</code> — 导致引导终止的行为。对 <code>fatal behaviour</code> 的实现，要求必须停止引导过程，直到下一次主机系统引导为止。允许，但不强制要求执行冷重启或显示任何警告消息。</li>
<li><code>undefined behaviour</code> — 本文档中未定义的行为，通常是因为某一选项的特定配置、或某些值被忽略导致的。在这种情况下，其实现可能会采取包括 <code>fatal behaviour</code>，而这些行为一般都会对系统安全性产生负面影响。</li>
</ul>
<blockquote>
<p>译者注：以上术语的相关描述仅限于本文档所指的 OC Config。</p>
</blockquote>
<h2 id="2-2-配置处理">2.2 配置处理</h2>
<p>如果 OpenCore 发现了 OC Config，则至少会读取并处理一次。根据 OpenCore 的引导机制的不同，如果存在多个 OC Config 文件，OpenCore 可能会读取其中任何一个或数个。如果硬盘中没有 OC Config，OpenCore 将会使用可选值和无效值的规则。</p>
<p>OC Config 有大小、嵌套和键值数量的限制。OC Config 的大小不得超过 16 MB，嵌套层数不得超过 8 层，每个 plist object 中最多有 16384 个节点（一个 plist dictionary 将被计为一对节点）。不符合上述规则的 OC Config 文件将可能导致未定义、非预期的行为。常见的 OC Config 错误格式包括：</p>
<ul>
<li>不符合 plist DTD</li>
<li>存在本文档中没有记载的 plist object</li>
<li>违反文件大小、嵌套层级和键值数量的限制</li>
</ul>
<p>我们建议（但非强制）遇到格式错误的 OC Config 时不停止加载、然后继续进行就好像 OC Config 不存在一样。为了是先前向兼容性，建议（但非强制）要求实现对采用无效值的行为进行警告。采用无效值的建议做法是在使用的情况下遵守以下规则：</p>
<table>
<thead>
<tr>
<th style="text-align:left">Type</th>
<th style="text-align:left">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">plist string</td>
<td style="text-align:left">Empty string (<code>&lt;string&gt;&lt;/string&gt;</code>)</td>
</tr>
<tr>
<td style="text-align:left">plist data</td>
<td style="text-align:left">Empty data (<code>&lt;data&gt;&lt;/data&gt;</code>)</td>
</tr>
<tr>
<td style="text-align:left">plist integer</td>
<td style="text-align:left">0 (<code>&lt;integer&gt;0&lt;/integer&gt;</code>)</td>
</tr>
<tr>
<td style="text-align:left">plist boolean</td>
<td style="text-align:left">False (<code>&lt;false/&gt;</code>)</td>
</tr>
<tr>
<td style="text-align:left">plist tristate</td>
<td style="text-align:left">False (<code>&lt;false/&gt;</code>)</td>
</tr>
</tbody>
</table>
<h2 id="2-3-配置结构">2.3 配置结构</h2>
<p>OC Config 包括以下几个独立部分，将在本文档中分别进行介绍。默认情况下配置文件将尽可能不启用任何功能以及禁用某些功能。总的来说，这些配置一般由如下的操作构成：</p>
<ul>
<li>Add：为数据提供 添加 操作支持。已经存在的值不会被覆盖，必要时请使用 Delete。</li>
<li>Delete：为数据提供 删除 操作支持</li>
<li>Patch：为数据提供 补丁 操作支持</li>
<li>Quirks：提供特定的黑科技支持</li>
</ul>
<p>配置文件分为以下几个独立部分：</p>
<ul>
<li>ACPI</li>
<li>Booter</li>
<li>DeviceProperties</li>
<li>Kernel</li>
<li>Misc</li>
<li>NVRAM</li>
<li>PlatformInfo</li>
<li>UEFI</li>
</ul>
<blockquote>
<p>译者注：对上述部分的介绍位于文档的第 4 至 11 章节。可以在本网站左侧边栏中的目录中找到这些章节的入口。</p>
</blockquote>
<p><strong>注意</strong>：为了保险起见，目前大多数属性都有默认值（译者注：后续文档中以 <code>FailSafe</code> 字段呈现）。如果在配置项中未指定任何值，默认值将会生效。不要依赖默认值，务必在配置中正确指定所有字段。</p>
<h1>3. 目录讲解</h1>
<hr>
<h2 id="3-1-目录结构">3.1 目录结构</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">ESP</span><br><span class="line">├── EFI</span><br><span class="line">│    │</span><br><span class="line">│    ├── BOOT</span><br><span class="line">│    │    └── BOOTx64.efi</span><br><span class="line">│    └── OC</span><br><span class="line">│        ├── ACPI</span><br><span class="line">│        │    ├── DSDT.aml</span><br><span class="line">│        │    ├── SSDT-1.aml</span><br><span class="line">│        │    └── MYTABLE.aml</span><br><span class="line">│        ├── Drivers</span><br><span class="line">│        │    ├── MyDriver.efi</span><br><span class="line">│        │    └── OtherDriver.efi</span><br><span class="line">│        ├── Kexts</span><br><span class="line">│        │    ├── MyKext.kext</span><br><span class="line">│        │    └── OtherKext.kext</span><br><span class="line">│        ├── Resources</span><br><span class="line">│        │    └── Audio</span><br><span class="line">│        ├── Tools</span><br><span class="line">│        │    └── Tool.efi</span><br><span class="line">│        ├── OpenCore.efi</span><br><span class="line">│        ├── vault.plist</span><br><span class="line">│        ├── config.plist</span><br><span class="line">│        └── vault.sig</span><br><span class="line">├── nvram.plist</span><br><span class="line">└── opencore-YYYY-MM-DD-HHMMSS.txt</span><br><span class="line"></span><br><span class="line"># Figure 1. 目录结构</span><br></pre></td></tr></table></figure>
<p>使用目录引导时，使用的目录结构应该遵循上述目录结构。可用的条目有：</p>
<ul>
<li><strong>BOOTx64.efi</strong> 和 <strong>Bootstrap.efi</strong> - 初始引导程序。除非 <code>OpenCore.efi</code> 已作为驱动程序启动，否则将用于加载 <code>OpenCore.efi</code>。对于大部分固件来说，<code>BOOTx64.efi</code> 是 UEFI 默认启动项，而 <code>Bootstrap.efi</code> 可以被注册为自定义启动项，避免 <code>BOOTx64.efi</code> 被其它操作系统所覆盖。</li>
<li><strong>boot</strong> - Duet bootstrap loader，用于在传统 BIOS 固件上模拟 UEFI 环境、并加载 <code>OpenCore.efi</code>。</li>
<li><strong>ACPI</strong> - 用于存储 ACPI 补充信息的目录。</li>
<li><strong>Drivers</strong> - 用于存储 UEFI 补充驱动程序的目录。</li>
<li><strong>Kexts</strong> - 用于存储内核驱动（kext）补充的目录。</li>
<li><strong>Tools</strong> - 用于存储补充工具的目录。</li>
<li><strong>OpenCore.efi</strong> - 主引导驱动程序，负责操作系统加载。</li>
<li><strong>vault.plist</strong> - OC Config 可能加载的所有文件的哈希。</li>
<li><strong>config.plist</strong> - OC Config（即 OpenCore 的配置文件，见「配置术语」）。这一目录同时也用于存放 GUI 界面所使用的图片，见 <code>OpenCanopy</code> 相关章节。</li>
<li><strong>vault.sig</strong> - vault.plist 的签名文件。</li>
<li><strong>nvram.plist</strong> - OpenCore 变量导入文件。</li>
<li><strong>Resources</strong> - 媒体资源使用的目录，如 屏幕朗读 的语音文件（见「UEFI Audio 属性」章节）。</li>
<li><strong>opencore-YYYY-MM-DD-HHMMSS.txt</strong> - OpenCore 日志文件。</li>
<li><strong>panic-YYYY-MM-DD-HHMMSS.txt</strong> - Kernal Panic 日志文件。</li>
</ul>
<p><em>注</em>: 受限于固件的实现行为，OpenCore 可能无法访问绝对路径长度大于 <code>OC_STORAGE_SAFE_PATH_MAX</code>（默认值为 128）的目录。</p>
<h2 id="3-2-安装和升级">3.2 安装和升级</h2>
<p>如果要安装 OpenCore，请在使用 GPT 格式的硬盘上、按照上一节的文件夹结构建立文件和文件夹。尽管本文档的相应部分的确提供了有关你所需的外部资源（如 ACPI 表、UEFI 驱动程序或 kexts）的某些信息，但是本文档不保证会提供关于这些外部资源的全部信息。关于 kext 的完整信息可以查看由 OpenCore 提供的 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg/blob/master/Docs/Kexts.md">可选 kext 列表</a>；而本文档也在安全属性的相关章节提供了 Vauting 的相关信息。</p>
<p>OpenCore 的配置文件可以使用任何常规的文本编辑器（如 nano、vim、VSCode）进行编辑，但是专用软件可以带来更好的体验。在 macOS 上我们推荐使用 <a target="_blank" rel="noopener" href="https://developer.apple.com/xcode">Xcode</a>。你也可以使用 <a target="_blank" rel="noopener" href="https://github.com/corpnewt/ProperTree">ProperTree</a> ，这是一个轻量级的跨平台的开源 plist 编辑器。</p>
<p>如果要通过 BIOS 进行开机，你必须使用第三方 UEFI 环境提供程序。<code>OpenDuetPkg</code> 是一个常用的为旧操作系统提供 Legacy 引导的 UEFI 环境提供程序。要在这样的旧操作系统上运行 OpenCore，你可以使用一个独立的工具 <code>BootInstall</code> 安装 <code>OpenDuetPkg</code>（目前已和 OpenCore 打包在一起发布）。</p>
<p>如果要升级 OpenCore，<a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg/blob/master/Docs/Differences/Differences.pdf"><code>Differences.pdf</code></a> 提供了 OpenCore 配置文件变更的相关信息，<a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg/blob/master/Changelog.md"><code>Changelog.md</code></a> 提供了 OpenCore 的更新日志。</p>
<blockquote>
<p>译者注：以下两节是为准备参与 OpenCore 开发的人员准备的。</p>
</blockquote>
<h2 id="3-3-贡献代码">3.3 贡献代码</h2>
<p>OpenCore can be compiled as an ordinary <a target="_blank" rel="noopener" href="https://github.com/tianocore/tianocore.github.io/wiki/EDK-II">EDK II</a>. Since <a target="_blank" rel="noopener" href="https://github.com/tianocore/tianocore.github.io/wiki/UDK">UDK</a> development was abandoned by TianoCore, OpenCore requires the use of <a target="_blank" rel="noopener" href="https://github.com/tianocore/tianocore.github.io/wiki/EDK-II#stable-tags">EDK II Stable</a>. Currently supported EDK II release is hosted in <a target="_blank" rel="noopener" href="https://github.com/acidanthera/audk">acidanthera/audk</a>. The required patches for the package are present in <code>Patches</code> directory.</p>
<p>The only officially supported toolchain is <code>XCODE5</code>. Other toolchains might work, but are neither supported, nor recommended. Contribution of clean patches is welcome. Please do follow <a target="_blank" rel="noopener" href="https://github.com/tianocore/tianocore.github.io/wiki/Code-Style-C">EDK II C Codestyle</a>.</p>
<p>To compile with <code>XCODE5</code>, besides <a target="_blank" rel="noopener" href="https://developer.apple.com/xcode">Xcode</a>, one should also install <a target="_blank" rel="noopener" href="https://www.nasm.us">NASM</a> and <a target="_blank" rel="noopener" href="https://github.com/acidanthera/ocbuild/tree/master/external">MTOC</a>. The latest Xcode version is recommended for use despite the toolchain name. Example<br>
command sequence may look as follows:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/acidanthera/audk UDK</span><br><span class="line"><span class="built_in">cd</span> UDK</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/acidanthera/DuetPkg</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/acidanthera/OpenCorePkg</span><br><span class="line"><span class="built_in">source</span> edksetup.sh</span><br><span class="line">make -C BaseTools</span><br><span class="line">build -a X64 -b RELEASE -t XCODE5 -p OpenCorePkg/OpenCorePkg.dsc</span><br></pre></td></tr></table></figure>
<p>For IDE usage Xcode projects are available in the root of the repositories. Another approach could be <a target="_blank" rel="noopener" href="https://www.sublimetext.com">Sublime Text</a> with <a target="_blank" rel="noopener" href="https://niosus.github.io/EasyClangComplete">EasyClangComplete</a> plugin. Add <code>.clang_complete</code> file with similar content to your UDK root:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">-I&#x2F;UefiPackages&#x2F;MdePkg</span><br><span class="line">-I&#x2F;UefiPackages&#x2F;MdePkg&#x2F;Include</span><br><span class="line">-I&#x2F;UefiPackages&#x2F;MdePkg&#x2F;Include&#x2F;X64</span><br><span class="line">-I&#x2F;UefiPackages&#x2F;OpenCorePkg&#x2F;Include&#x2F;AMI</span><br><span class="line">-I&#x2F;UefiPackages&#x2F;OpenCorePkg&#x2F;Include&#x2F;Acidanthera</span><br><span class="line">-I&#x2F;UefiPackages&#x2F;OpenCorePkg&#x2F;Include&#x2F;Apple</span><br><span class="line">-I&#x2F;UefiPackages&#x2F;OpenCorePkg&#x2F;Include&#x2F;Apple&#x2F;X64</span><br><span class="line">-I&#x2F;UefiPackages&#x2F;OpenCorePkg&#x2F;Include&#x2F;Duet</span><br><span class="line">-I&#x2F;UefiPackages&#x2F;OpenCorePkg&#x2F;Include&#x2F;Generic</span><br><span class="line">-I&#x2F;UefiPackages&#x2F;OpenCorePkg&#x2F;Include&#x2F;Intel</span><br><span class="line">-I&#x2F;UefiPackages&#x2F;OpenCorePkg&#x2F;Include&#x2F;Microsoft</span><br><span class="line">-I&#x2F;UefiPackages&#x2F;OpenCorePkg&#x2F;Include&#x2F;VMware</span><br><span class="line">-I&#x2F;UefiPackages&#x2F;OvmfPkg&#x2F;Include</span><br><span class="line">-I&#x2F;UefiPackages&#x2F;UefiCpuPkg&#x2F;Include</span><br><span class="line">-IInclude</span><br><span class="line">-include</span><br><span class="line">&#x2F;UefiPackages&#x2F;MdePkg&#x2F;Include&#x2F;Uefi.h</span><br><span class="line">-fshort-wchar</span><br><span class="line">-Wall</span><br><span class="line">-Wextra</span><br><span class="line">-Wno-unused-parameter</span><br><span class="line">-Wno-missing-braces</span><br><span class="line">-Wno-missing-field-initializers</span><br><span class="line">-Wno-tautological-compare</span><br><span class="line">-Wno-sign-compare</span><br><span class="line">-Wno-varargs</span><br><span class="line">-Wno-unused-const-variable</span><br><span class="line">-DOC_TARGET_NOOPT&#x3D;1</span><br><span class="line">-DNO_MSABI_VA_FUNCS&#x3D;1</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>Warning:</strong> Tool developers modifying <code>config.plist</code> or any other OpenCore files must ensure that their tool checks for <code>opencore-version</code> NVRAM variable (see <code>Debug Properties</code> section below) and warn the user if the version listed is unsupported or prerelease. OpenCore configuration may change across the releases and the tool shall ensure that it carefully follows this document. Failure to do so may result in this tool to be considered as malware and blocked with all possible means.</p>
</blockquote>
<h2 id="3-4-代码约定">3.4 代码约定</h2>
<p>Just like any other project we have conventions that we follow during the development. All third-party contributors are highly recommended to read and follow the conventions listed below before submitting their patches. In general it is also recommended to firstly discuss the issue in <a target="_blank" rel="noopener" href="https://github.com/acidanthera/bugtracker">Acidanthera Bugtracker</a> before sending the patch to ensure no double work and to avoid your patch being rejected.</p>
<p><strong>Organisation</strong>. The codebase is contained in <code>OpenCorePkg</code> repo. which is the primary EDK II package.</p>
<ul>
<li>Whenever changes are required in multiple repositories, separate pull requests should be sent to each.</li>
<li>Committing the changes should happen firstly to dependent repositories, secondly to primary repositories to avoid automatic build errors.</li>
<li>Each unique commit should compile with <code>XCODE5</code> and preferably with other toolchains. In the majority of the cases it can be checked by accessing the <a target="_blank" rel="noopener" href="https://travis-ci.com/acidanthera">CI interface</a>. Ensuring that static analysis finds no warnings is preferred.</li>
<li>External pull requests and tagged commits must be validated. That said, commits in master may build but may not necessarily work.</li>
<li>Internal branches should be named as follows: <code>author-name-date</code>, e.g. <code>vit9696-ballooning-20191026</code>.</li>
<li>Commit messages should be prefixed with the primary module (e.g. library or code module) the changes were made in. For example, <code>OcGuardLib: Add OC_ALIGNED macro</code>. For non-library changes <code>Docs</code> or <code>Build</code> prefixes are used.</li>
</ul>
<p><strong>Design</strong>. The codebase is written in a subset of freestanding C11 (C17) supported by most modern toolchains used by EDK II. Applying common software development practices or requesting clarification is recommended if any particular case is not discussed below.</p>
<ul>
<li>Never rely on undefined behaviour and try to avoid implementation defined behaviour unless explicitly covered below (feel free to create an issue when a relevant case is not present).</li>
<li>Use <code>OcGuardLib</code> to ensure safe integral arithmetics avoiding overflows. Unsigned wraparound should be relied on with care and reduced to the necessary amount.</li>
<li>Check pointers for correct alignment with <code>OcGuardLib</code> and do not rely on the architecture being able to dereference unaligned pointers.</li>
<li>Use flexible array members instead of zero-length or one-length arrays where necessary.</li>
<li>Use static assertions (<code>STATIC_ASSERT</code>) for type and value assumptions, and runtime assertions (<code>ASSERT</code>) for precondition and invariant sanity checking. Do not use runtime assertions to check for errors as they should never alter control flow and potentially be excluded.</li>
<li>Assume <code>UINT32</code>/<code>INT32</code> to be <code>int</code>-sized and use <code>%u</code>, <code>%d</code>, and <code>%x</code> to print them.</li>
<li>Assume <code>UINTN</code>/<code>INTN</code> to be of unspecified size, and cast them to <code>UINT64</code>/<code>INT64</code> for printing with <code>%Lu</code>, <code>%Ld</code> and so on as normal.</li>
<li>Do not rely on integer promotions for numeric literals. Use explicit casts when the type is<br>
implementation-dependent or suffixes when type size is known. Assume <code>U</code> for <code>UINT32</code> and <code>ULL</code> for <code>UINT64</code>.</li>
<li>Do ensure unsigned arithmetics especially in bitwise maths, shifts in particular.</li>
<li><code>sizeof</code> operator should take variables instead of types where possible to be error prone. Use <code>ARRAY_SIZE</code> to obtain array size in elements. Use <code>L_STR_LEN</code> and <code>L_STR_SIZE</code> macros from <code>OcStringLib</code> to obtain string literal sizes to ensure compiler optimisation.</li>
<li>Do not use <code>goto</code> keyword. Prefer early <code>return</code>, <code>break</code>, or <code>continue</code> after failing to pass error checking instead of nesting conditionals.</li>
<li>Use <code>EFIAPI</code>, force UEFI calling convention, only in protocols, external callbacks between modules, and functions with variadic arguments.</li>
<li>Provide inline documentation to every added function, at least describing its inputs, outputs, precondition, postcondition, and giving a brief description.</li>
<li>Do not use <code>RETURN_STATUS</code>. Assume <code>EFI_STATUS</code> to be a matching superset that is to be always used when <code>BOOLEAN</code> is not enough.</li>
<li>Security violations should halt the system or cause a forced reboot.</li>
</ul>
<p><strong>Codestyle</strong>. The codebase follows<br>
<a target="_blank" rel="noopener" href="https://github.com/tianocore/tianocore.github.io/wiki/Code-Style-C">EDK II codestyle</a> with few changes<br>
and clarifications.</p>
<ul>
<li>Write inline documentation for the functions and variables only once: in headers, where a header prototype is available, and inline for <code>static</code> variables and functions.</li>
<li>Use line length of 120 characters or less, preferably 100 characters.</li>
<li>Use spaces after casts, e.g. <code>(VOID *)(UINTN) Variable</code>.</li>
<li>Use SPDX license headers as shown in <a target="_blank" rel="noopener" href="https://github.com/acidanthera/bugtracker/issues/483">acidanthera/bugtracker#483</a>.</li>
</ul>
<p><strong>Debugging</strong>. The codebase incorporates EDK II debugging and few custom features to improve the experience.</p>
<ul>
<li>Use module prefixes, 2-5 letters followed by a colon (<code>:</code>), for debug messages. For <code>OpenCorePkg</code> use <code>OC:</code>, for libraries and drivers use their own unique prefixes.</li>
<li>Do not use dots (<code>.</code>) in the end of debug messages and separate <code>EFI_STATUS</code>, printed by <code>%r</code>, with a hyphen (e.g. <code>OCRAM: Allocation of %u bytes failed - **%rtextbackslash n</code>).**</li>
<li>Use <code>DEBUG_CODE_BEGIN ()</code> and <code>DEBUG_CODE_END ()</code> constructions to guard debug checks that may potentially reduce the performance of release builds and are otherwise unnecessary.</li>
<li>Use <code>DEBUG</code> macro to print debug messages during normal functioning, and <code>RUNTIME_DEBUG</code> for debugging after <code>EXIT_BOOT_SERVICES</code>.</li>
<li>Use <code>DEBUG_VERBOSE</code> debug level to leave debug messages for future debugging of the code, which are currently not necessary. By default <code>DEBUG_VERBOSE</code> messages are ignored even in <code>DEBUG</code> builds.</li>
<li>Use <code>DEBUG_INFO</code> debug level for all non critical messages (including errors) and <code>DEBUG_BULK_INFO</code> for extensive messages that should not appear in NVRAM log that is heavily limited in size. These messages are ignored in <code>RELEASE</code> builds.</li>
<li>Use <code>DEBUG_ERROR</code> to print critical human visible messages that may potentially halt the boot process, and <code>DEBUG_WARN</code> for all other human visible errors, <code>RELEASE</code> builds included.</li>
</ul>
<p>When trying to find the problematic change it is useful to rely on <a target="_blank" rel="noopener" href="https://git-scm.com/docs/git-bisect"><code>git-bisect</code></a> functionality.</p>
<h1>4. ACPI</h1>
<hr>
<h2 id="4-1-简介">4.1 简介</h2>
<p>ACPI（Advanced Configuration and Power Interface，高级配置和电源接口）是发现和配置计算机硬件的开放标准。<br>
<a target="_blank" rel="noopener" href="https://uefi.org/specifications">ACPI 规格</a> 定义了实现用的标准表（如 <code>DSDT</code>、<code>SSDT</code>、<code>FACS</code>、<code>DMAR</code>）和各种方法（如 <code>_DSM</code> 和 `_PRW）。现代硬件几乎不需要更改即可保持 ACPI 兼容性，但是 OpenCore 仍然提供了修改 ACPI 的方法。</p>
<p>要反汇编和编译 ACPI 表，可以使用由 <a target="_blank" rel="noopener" href="https://www.acpica.org">ACPICA</a> 开发的 <a target="_blank" rel="noopener" href="https://github.com/acpica/acpica">iASL compiler</a>。你可以从 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/MaciASL/releases">Acidanthera/MaciASL</a> 下载 iASL 的图形界面程序。</p>
<p>对 ACPI 的修补按照如下顺序执行：</p>
<ul>
<li>Patch</li>
<li>Delete</li>
<li>Add</li>
<li>Quirks</li>
</ul>
<p>为了解决操作系统检测的问题，所有对 ACPI 的更改会在所有操作系统上生效。但是在某些场景下（ACPI 编写不规范、操作系统链式引导启动、ACPI 调试）会出现问题。因此在修补 ACPI 时，需要使用 <code>\_OSI</code> 方法。</p>
<p>在系统引导前加载补丁使得编写「代理」补丁成为可能 —— 「代理」补丁即通过重命名的方法修补 DSDT 中的原始行为，然后通过 SSDT 注入同名的行为进行替代。</p>
<h2 id="4-2-属性列表">4.2 属性列表</h2>
<h3 id="4-2-1-Add">4.2.1 <code>Add</code></h3>
<p><strong>Type</strong>: <code>plist array</code><br>
<strong>Failsafe</strong>: Empty<br>
<strong>Description</strong>: 从 <code>OC/ACPI</code> 目录加载指定的 ACPI 表。</p>
<p>设计为用 <code>plist dict</code> 值填充以描述每个块级项目。请参阅下面 <a href="#4-3-Add-%E5%B1%9E%E6%80%A7">4.3 Add 属性</a> 章节。</p>
<h3 id="4-2-2-Delete">4.2.2 <code>Delete</code></h3>
<p><strong>Type</strong>: <code>plist array</code><br>
<strong>Failsafe</strong>: Empty<br>
<strong>Description</strong>: 从 ACPI 栈中删除选定的表。</p>
<p>设计为用 <code>plist dict</code> 值填充以描述每个块级项目。请参阅下面 <a href="#4-4-Delete-%E5%B1%9E%E6%80%A7">4.4 Delete 属性</a> 章节。</p>
<h3 id="4-2-3-Patch">4.2.3 <code>Patch</code></h3>
<p><strong>Type</strong>: <code>plist array</code><br>
<strong>Failsafe</strong>: Empty<br>
<strong>Description</strong>: 在添加或删除 ACPI 表之前执行的二进制修补。</p>
<p>设计为用 <code>plist dictionary</code> 值填充以描述每个块级项目。请参阅下面 <a href="#4-5-Patch-%E5%B1%9E%E6%80%A7">4.5 Patch 属性</a> 章节。</p>
<h3 id="4-2-4-Quirks">4.2.4 <code>Quirks</code></h3>
<p><strong>Type</strong>: <code>plist dict</code><br>
<strong>Description</strong>: 应用下文 <a href="#4-6-Quirks-%E5%B1%9E%E6%80%A7">4.6 Quirks 属性</a> 章节中描述的 Quirks。</p>
<h2 id="4-3-Add-属性">4.3 Add 属性</h2>
<h3 id="4-2-1-Comment">4.2.1 <code>Comment</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: 用于为条目提供人类可读参考的任意 ASCII 字符串（译者注：即注释）。</p>
<h3 id="4-2-2-Enabled">4.2.2 <code>Enabled</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: false<br>
<strong>Description</strong>: 除非此值为 <code>true</code>，否则此 ACPI 表不会被添加。</p>
<h3 id="4-2-3-Path">4.2.3 <code>Path</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: 需要加载的 ACPI 表所在的路径。示例值如 <code>DSDT.aml</code>、<code>SubDir/SSDT-8.aml</code>、<code>SSDT-USBX.aml</code>。</p>
<p>所有 ACPI 表都从 <code>OC/ACPI</code> 目录加载，加载顺序遵循数组中的项目顺序。</p>
<p><strong>注</strong>： 除具有 DSDT 表标识符（由解析得到的数据、而非由其文件名决定）的表外，所有表都将作为新表插入 ACPI 栈。而 DSDT 表与其余的表不同，将会执行 DSDT 表的替换。</p>
<h2 id="4-4-Delete-属性">4.4 Delete 属性</h2>
<h3 id="4-2-1-All">4.2.1 <code>All</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: false<br>
<strong>Description</strong>: 如果设置为 <code>true</code>，则所有符合条件的 ACPI 表都会被舍弃。 否则，只舍弃第一个匹配到的。</p>
<h3 id="4-2-2-Comment">4.2.2 <code>Comment</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: 用于为条目提供人类可读参考的任意 ASCII 字符串（译者注：即注释）。</p>
<h3 id="4-2-3-Enabled">4.2.3 <code>Enabled</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: false<br>
<strong>Description</strong>: 除非此值为 <code>true</code>，否则此 ACPI 表不会被舍弃。</p>
<h3 id="4-2-4-OemTableId">4.2.4 <code>OemTableId</code></h3>
<p><strong>Type</strong>: <code>plist data, 8 bytes</code><br>
<strong>Failsafe</strong>: All zero<br>
<strong>Description</strong>: 将表的 OEM ID 匹配为此处所填的值，全部为 0 时忽略。</p>
<h3 id="4-2-5-TableLength">4.2.5 <code>TableLength</code></h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: 0<br>
<strong>Description</strong>: 将表的大小匹配为此处所填的值，填 0 时忽略。</p>
<h3 id="4-2-6-TableSignature">4.2.6 <code>TableSignature</code></h3>
<p><strong>Type</strong>: <code>plist data, 4 bytes</code><br>
<strong>Failsafe</strong>: All zero<br>
<strong>Description</strong>: 将表的签名匹配为此处的值，全部为 0 时忽略。</p>
<p><strong>注</strong>：当序列需要在多处替换的时候，务必注意不要指定表的签名，尤其是在进行不同类型的重命名操作的时候。</p>
<h2 id="4-5-Patch-属性">4.5 Patch 属性</h2>
<h3 id="4-5-1-Comment">4.5.1 Comment</h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: 用于为条目提供人类可读参考的任意 ASCII 字符串（译者注：即注释）。</p>
<h3 id="4-5-2-Count">4.5.2 Count</h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: 0<br>
<strong>Description</strong>: 补丁应用的次数。如果将此值设置为 0，补丁将会被应用于所有匹配。</p>
<h3 id="4-5-3-Enabled">4.5.3 Enabled</h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: false<br>
<strong>Description</strong>: 除非设置为 <code>true</code>，否则此处的 ACPI 补丁不会生效。</p>
<h3 id="4-5-4-Find">4.5.4 Find</h3>
<p><strong>Type</strong>: <code>plist data</code><br>
<strong>Failsafe</strong>: Empty data<br>
<strong>Description</strong>: 需要寻找的 Data，长度必须和 <code>Replace</code> 相等。</p>
<h3 id="4-5-5-Limit">4.5.5 Limit</h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: 0<br>
<strong>Description</strong>: 要搜索的最大字节数。当此值为 0 时会遍历整个 ACPI 表。</p>
<h3 id="4-5-6-Mask">4.5.6 Mask</h3>
<p><strong>Type</strong>: <code>plist data</code><br>
<strong>Failsafe</strong>: Empty data<br>
<strong>Description</strong>: 查找比较期间使用的数据按位掩码。 通过忽略未屏蔽（设置为零）位来进行模糊搜索。可以设置为空数据以忽略，否则此值的长度必须和 <code>Replace</code> 的长度相等。</p>
<h3 id="4-5-7-OemTableId">4.5.7 OemTableId</h3>
<p><strong>Type</strong>: <code>plist data, 8 bytes</code><br>
<strong>Failsafe</strong>: All zero<br>
<strong>Description</strong>: 将表的 OEM ID 匹配为此处所填的值，全部为 0 时忽略。</p>
<h3 id="4-5-8-Replace">4.5.8 Replace</h3>
<p><strong>Type</strong>: <code>plist data</code><br>
<strong>Failsafe</strong>: Empty data<br>
<strong>Description</strong>: 一个或多个字节的替换数据。</p>
<h3 id="4-5-9-ReplaceMark">4.5.9 ReplaceMark</h3>
<p><strong>Type</strong>: <code>plist data</code><br>
<strong>Failsafe</strong>: Empty data<br>
<strong>Description</strong>: 替换数据期间使用的数据按位掩码。 通过忽略未屏蔽（设置为零）位来进行模糊搜索。可以设置为空数据以忽略，否则此值的长度必须和 <code>Replace</code> 的长度相等。</p>
<h3 id="4-5-10-Skip">4.5.10 Skip</h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: 0<br>
<strong>Description</strong>: 完成替换之前要跳过的匹配数。</p>
<h3 id="4-5-11-TableLength">4.5.11 TableLength</h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: 0<br>
<strong>Description</strong>: 将表的大小匹配为此处所填的值，填 0 时忽略。</p>
<h3 id="4-5-11-TableSignature">4.5.11 TableSignature</h3>
<p><strong>Type</strong>: <code>plist data, 4 bytes</code><br>
<strong>Failsafe</strong>: All zero<br>
<strong>Description</strong>: 将表的签名匹配为此处的值，全部为 0 时忽略。</p>
<p>大多数情况下，ACPI 补丁是有害而无益的：</p>
<ul>
<li>避免用 ACPI 补丁重命名设备。这样做可能会使设备重命名失败，或者会对不相关的设备进行错误地重命名（如 <code>EC</code> 和 <code>EC0</code>）。为了保证 ACPI 的一致性，在 I/O 注册表级别重命名设备会更加安全，比如 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/WhateverGreen">WhateverGreen</a> 的做法。</li>
<li>避免为了支持更高级的功能集而给 <code>_OSI</code> 打补丁，除非你非常需要。这样做通常会侵入 APTIO 固件，从而导致需要用打更多的补丁去填坑。现代的固件基本不需要，而真正需要的那些固件只要打一些更小的补丁就可以了。</li>
<li>尽量避免重命名 <code>_PRW</code> 或 <code>_DSM</code> 之类的魔改举动。</li>
</ul>
<p>在某些情况下，打补丁确实是有意义的：</p>
<ul>
<li>刷新 <code>HPET</code>（或其他设备）的 method header 来避免老硬件上的 <code>_OSI</code> 兼容性检查。可通过将 <code>A0 10 93 4F 53 46 4C 00</code> 替换为 <code>A4 0A 0F A3 A3 A3 A3 A3</code> 的办法，使带有 <code>if ((OSFL () == Zero)) &#123; If (HPTE) ... Return (Zero)</code> 的 <code>_STA</code> method 达到强制返回 0xF 的目的。</li>
<li>在 SSDT 中实现自定义 method，比如笔记本电脑上功能键可以通过将 <code>_Q11</code> 替换为 <code>XQ11</code> 的方法进行仿冒。</li>
</ul>
<p>TianoCore 源文件 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/audk/blob/master/MdePkg/Include/IndustryStandard/AcpiAml.h">AcpiAml.h</a> 可能会对于理解 ACPI 操作码有所帮助。</p>
<p><em>注</em>：<code>Find</code> 和 <code>Replace</code> 的长度 <strong>必须完全一样</strong>，否则 ACPI 表可能会被破坏、导致系统不稳定。必要时请使用「代理」补丁的方法、或使用 <code>NOP</code> 填充剩余区域</p>
<h2 id="4-6-Quirks-属性">4.6 Quirks 属性</h2>
<h3 id="4-6-1-FadtEnableReset">4.6.1 FadtEnableReset</h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: false<br>
<strong>Description</strong>: 在 FADT 表中提供寄存器复位标志，用于修复旧硬件的重启和关机。除非需要，否则不建议启用。</p>
<p>只有在传统硬件和少数笔记本上需要。这一 Quirk 也可以修复电源快捷键（译者注： + 电源键）。不建议启用，除非不启用就无法关机和重启。</p>
<h3 id="4-6-2-NormalizeHeaders">4.6.2 NormalizeHeaders</h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: false<br>
<strong>Description</strong>: 清理 ACPI 表头字段以解决 macOS ACPI 实现错误导致的引导崩溃<br>
<em>参考</em>: 由 Alex James（theracermaster）在调试 AppleACPIPlatform 时发现。从 macOS Mojave (10.14) 开始，这个错误已经被修复。</p>
<h3 id="4-6-3-RebaseRegions">4.6.3 RebaseRegions</h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: false<br>
<strong>Description</strong>: 尝试试探性地重定位 ACPI 内存区域。不建议启用这一选项，除非你需要自定义 DSDT。</p>
<p>ACPI 表通常由底层固件动态生成。在与位置无关的代码中，ACPI 表可能包含用于设备配置的 MMIO 区域的物理地址，通常按区域（例如 OperationRegion）分组。 更改固件设置或硬件配置，升级或修补固件不可避免地会导致动态生成的 ACPI 代码发生变化，这有时会导致上述 OperationRegion 结构中的地址发生变化。</p>
<p>因此，对 ACPI 表进行任何形式的修改都是非常危险的。最合理的方法是对 ACPI 进行尽可能少的更改，并尝试不替换任何表，尤其是 DSDT。</p>
<p>如果无法不得不替换 DSDT，则至少应尝试确保自定义 DSDT 基于最新的 DSDT 或避免对受影响区域的读写。如果没有其他帮助，可以尝试通过尝试修复 ACPI 地址来避免在 macOS 引导的 PCI Configuration Begin 阶段出现停顿的情况。</p>
<h3 id="4-6-4-ResetHwSig">4.6.4 ResetHwSig</h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: false<br>
<strong>Description</strong>: 将 <code>FACS</code> 表中 <code>HardwareSignature</code> 的值重置为 0。</p>
<p>启用这一选项可以解决固件无法在重新启动过程中保持硬件签名导致的休眠唤醒问题。</p>
<h3 id="4-6-5-ResetLogoStatus">4.6.5 ResetLogoStatus</h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: false<br>
<strong>Description</strong>: 将 <code>BGRT</code> 表中 <code>Displayed</code> 状态字段重置为 <code>false</code>.</p>
<p>这适用于提供 <code>BGRT</code> 表、但随后无法处理屏幕更新的固件。如果在开机时无法显示 OEM Windows 标志的硬件可以尝试开启开启。</p>
<h1>5. Booter</h1>
<hr>
<h2 id="5-1-简介">5.1 简介</h2>
<p>本部分允许在 Apple BootLoader（<code>boot.efi</code>）上应用不同种类的 UEFI 修改。目前，这些修改为不同的固件提供了各种补丁和环境更改。其中一些功能最初是作为 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/AptioFixPkg">AptioMemoryFix.efi</a> 的一部分，如今 <code>AptioMemoryFix.efi</code> 已经不再维护。如果你还在使用，请参考 <code>Tips and Tricks</code> 章节提供的迁移步骤。</p>
<p>如果您是第一次在自定义固件上使用此功能，则首先需要执行一系列检查。开始之前，请确保您具有：</p>
<ul>
<li>最新版本的 UEFI 固件（去主板厂家的官网上看看）</li>
<li>禁用了 <code>Fast Boot</code> 和 <code>Hardware Fast Boot</code>。如果 BIOS 里有相关选项，禁用掉。</li>
<li><code>Above 4G Decoding</code> 或类似功能，如果有的话，请在固件设置中启用。注意，在某些主板上（特别是 ASUS WS-X299-PRO）这个选项会造成不良影响，必须禁用掉。虽然目前还不知道是不是其他主板也有同样问题，但是如果你遇到了不稳定的启动故障，可以首先考虑检查一下这个选项。</li>
<li>启用了 <code>DisableIoMapper</code> quirk、或者在 BIOS 中禁用 <code>VT-d</code>、或者删去了 ACPI DMAR 表。</li>
<li>启动参数中 <strong>没有</strong> <code>slide</code>。 除非你没法开机、并且在日志里看见了 <code>No slide values are usable! Use custom slide!</code>，否则不论如何也不要使用这个启动参数。</li>
<li><code>CFG Lock</code> (MSR <code>0xE2</code> 写保护) 在 BIOS 中被禁用。如果 BIOS 中没有、而且你心灵手巧，你可以考虑 <a target="_blank" rel="noopener" href="https://github.com/LongSoft/UEFITool/blob/master/UEFIPatch/patches.txt">手动打补丁将其禁用</a> 。更多细节请参考 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/AppleSupportPkg#verifymsre2">VerifyMsrE2</a>。</li>
<li>在 BIOS 中禁用 <code>CSM</code> (Compatibility Support Module)。NVIDIA 6xx / AMD 2xx 或更老的平台可能需要刷新 GOP ROM，具体步骤参考 <a target="_blank" rel="noopener" href="https://www.win-raid.com/t892f16-AMD-and-Nvidia-GOP-update-No-requests-DIY.html">GopUpdate</a> 或者 <a target="_blank" rel="noopener" href="http://www.insanelymac.com/forum/topic/299614-asus-eah6450-video-bios-uefi-gop-upgrade-and-gop-uefi-binary-in-efi-for-many-ati-cards/page-1#entry2042163">AMD UEFI GOP MAKER</a>。</li>
<li>除非 USB 设备断开连接，否则如果引导停止，则仅在 BIOS 中启用 <code>EHCI / XHCI Hand-off</code>。</li>
<li>在 BIOS 中启用 <code>VT-x</code>、<code>Hyper Threading</code>、<code>Execute Disable Bit</code>。</li>
<li>有时你还可能需要在 BIOS 中禁用 <code>Thunderbolt support</code>、<code>Intel SGX</code> 和 <code>Intel Platform Trust</code>。但是这一操作不是必须的。</li>
</ul>
<p>在调试睡眠问题时，您可能希望（临时）禁用 Power Nap 和自动关闭电源，这似乎有时会导致在旧平台上唤醒黑屏或循环启动的问题。具体问题可能因人而异，但通常你应首先检查 ACPI 表，比如这是在 <a target="_blank" rel="noopener" href="http://www.insanelymac.com/forum/topic/329624-need-cmos-reset-after-sleep-only-after-login/#entry2534645">Z68 主板</a> 上找到的一些 Bug。要关闭 Power Nap 和其他功能，请在终端中运行以下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo pmset autopoweroff 0</span><br><span class="line">sudo pmset powernap 0</span><br><span class="line">sudo pmset standby 0</span><br></pre></td></tr></table></figure>
<p><strong>注</strong>：这些设置可能会在硬件更改、操作系统更新和某些其他情况下重置。要查看它们的当前状态，请在终端中使用 <code>pmset -g</code> 命令。</p>
<h2 id="5-2-属性列表">5.2 属性列表</h2>
<h3 id="5-2-1-MmioWhitelist">5.2.1 MmioWhitelist</h3>
<p><strong>Type</strong>: <code>plist array</code><br>
<strong>Description</strong>: 设计为用 <code>plist dict</code> 值填充，用来描述在启用 <code>DevirtualiseMmio</code> 这个 Quirk 时特定固件能够运作的关键地址。详见下面的 MmioWhitelist Properties 章节。</p>
<blockquote>
<p>译者注：如果开机卡在 <code>PCI...</code> 可以尝试开启 Item 1 下的 Patch</p>
</blockquote>
<h3 id="5-2-2-Quirks">5.2.2 Quirks</h3>
<p><strong>Type</strong>: <code>plist dict</code><br>
<strong>Description</strong>: 应用下面的 Quirks 属性部分中所述的各个引导 Quirk。</p>
<h2 id="5-3-MmioWhitelist-属性">5.3 MmioWhitelist 属性</h2>
<h3 id="5-3-1-Address">5.3.1 Address</h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: 0<br>
<strong>Description</strong>: 指排除在外的 MMIO 地址, 其内存描述符（Memory Descriptor）会被 <code>DevirtualiseMmio</code> 虚拟化（不变）。该值所在的区域会被分配一个虚拟地址，因此在操作系统运行期间，固件能够直接与该内存区域进行通信。</p>
<h3 id="5-3-2-Comment">5.3.2 Comment</h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: 用于为条目提供人类可读参考的任意 ASCII 字符串（译者注：即注释）。</p>
<h3 id="5-3-3-Enabled">5.3.3 Enabled</h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: false<br>
<strong>Description</strong>: 除非设置为 <code>true</code>，否则此地址将被虚拟化。</p>
<h2 id="5-4-Quirks-属性">5.4 Quirks 属性</h2>
<h3 id="AvoidRuntimeDefrag"><code>AvoidRuntimeDefrag</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 防止 <code>boot.efi</code> 运行时执行内存碎片整理</p>
<p>这个选项通过提供对可变存储的支持，修复了包括日期、时间、NVRAM、电源控制等 UEFI Runtime 服务。</p>
<p><em>注</em>: 除 Apple 和 VMware 固件外，都需要启用此选项。</p>
<h3 id="DevirtualiseMmio"><code>DevirtualiseMmio</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 从选定的 MMIO 区域中删除 Runtime 属性。</p>
<p>通过删除已知内存区域的 runtime bit，此选项可减少内存映射中 stolen memory footprint。 这个 Quirks 可能会导致可用的 KASLR slides 增加，但如果没有其他措施，不一定与目标主板兼容。 通常，这会释放 64 到 256 MB 的内存（具体数值会显示在调试日志中）。在某些平台上这是引导 macOS 的唯一方法，否则在引导加载程序阶段会出现内存分配错误。</p>
<p>该选项通常对所有固件都有用，除了一些非常古老的固件（例如 Sandy Bridge）。 在某些固件上，它可能需要一个例外映射列表。为了使 NVRAM 和休眠功能正常工作，获取其虚拟地址仍然是必要的。 请参考 <code>MmioWhitelist</code> 章节来实现这个。</p>
<blockquote>
<p>译者注：对于某些 300 系列主板是必须的</p>
</blockquote>
<h3 id="DisableSingleUser"><code>DisableSingleUser</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 禁用 Apple 单用户模式</p>
<p>这个选项可以禁用 <code>CMD+S</code> 热键和 <code>-s</code> 启动参数来限制单用户模式。启用这一 Quirks 后预期行为应和 T2 的模型行为类似。请参考 Apple 的 <a target="_blank" rel="noopener" href="https://support.apple.com/HT201573">这篇文章</a> 以了解如何在启用这一 Quirks 后继续使用单用户模式。</p>
<h3 id="DisableVariableWrite"><code>DisableVariableWrite</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 防止 macOS 获取 NVRAM 的写入权限。</p>
<p>这个选项可以限制 macOS 对 NVRAM 的写入。这个 Quirk 需要 <code>OpenRuntime.efi</code>（原名 <code>FwRuntimeServices.efi</code>）提供了 <code>OC_FIRMWARE_RUNTIME</code> 协议的实现.</p>
<p><em>注</em>: 这个 Quirk 也可以避免由于无法将变量写入 NVRAM 而导致的对操作系统的破坏。</p>
<blockquote>
<p>译者注：在 Z390/HM370 等没有原生 macOS 支持 NVRAM 的主板上需要开启。</p>
</blockquote>
<h3 id="DiscardHibernateMap"><code>DiscardHibernateMap</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 复用原始的休眠内存映射。</p>
<p>这一选项强制 XNU 内核忽略新提供的内存映射、认定设备从休眠状态唤醒后无需对其更改。如果你在使用 Windows，则 <a href="">务必启用</a> 这一选项，因为 Windows 要求 S4 唤醒后保留运行内存的大小和未知。</p>
<p><em>注</em>: 这可能用于解决较旧硬件上的错误内存映射。如 Insyde 固件的 Ivy Bridge 笔记本电脑或者 Acer V3-571G。 除非您完全了解这一选项可能导致的后果，否则请勿使用此功能。</p>
<h3 id="EnableSafeModeSlide"><code>EnableSafeModeSlide</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 修补引导加载程序以在安全模式下启用 KASLR。</p>
<p>这个选项与启动到安全模式（启动时按住 Shift 或受用了 <code>-x</code> 启动参数）有关。默认情况下，安全模式会使用 <code>slide=0</code>，这个 Quirks 试图通过修补 <code>boot.efi</code> 接触这一限制。只有当 <code>ProvideCustomSlide</code> 启用后才可以启用本 Quirks。</p>
<p><em>注</em>: 除非启动到安全模式失败，否则不需要启用此选项。</p>
<h3 id="EnableWriteUnprotector"><code>EnableWriteUnprotector</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 关闭 <code>CR0</code> 寄存器中的写入保护。</p>
<p>这个选项会在 UEFI Runtime Services 执行过程中，删除 <code>CR0</code> 寄存器中的写保护 <code>WP</code> bit，从而绕过其代码页的 <code>RX̂</code> 权限。这个 Quirk 需要配合 <code>OpenRuntime.efi</code>（原 <code>FwRuntimeServices.efi</code>）里的 <code>OC_FIRMWARE_RUNTIME</code> 协议来实现。</p>
<p><em>注</em>：这个 Quirk 可能会破坏你的固件的安全性。如果你的固件支持内存属性表 (MAT)，请优先使用下文中的 <code>RebuildAppleMemoryMap</code> 那个 Quirk。</p>
<h3 id="ForceExitBootServices"><code>ForceExitBootServices</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 在失败时用新的内存映射（Memory Map）重试 <code>ExitBootServices</code>。</p>
<p>开启后会确保 <code>ExitBootServices</code> 即使在 MemoryMap 参数过期时也能调用成功，方法主要是获取当前的内存映射，并重试调用 <code>ExitBootServices</code>。</p>
<p><em>注</em>：是否启用这个 Quirks 取决于你是否遇到了 Early Boot 故障。除非你详细了解这一选项可能导致的后果，否则请勿启用这一选项。</p>
<h3 id="ProtectMemoryRegions"><code>ProtectMemoryRegions</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 保护内存区域免于不正确的读写。</p>
<p>有些固件会错误映射内存区域：</p>
<ul>
<li>CSM 区域会被标记为引导服务的代码或数据，从而成为 XNU 内核的空闲内存。</li>
<li>MMIO 区域会被标记为预留内存，保持不被映射的状态，但在运行时可能需要在 NVRAM 的支持下才能访问。</li>
</ul>
<p>这一 Quirk 会尝试修复这些区域的类型，比如用 ACPI NVS 标记 CSM，MMIO 标记 MMIO。</p>
<p><em>注</em>：是否启用这一 Quirk 取决于你是否遇到了休眠、睡眠无法唤醒、启动失败或其他问题。一般来说，只有古董固件才需要启用。</p>
<h3 id="ProtectSecureBoot"><code>ProtectSecureBoot</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 保护 UEFI 安全启动变量不被写入。</p>
<p>尝试从操作系统写入 <code>db</code>、<code>dbx</code>、<code>PK</code> 和 <code>KEK</code> 时生成报告。</p>
<p><em>注</em>：这个 Quirk 主要试图避免碎片整理导致的 NVRAM 相关问题，如 Insyde 或 <code>MacPro5,1</code>。</p>
<h3 id="ProtectUefiServices"><code>ProtectUefiServices</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 保护 UEFI 服务不被固件覆盖。</p>
<p>某些现代固件（包括硬件和 VMware 之类的虚拟机）可能会在加载驱动及相关操作的过程中，更新 UEFI 服务的指针。这一行为会直接破坏其他影响内存管理的 Quirk，如 <code>DevirtualiseMmio</code>、<code>ProtectMemoryRegions</code>，或 <code>RebuildAppleMemoryMap</code>；也可能会破坏其他 Quirk，具体取决于 Quirk 的作用。</p>
<p><em>注</em>：在 VMware 上，是否需要开启这个 Quirk 取决于是否有 <code>Your Mac OS guest might run unreliably with more than one virtual core.</code> 这样的消息。</p>
<h3 id="ProvideCustomSlide"><code>ProvideCustomSlide</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 为低内存设备提供自定义 KASLR slide 值。</p>
<p>开启这个选项后，将会对固件进行内存映射分析，检查所有 slide（从 1 到 255）中是否有可用的。由于 <code>boot.efi</code> 私用 rdrand 或伪随机 rdtsc 随机生成此值，因此有可能出现冲突的 slide 值被使用并导致引导失败。如果出现潜在的冲突，这个选项将会强制为 macOS 选择一个伪随机值。这同时确保了 <code>slide=</code> 参数不会被传递给操作系统。</p>
<p><em>注</em>: OpenCore 会自动检查是否需要启用这一选项。如果 OpenCore 的调试日志中出现 <code>OCABC: Only N/256 slide values are usable!</code> 则请启用这一选项。</p>
<h3 id="RebuildAppleMemoryMap"><code>RebuildAppleMemoryMap</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 生成与 macOS 兼容的内存映射。</p>
<p>Apple 内核在解析 UEFI 内存映射时有几个限制：</p>
<ul>
<li>内存映射的大小不能超过 4096 字节，因为 Apple 内核将其映射为一个 4 KiB 页面。由于某些固件的内存映射大小非常大（大约超过 100 个条目），Apple 内核会在启动时崩溃。</li>
<li>内存属性表会被忽略。<code>EfiRuntimeServicesCode</code> 内存静态获得 <code>RX</code> 权限，其他内存类型则获得 <code>RW</code> 权限。某些固件驱动会在运行时把数据写到全局变量中，因此 Apple 内核在调用 UEFI Runtime Services 时会崩溃，除非驱动的 <code>.data</code> 部分有 <code>EfiRuntimeServicesData</code> 类型。</li>
</ul>
<p>为了解决这些限制，这个 Quirk 将内存属性表的权限应用到传递给 Apple 内核的内存映射中，如果生成的内存映射超过 4KiB，则可选择尝试统一类似类型的连续插槽。</p>
<p><em>注 1</em>：由于许多固件自带的内存保护不正确，所以这个 Quirk 一般要和 <code>SyncRuntimePermissions</code> 一起启用。<br>
<em>注 2</em>：根据是否遇到第一阶段启动失败再决定是否启用这一 Quirk。在支持内存属性表 (MAT) 的平台上，这一 Quirk 是 <code>EnableWriteUnprotector</code> 更好的替代。</p>
<h3 id="SetupVirtualMap"><code>SetupVirtualMap</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 将 <code>SetVirtualAddresses</code> 调用修复为虚拟地址.</p>
<p>选择让固件在调用 <code>SetVirtualAddresses</code> 后通过虚拟地址访问内存，可能会导致 Early Boot 故障。这个 Quirk 可通过对分配的虚拟地址和物理内存进行 Early Boot 身份映射来解决这个问题。</p>
<p><em>注</em>：是否启用这个 Quirks 取决于你是否遇到了 Early Boot 故障。目前具有内存保护支持的新固件（例如 OVMF ）由于一些原因不支持此 Quirks：<a target="_blank" rel="noopener" href="https://github.com/acidanthera/bugtracker/issues/719">acidanthera/bugtracker#719</a>。</p>
<h3 id="SignalAppleOS"><code>SignalAppleOS</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 不论使用什么操作系统、总是向 OSInfo 报告启动的是 macOS。</p>
<p>Mac 设备在不同的操作系统中具有不同的行为，因此如果你在使用 Mac 设备，这一功能会非常有用。例如，你可以通过启用这一选项为某些双 GPU 的 MacBook 型号中在 Windows 和 Linux 中启用 Intel GPU。</p>
<h3 id="SyncRuntimePermissions"><code>SyncRuntimePermissions</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 更新运行时环境的内存权限。</p>
<p>某些固件无法正确处理运行时权限，表现为：</p>
<ul>
<li>把 <code>OpenRuntime</code> 在内存映射中错误地标记为不可执行。</li>
<li>把 <code>OpenRuntime</code> 在内存属性表中错误的标记为不可执行。</li>
<li>在 <code>OpenRuntime</code> 加载之后丢失内存属性表中的条目。</li>
<li>把内存属性表中的项目标记为 read-write-execute。</li>
</ul>
<p>这个 Quirk 会通过更新内存映射和内存属性表来纠正这一问题。</p>
<p><em>注</em>：是否开启这一 Quirk 取决于 macOS、Linux 或 Windows 是否遇到 Early Boot 故障。一般来说，只有 2018 年以后发布的固件才会受到影响。</p>
<h1>6. DeviceProperties</h1>
<hr>
<h2 id="6-1-简介">6.1 简介</h2>
<p>设备相关配置通过专用的缓存区（<code>EfiDevicePathPropertyDatabase</code>）提供给 macOS，这个缓冲区是设备路径到属性名称与值的键值对的序列化映射。</p>
<p>属性相关数据可以使用 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/gfxutil">gfxutil</a> 进行调试。在 macOS 下获取当前属性数据请使用 <code>ioreg</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ioreg -lw0 -p IODeviceTree -n efi -r -x | grep device-properties |</span><br><span class="line">  sed <span class="string">&#x27;s/.*&lt;//;s/&gt;.*//&#x27;</span> &gt; /tmp/device-properties.hex &amp;&amp;</span><br><span class="line">  gfxutil /tmp/device-properties.hex /tmp/device-properties.plist &amp;&amp;</span><br><span class="line">  cat /tmp/device-properties.plist</span><br></pre></td></tr></table></figure>
<h2 id="6-2-属性列表">6.2 属性列表</h2>
<h3 id="6-2-1-Add">6.2.1 Add</h3>
<p><strong>Type</strong>: <code>plist dict</code><br>
<strong>Description</strong>: 将设备属性从设备路径的映射（plist dict）设置为变量名称和值的映射（plist dict），其中变量名称和值的格式为 plist metadata。设备路径必须以 canonic string 格式提供（例如： <code>PciRoot(0x0)/Pci(0x1,0x0)/Pci(0x0,0x0)</code>）。添加的属性只有在不存在且未被屏蔽的情况下才会被设置。<br>
<strong>注</strong>：目前，属性只能通过原始驱动程序添加。因此除非安装了单独的驱动程序，否则没有理由 Delete 变量。</p>
<h3 id="6-2-2-Delete">6.2.2 Delete</h3>
<p><strong>Type</strong>: <code>plist dict</code><br>
<strong>Description</strong>: 从设备路径的映射（<code>plist dict</code>）到 plist 字符串格式的变量名数组（数据类型 <code>plist array</code>）中删除设备属性。</p>
<blockquote>
<p>译者注：这里的设置等同于 Clover 里的 ACPI 重命名 <code>_DSM → XDSM =&gt; TgtBridge</code></p>
</blockquote>
<h2 id="6-3-常见属性">6.3 常见属性</h2>
<p>一些常见的属性包括：</p>
<ul>
<li><code>device-id</code><br>
用户指定的设备标识符，用于 I/O 套件匹配。数据类型为 4 byte data.</li>
<li><code>vendor-id</code><br>
用户指定的供应商标识符，用于 I/O 套件匹配。数据类型为 4 byte data.</li>
<li><code>AAPL,ig-platform-id</code><br>
Intel GPU 缓冲帧标识符，用于在 Ivy Bridge 上选择缓冲帧区域。数据类型为 4 byte data。</li>
<li><code>AAPL,snb-platform-id</code><br>
Intel GPU 缓冲帧标识符，用于在 Sandy Bridge 上选择缓冲帧区域。数据类型为 4 byte data。</li>
<li><code>layout-id</code><br>
AppleHDA 的音频布局，4 byte data。</li>
</ul>
<h1>7. Kernel</h1>
<hr>
<h2 id="7-1-简介">7.1 简介</h2>
<p>本章节介绍了如何在 Apple Kernel（<a target="_blank" rel="noopener" href="https://opensource.apple.com/source/xnu">XNU</a>）上应用各种不同的内核空间修改，包括内核驱动程序（kext）注入、修补以及屏蔽。</p>
<h2 id="7-2-属性列表">7.2 属性列表</h2>
<h3 id="7-2-1-Add">7.2.1 Add</h3>
<p><strong>Type</strong>: <code>plist array</code><br>
<strong>Failsafe</strong>: Empty<br>
<strong>Description</strong>: 从 <code>OC/Kexts</code> 目录加载选定的 Kext 驱动。</p>
<p>设计为使用 plist dict 数据填充以描述每个驱动程序。请参阅下述 Add 属性章节。Kext 驱动程序加载的顺序遵照数组中项目的顺序，因此如 Lilu 这种其他驱动程序的依赖驱动应该位于前面。</p>
<h3 id="7-2-2-Delete">7.2.2 Delete</h3>
<p><strong>Type</strong>: <code>plist array</code><br>
<strong>Failsafe</strong>: Empty<br>
<strong>Description</strong>: 从内核中删除选定的内核驱动程序。</p>
<p>设计为使用 plist dict 数据填充以描述每个驱动程序。请参阅下述 Delete 属性章节。Kext 驱动程序加载的顺序遵照数组中项目的顺序，因此如 Lilu 这种其他驱动程序的依赖驱动应该位于前面。</p>
<h3 id="7-2-3-Emulate">7.2.3 Emulate</h3>
<p><strong>Type</strong>: <code>plist dict</code><br>
<strong>Description</strong>: 在内核空间中仿真选定的硬件。请参考下文 Emulate 属性。</p>
<h3 id="7-2-4-Patch">7.2.4 Patch</h3>
<p><strong>Type</strong>: <code>plist array</code><br>
<strong>Failsafe</strong>: Empty<br>
<strong>Description</strong>: 在添加和删除驱动程序步骤之前执行的对现有 Kext 驱动程序的二进制修补。</p>
<p>设计为使用 plist dictionary 数据填充以描述每个驱动程序。请参阅下述 Patch 属性章节。</p>
<h3 id="7-2-5-Quirks">7.2.5 Quirks</h3>
<p><strong>Type</strong>: <code>plist dict</code><br>
<strong>Description</strong>: 应用下面的 Quirks 属性章节中描述的各个内核和驱动程序 Quirk。</p>
<h2 id="7-3-Add-属性">7.3 Add 属性</h2>
<h3 id="7-3-1-BundlePath">7.3.1 <code>BundlePath</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: Kext 相对于 <code>EFI/OC/kexts/Other/</code> 的路径 (e.g. <code>Lilu.kext</code> or <code>MyKext.kext/Contents/PlugIns/MySubKext.kext</code>).</p>
<blockquote>
<p>注，如 <code>VoodooPS2Controller.kext</code> 这种包括其他 kext 驱动的，需要分别单独添加，如 <code>VoodooPS2Controller.kext/Contents/PlugIns/VoodooPS2Keyboard.kext</code>。</p>
</blockquote>
<h3 id="7-3-2-Comment">7.3.2 <code>Comment</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: 用于为条目提供人类可读参考的任意 ASCII 字符串（译者注：即注释）。</p>
<h3 id="7-3-3-Enabled">7.3.3 <code>Enabled</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 是否加载该驱动.</p>
<h3 id="7-3-4-ExecutablePath">7.3.4 <code>ExecutablePath</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: Kext 中实际可执行文件的路径（如 <code>Lilu.kext</code> 中的可执行文件路径是 <code>Contents/MacOS/Lilu</code>）。</p>
<blockquote>
<p>译者注：空壳 Kext 没有可执行文件（如 <code>USBPorts.kext</code>），此项留空即可</p>
</blockquote>
<h3 id="7-3-5-MaxKernel">7.3.5 <code>MaxKernel</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: 在小于等于指定的 macOS 版本中添加该 Kext 驱动程序。</p>
<p>你可以使用 <code>uname -r</code> 指令获取当前内核版本，一般为三个整数、中间由半角局点分隔，如 <code>18.7.0</code> 代表的是 <code>10.14.6</code>。OpenCore 对内核版本解释的实现方式如下图所示：</p>
<p><img src= "/img/loading.gif" data-lazy-src="/img/7-1.png#alt=7-1.png" alt=""></p>
<p>内核版本比较的实现如下图所示：</p>
<p><img src= "/img/loading.gif" data-lazy-src="/img/7-2.png#alt=7-2.png" alt=""></p>
<p>将 Darwin 内核版本号字符串从左到右以 <code>.</code> 符号作为分隔符分割成三个整数，即为 <code>ParseDarwinVersion</code> 的三个参数。<code>FindDarwinVersion</code> 函数将会通过在内核镜像中查找形如 <img src= "/img/loading.gif" data-lazy-src="/img/7-3.png#alt=" alt=""> 的字符串来定位 Darwin 内核版本号。</p>
<h3 id="7-3-6-MinKernel">7.3.6 <code>MinKernel</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: 在大于等于指定的 macOS 版本中添加该 Kext 驱动程序。</p>
<p><em>注</em>：匹配逻辑请参阅 <code>Add</code> <code>MaxKernel</code> 的描述。</p>
<blockquote>
<p>译者注：以上两个属性定义了这个驱动将在什么版本范围的 macOS 中加载。留空表示在所有的 macOS 版本下都加载。</p>
</blockquote>
<h3 id="7-3-7-PlistPath">7.3.7 <code>PlistPath</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: Kext 中 <code>Info.plist</code> 文件的路径。一般为 <code>Contents/Info.plist</code>。</p>
<h2 id="7-4-Delete-属性">7.4 Delete 属性</h2>
<h3 id="7-4-1-Comment">7.4.1 <code>Comment</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: 用于为条目提供人类可读参考的任意 ASCII 字符串（译者注：即注释）。</p>
<h3 id="7-4-2-Enabled">7.4.2 <code>Enabled</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 除非设置为 <code>true</code>，否则这个内核驱动不会被加载。</p>
<h3 id="7-4-3-Identifier">7.4.3 <code>Identifier</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: Kext Bundle 标识符（比如<br>
<code>com.apple.driver.AppleTyMCEDriver</code>）。</p>
<h3 id="7-4-4-MaxKernel">7.4.4 <code>MaxKernel</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: 在小于等于指定的 macOS 版本中阻止 Kext 驱动程序。</p>
<p><em>注</em>：匹配逻辑请参阅 <code>Add</code> <code>MaxKernel</code> 的描述。</p>
<h3 id="7-4-5-MinKernel">7.4.5 <code>MinKernel</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: 在大于等于指定的 macOS 版本中阻止 Kext 驱动程序。</p>
<p><em>注</em>：匹配逻辑请参阅 <code>Add</code> <code>MaxKernel</code> 的描述。</p>
<h2 id="7-5-Emulate-属性">7.5 Emulate 属性</h2>
<h3 id="7-5-1-Cpuid1Data">7.5.1 <code>Cpuid1Data</code></h3>
<p><strong>Type</strong>: <code>plist data</code>, 16 bytes<br>
<strong>Failsafe</strong>: All zero<br>
<strong>Description</strong>: <code>EAX</code>、<code>EBX</code>、<code>ECX</code>、<code>EDX</code> 值的序列，用来取代 XNU 内核中的 <code>CPUID (1)</code> 调用。</p>
<p>该属性应用于以下两种需求：</p>
<ul>
<li>对不支持的 CPU 型号启用支持。</li>
<li>对不支持的 CPU Variant 启用 XCPM 支持。</li>
</ul>
<p>通常来讲只需要处理 <code>EAX</code> 的值，因为它代表完整的 CPUID。剩余的字节要留为 0。字节顺序是小字节序（Little Endian），比如 <code>A9 06 03 00</code> 代表 CPUID <code>0x0306A9</code> (Ivy Bridge)。</p>
<p>推荐使用下面的组合启用 XCPM 支持：</p>
<ul>
<li>Haswell-E (<code>0x306F2</code>) to Haswell (<code>0x0306C3</code>):<br>
<code>Cpuid1Data</code>: <code>C3 06 03 00 00 00 00 00 00 00 00 00 00 00 00 00</code><br>
<code>Cpuid1Mask</code>: <code>FF FF FF FF 00 00 00 00 00 00 00 00 00 00 00 00</code></li>
<li>Broadwell-E (<code>0x0406F1</code>) to Broadwell (<code>0x0306D4</code>):<br>
<code>Cpuid1Data</code>: <code>D4 06 03 00 00 00 00 00 00 00 00 00 00 00 00 00</code><br>
<code>Cpuid1Mask</code>: <code>FF FF FF FF 00 00 00 00 00 00 00 00 00 00 00 00</code></li>
</ul>
<p>进一步解释参阅 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/bugtracker/issues/365">acidanthera/bugtracker#365</a>。Haswell+ 低端架构请看 <code>Special NOTES</code>。</p>
<h3 id="7-5-2-Cpuid1Mask">7.5.2 <code>Cpuid1Mask</code></h3>
<p><strong>Type</strong>: <code>plist data</code>, 16 bytes<br>
<strong>Failsafe</strong>: All zero<br>
<strong>Description</strong>: <code>Cpuid1Data</code> 中激活的 bit 的位掩码。</p>
<p>当每个 <code>Cpuid1Mask</code> bit 都设置为 <code>0</code> 时将使用原始的 CPU bit，否则取 <code>Cpuid1Data</code> 的值。</p>
<h2 id="7-6-Patch-属性">7.6 Patch 属性</h2>
<h3 id="7-6-1-Base">7.6.1 <code>Base</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: 通过获取所提供的 Symbol 名称的地址，来选择 Symbol 匹配的 Base 进行补丁查找（或直接替换）。可以设置为空字符串以忽略。</p>
<h3 id="7-6-2-Comment">7.6.2 <code>Comment</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: 用于为条目提供人类可读参考的任意 ASCII 字符串（译者注：即注释）。</p>
<h3 id="7-6-3-Count">7.6.3 <code>Count</code></h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: 修补的次数，超过这一次数后便不再修补。<code>0</code> 表示修补所有查找到的。</p>
<h3 id="7-6-4-Enabled">7.6.4 <code>Enabled</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 除非设置为 <code>true</code>，否则不对内核进行该修补。</p>
<h3 id="7-6-5-Find">7.6.5 <code>Find</code></h3>
<p><strong>Type</strong>: <code>plist data</code><br>
<strong>Failsafe</strong>: Empty data<br>
<strong>Description</strong>: 需要查找的数据。可留空，在 <code>Base</code> 处直接替换。若不留空，其大小必须等于 <code>Replace</code>。</p>
<h3 id="7-6-6-Identifier">7.6.6 <code>Identifier</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: Kext Bundle 标识符（如 <code>com.apple.driver.AppleHDA</code>）或内核补丁的 <code>kernel</code>。</p>
<h3 id="7-6-7-Limit">7.6.7 <code>Limit</code></h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: 搜索的最大字节数。可以设置为 <code>0</code> 来查找整个 ext 或内核。</p>
<h3 id="7-6-8-Mask">7.6.8 <code>Mask</code></h3>
<p><strong>Type</strong>: <code>plist data</code><br>
<strong>Failsafe</strong>: Empty data<br>
<strong>Description</strong>: 在查找比较中使用数据位掩码。允许通过忽略未被屏蔽的 bit（设置为 <code>0</code>）进行模糊搜索。若留空则代表忽略，否则其大小必须等于 <code>Replace</code>。</p>
<h3 id="7-6-9-MaxKernel">7.6.9 <code>MaxKernel</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: 在指定的或更早的 macOS 版本上打补丁。</p>
<p><em>注</em>：匹配逻辑请参阅 <code>Add</code> <code>MaxKernel</code> 的描述。</p>
<h3 id="7-6-10-MinKernel">7.6.10 <code>MinKernel</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: 在指定的或更新的 macOS 版本上打补丁。</p>
<p><em>注</em>：匹配逻辑请参阅 <code>Add</code> <code>MaxKernel</code> 的描述。</p>
<h3 id="7-6-11-Replace">7.6.11 <code>Replace</code></h3>
<p><strong>Type</strong>: <code>plist data</code><br>
<strong>Failsafe</strong>: Empty data<br>
<strong>Description</strong>: 一个或多个字节的替换数据。</p>
<h3 id="7-6-12-ReplaceMask">7.6.12 <code>ReplaceMask</code></h3>
<p><strong>Type</strong>: <code>plist data</code><br>
<strong>Failsafe</strong>: Empty data<br>
<strong>Description</strong>: 替换时使用的数据位掩码。允许通过更新掩码（设置为非 <code>0</code>）来进行模糊替换。若留空则代表忽略，否则其大小必须等于 <code>Replace</code>。</p>
<h3 id="7-6-13-Skip">7.6.13 <code>Skip</code></h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: 在替换前要跳过的发现事件数。</p>
<h2 id="7-7-Quirks-属性">7.7 Quirks 属性</h2>
<h3 id="AppleCpuPmCfgLock"><code>AppleCpuPmCfgLock</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 禁用 <code>AppleIntelCPUPowerManagement.kext</code> 中的 <code>PKG_CST_CONFIG_CONTROL</code> (<code>0xE2</code>) 修改，从而避免早期 Kernel Panic。</p>
<p>某些固件会锁定 <code>PKG_CST_CONFIG_CONTROL</code> MSR 寄存器。可以使用捆绑的 <code>VerifyMsrE2</code> 工具检查其状态。</p>
<p>由于现代固件已经提供了 <code>CFG Lock</code> 相关设置、从而可以配置 <code>PKG_CST_CONFIG_CONTROL</code> 寄存器锁定，此选项应该尽可能避免。对于一些不显示 <code>CFG Lock</code> 配置的固件，可以按照下述配置进行修改：</p>
<ol>
<li>下载 <a target="_blank" rel="noopener" href="https://github.com/LongSoft/UEFITool/releases">UEFITool</a> 和 <a target="_blank" rel="noopener" href="https://github.com/LongSoft/Universal-IFR-Extractor/releases">IFR-Extractor</a></li>
<li>使用 UEFITool 中打开固件镜像文件，找到 CFG Lock 的 Unicode 字符串。如果你没有找到，意味着你的固件可能不支持 CFG Lock 解锁，那么你现在可以停下来了。</li>
<li>从 UEFITool 菜单中的 <code>Extract Body</code> 选项提取 <code>Setup.bin</code> 中的 PE32 镜像部分。</li>
<li>对提取出来的文件执行 IFR-Extractor（<code>./ifrextract Setup.bin Setup.txt</code>）。</li>
<li>从 Setup.txt 中找到 CFG Lock，VarStoreInfo（或者 VarOffset、VarName），记住紧随其后的偏移量值（例如 <code>0x123</code>）。</li>
<li>下载并执行由 <a target="_blank" rel="noopener" href="https://geektimes.com/post/258090">brainsucker</a> 编译的 <a target="_blank" rel="noopener" href="http://brains.by/posts/bootx64.7z">修改版 GRUB Shell</a>。你也可以是使用 <a target="_blank" rel="noopener" href="https://github.com/datasone">datasone</a> 制作的 <a target="_blank" rel="noopener" href="https://github.com/datasone/grub-mod-setup_var">新版本 GRUB Shell</a>。</li>
<li>在 GRUB Shell 中，使用 <code>setup_var 0x123 0x00</code>（其中 <code>0x123</code> 应该被替换为你在前几步找到的偏移值），然后重启电脑。</li>
</ol>
<p><strong>警告</strong>: 可变偏移量对于每个主板乃至每一个固件版本都是唯一的。永远不要尝试使用别人的偏移量！</p>
<h3 id="AppleXcpmCfgLock"><code>AppleXcpmCfgLock</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 禁用 XNU 内核对 <code>PKG_CST_CONFIG_CONTROL</code> (<code>0xE2</code>) 修改，从而避免早期 Kernel Panic。</p>
<p><em>注</em>：这一选项应该避免被使用，请参考上文中关于 <code>AppleCpuPmCfgLock</code> 的介绍。</p>
<h3 id="AppleXcpmExtraMsrs"><code>AppleXcpmExtraMsrs</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 对于没有 XCMP 支持的设备，禁用对选定 CPU 的多 MSR 访问。</p>
<p>通常将其与 Haswell-E，Broadwell-E，Skylake-SP 和类似 CPU 的 <code>Emulate</code> 结合使用。更多关于 XCPM 修补的信息可以在 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/bugtracker/issues/365">acidanthera/bugtracker#365</a> 找到。</p>
<p><em>注</em>：Ivy Bridge 或 Pentium CPU 将需要其他未提供的补丁。建议对前者使用 <code>AppleIntelCpuPowerManagement.kext</code>。</p>
<h3 id="AppleXcpmForceBoost"><code>AppleXcpmForceBoost</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 在 XCPM 模式下强制使用最大性能。</p>
<p>该补丁将 <code>0xFF00</code> 写入 <code>MSR_IA32_PERF_CONTROL</code> (<code>0x199</code>)，有效地做到了一直保持最大倍数。</p>
<p><em>注</em>：尽管有助于提高性能，但是在所有操作系统上都强烈建议不要启用这一选项。只有在某些 Xeon 型号的 CPU 才有可能从这个选项中受益。</p>
<h3 id="CustomSMBIOSGuid"><code>CustomSMBIOSGuid</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 对 UpdateSMBIOSMode 自定义模式执行 GUID 修补，通常用于戴尔笔记本电脑。</p>
<h3 id="DisableIoMapper"><code>DisableIoMapper</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 禁用 XNU (VT-d) 中的 <code>IOMapper</code> 支持，这可能与固件的实现相冲突。</p>
<p><em>注</em>：相比直接在 ACPI 表中删除 <code>DMAR</code>，我们更推荐大家使用这一选项。这样不会破坏其他操作系统中的 VT-d 支持（总会有人需要用到的，对吧？）。</p>
<h3 id="DisableRtcChecksum"><code>DisableRtcChecksum</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 禁用 AppleRTC 初始校验和（<code>0x58</code> - <code>0x59</code>）写入。</p>
<p><em>注</em>：</p>
<ol>
<li>这个选项不能确保其他区域不被覆盖，如有需要，请使用 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/RTCMemoryFixup">RTCMemoryFixup</a>。</li>
<li>这个选项不能确保区域在固件阶段不被覆盖（例如 macOS bootloader）。如有需要，请参阅 <code>AppleRtc</code> 协议描述。</li>
</ol>
<h3 id="DummyPowerManagement"><code>DummyPowerManagement</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 禁用 <code>AppleIntelCpuPowerManagement</code>。</p>
<p><em>注</em>：这一选项旨在替代 <code>NullCpuPowerManagement.kext</code>，用于 macOS 中没有电源管理驱动程序的 CPU。</p>
<h3 id="ExternalDiskIcons"><code>ExternalDiskIcons</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 修补 <code>AppleAHCIPort.kext</code> 图标，使 macOS 将所有 AHCI 存储设备显示为内部硬盘。</p>
<p><em>注</em>：这一选项应尽量避免使用。现代固件通常情况下都是兼容的。</p>
<h3 id="IncreasePciBarSize"><code>IncreasePciBarSize</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 将 IOPCIFamily 中 32 位 PCI Bar 的大小从 1 GB 增加到 4 GB。</p>
<p><em>注</em>：你应该尽可能避免使用这一选项。通常这一选项只需要在配置错误或损坏的固件上开启。</p>
<blockquote>
<p>译者注：如果你的 BIOS 中存在 Above4GDecoding 选项，请直接在 BIOS 中启用。</p>
</blockquote>
<h3 id="LapicKernelPanic"><code>LapicKernelPanic</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 禁用 LAPIC 中断导致的 Kernal Panic。</p>
<blockquote>
<p>译者注：惠普电脑可能需要启用这一选项。</p>
</blockquote>
<h3 id="PanicNoKextDump"><code>PanicNoKextDump</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 在发生内核崩溃时阻止输出 Kext 列表，提供可供排错参考的崩溃日志。</p>
<h3 id="PowerTimeoutKernelPanic"><code>PowerTimeoutKernelPanic</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 修复 macOS Catalina 中由于设备电源状态变化超时而导致的内核崩溃。</p>
<p>macOS Catalina 新增了一项额外的安全措施，导致在电源切换超时的时候会出现 Kernel Panic。配置错误的硬件可能会因此出现问题（如数字音频设备）、有的时候会导致睡眠唤醒的问题。这一 Quirk 和引导参数 <code>setpowerstate_panic=0</code> 功能大部分一致，但是后者只应该用于调试用途。</p>
<h3 id="ThirdPartyDrives"><code>ThirdPartyDrives</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 修补 <code>IOAHCIDeleteStorage.kext</code>，以在第三方驱动器启用 TRIM、硬盘休眠等功能。</p>
<p><em>注</em>：NVMe SSD 通常无需这一修改。对于 AHCI SSD（如 SATA SSD），macOS 从 10.15 开始提供 <code>trimforce</code>，可以将 <code>01 00 00 00</code> 值写入 <code>APPLE_BOOT_VARIABLE_GUID</code> 命名空间中的 <code>EnableTRIM</code> 变量。</p>
<h3 id="XhciPortLimit"><code>XhciPortLimit</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 修补 <code>AppleUSBXHCI.kext</code>、<code>AppleUSBXHCIPCI.kext</code>、<code>IOUSBHostFamily.kext</code> 以移除 15 端口限制。</p>
<p><em>注</em>：请尽可能避免使用这一选项。USB 端口数量限制是由 locationID 格式使用的比特数决定的。真正长期有效的解决方案是限制可用的 USB 端口个数在 15 以下（通过 USB 定制的方法）。</p>
<h1>8. Misc</h1>
<hr>
<h2 id="8-1-Introduction">8.1 Introduction</h2>
<p>本部分包含关于 OpenCore 行为的其他配置，以及不能被分类到其它章节的配置条目的说明。</p>
<p>OpenCore 尽可能地遵循 <code>bless</code> 模式，即 <code>Apple Boot Policy</code>。<code>bless</code> 模式的主要特点是允许在文件系统中嵌入启动选项（而且能通过专门的驱动程序访问），同时，相比于 UEFI 规范中的可移动媒体列表，它还支持更多的预定义启动路径。</p>
<p>只有当分区符合 <code>Scan policy</code> 时才能被启动（<code>Scan policy</code> 是一组限制条件，能够使其仅使用特定文件系统和特定设备类型的分区）。具体的扫描策略（<code>Scan policy</code>）将在下面的 <code>ScanPolicy</code> 属性中阐述。</p>
<p>扫描过程从获取 <code>Scan policy</code> 过滤过的分区开始。每个分区可能会产生多个主选项和备用选项。主选项描述的是安装在这个介质上的操作系统。备用选项描述的是介质上的操作系统的恢复项。备用选项可以在没有主选项的情况下存在，反之亦然。请注意，这些选项描述的操作系统不一定都在同一个分区上。每个主选项和备用选项都可以作为辅助选项（Auxiliary Option），也可以不作为辅助选项，具体细节参考下面的 <code>HideAuxiliary</code> 章节。用来确定启动选项的算法如下：</p>
<ol>
<li>通过 <code>Scan policy</code>（和驱动可用性）过滤，获取所有可用的分区句柄。</li>
<li>从 <code>BootOrder</code> UEFI 变量中，获取所有可用的启动选项。</li>
<li>对于每个找到的启动选项：</li>
</ol>
<ul>
<li>检索该启动选项的设备路径。</li>
<li>执行对设备路径的修复（如 NVMe 子类型修复）和扩展（如 Boot Camp）。</li>
<li>通过定位到所产生的设备路径，来获取句柄（失败时忽略）。</li>
<li>在分区句柄列表中找到设备句柄（缺失时忽略）。</li>
<li>对磁盘设备路径（不指定引导程序）执行 <code>bless</code>（可能返回不止一个条目）。</li>
<li>对文件设备路径直接检查其文件系统。</li>
<li>排除所有带有黑名单文件名的选项（参考 <code>BlacklistAppleUpdate</code> 选项）。</li>
<li>在 OpenCore 启动分区中，通过 Header Check 排除所有 OpenCore Bootstrap 文件。</li>
<li>如果有分区句柄列表，则在列表中将设备句柄标记为 <em>used</em>。</li>
<li>将生成的条目注册为主选项，并确定他们的类型。某些类型的选项作为辅助选项（如 Apple HFS Recovery）。</li>
</ul>
<ol start="4">
<li>对于每个分区句柄：</li>
</ol>
<ul>
<li>如果分区句柄被标记为 <em>unused</em>，则执行 <code>bless</code> 主选项列表检索。如果设置了 <code>BlessOverride</code> 列表，那么不仅能找到标准的 <code>bless</code> 路径，还能找到自定义的路径。</li>
<li>排除带有黑名单文件名的选项（参考 <code>BlacklistAppleUpdate</code> 选项）。</li>
<li>在 OpenCore 启动分区中，通过 Header Check 排除所有 OpenCore Bootstrap 文件。</li>
<li>将生成的条目注册为主选项，并确定他们的类型。某些类型的选项作为辅助选项（如 Apple HFS Recovery）。</li>
<li>如果分区已经具有来 <code>Apple Recovery</code> 类型的主选项，则继续处理下一个句柄。</li>
<li>通过 <code>bless</code> 恢复选项列表检索和预定义路径，来查找备用条目。</li>
<li>将生成的条目注册为备用辅助选项，并确定它们的类型。</li>
</ul>
<ol start="5">
<li>把自定义条目和工具添加为主选项，不做有关 <code>Auxiliary</code> 的任何检查。</li>
<li>把系统条目（如 <code>Reset NVRAM</code>）添加为主要的辅助选项。</li>
</ol>
<p>启动选择器中的启动选项的显示顺序和启动过程，是通过扫描算法分别来确定的。显示顺序如下：</p>
<ul>
<li>备用选项跟随主选项，即，Apple Recovery 会尽可能地跟随相关的 macOS 选项。</li>
<li>选项会按照文件系统句柄固件的顺序列出，以便在整个启动过程中保持一个既定的顺序，不因加载操作系统的不同而变化。</li>
<li>自定义条目、工具和系统条目会被添加到所有选项之后。</li>
<li>辅助选项只有在进入「高级模式」后才会显示（一般是按 <code>空格</code> 键）。</li>
</ul>
<p>启动过程如下：</p>
<ul>
<li>尝试通过 <code>BootNext</code> UEFI 变量查找第一个有效的主选项。</li>
<li>如果失败，则通过 <code>BootOrder</code> UEFI 变量继续查找。</li>
<li>将该选项标记为默认启动选项。</li>
<li>是否通过启动选择器来启动选项，取决于 <code>ShowPicker</code> 选项的设置。</li>
<li>如果还失败，则显示启动选择器。</li>
</ul>
<p><em>注 1</em>：这个过程只有在启用了 <code>RequestBootVarRouting</code> 选项，或者固件不控制 UEFI 启动选项（如 <code>OpenDuetPkg</code> 或其他自定义 BDS）时，才会可靠地工作。如果不启用 <code>BootProtect</code>，那么其他操作系统有可能会覆盖 OpenCore，如果你打算使用 OpenCore，请确保启用这个选项。</p>
<p><em>注 2</em>：UEFI 变量引导选项的引导参数，如果存在的话则会被丢弃，因为它们包含的一些参数可能会对操作系统产生不利影响，一旦启用了安全引导，这种影响是我们不希望看到的。</p>
<p><em>注 3</em>：某些操作系统（说的就是你，Windows）会在第一次启动时，或 NVRAM 重置后，创建他们的启动选项，并将其标记为最上面的选项。这种情况发生时，默认的启动条目选择将会更新，直到下一次重新手动配置。</p>
<h2 id="8-2-Properties">8.2 Properties</h2>
<h3 id="Boot"><code>Boot</code></h3>
<p><strong>Type</strong>: <code>plist dict</code><br>
<strong>Description</strong>: 应用本章节 Boot Properties 中的引导相关设置。</p>
<h3 id="BlessOverride"><code>BlessOverride</code></h3>
<p><strong>Type</strong>: <code>plist array</code><br>
<strong>Description</strong>: 通过 Bless Model 添加自定义扫描路径。</p>
<p>设计为填充 <code>plist string</code> 条目，其中包含指向自定义引导程序的绝对 UEFI 路径，例如，用于 Microsoft 引导程序的 <code>\EFI\Microsoft\Boot\bootmgfw.efi</code>。这允许引导选择器自动发现异常的引导路径。在设计上它们等效于预定义的 Bless 路径（如 <code>\System\Library\CoreServices\boot.efi</code>），但与预定义的 Bless 路径不同，它们具有最高优先级。</p>
<h3 id="Debug"><code>Debug</code></h3>
<p><strong>Type</strong>: <code>plist dict</code><br>
<strong>Description</strong>: 应用本章节 Debug Properties 中的调试相关设置。</p>
<h3 id="Entries"><code>Entries</code></h3>
<p><strong>Type</strong>: <code>plist array</code><br>
<strong>Description</strong>: 在开机引导菜单中添加引导项。</p>
<p>应填入 <code>plist dict</code> 类型的值来描述相应的加载条目。详见 Entry Properties 部分。</p>
<h3 id="Security"><code>Security</code></h3>
<p><strong>Type</strong>: <code>plist dict</code><br>
<strong>Description</strong>: 应用本章节 Security Properties 中的安全相关设置。</p>
<h3 id="Tools"><code>Tools</code></h3>
<p><strong>Type</strong>: <code>plist array</code><br>
<strong>Description</strong>: 将工具条目添加到开机引导菜单。</p>
<p>应填入 <code>plist dict</code> 类型的值来描述相应的加载条目。详见 Entry Properties 部分。</p>
<p><em>注</em>：选择工具（比如 UEFI shell）是很危险的事情，利用这些工具可以轻易地绕过安全启动链，所以<strong>千万不要</strong>出现在产品配置中，尤其是设置了 vault 和安全启动保护的设备（译者注：即，工具仅作调试用）。</p>
<h2 id="8-3-Boot-Properties">8.3 Boot Properties</h2>
<h3 id="ConsoleAttributes"><code>ConsoleAttributes</code></h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: 为控制台设置特定的属性。</p>
<p>根据 UEFI 规范，文本渲染器支持的颜色参数为前景色与背景色之和。黑色背景色和黑色前景色 (<code>0</code>) 的值是预留的。以下是颜色名称一览：</p>
<ul>
<li><code>0x00</code> — <code>EFI_BLACK</code>（黑色字体）</li>
<li><code>0x01</code> — <code>EFI_BLUE</code>（蓝色字体）</li>
<li><code>0x02</code> — <code>EFI_GREEN</code>（绿色字体）</li>
<li><code>0x03</code> — <code>EFI_CYAN</code>（青色字体）</li>
<li><code>0x04</code> — <code>EFI_RED</code>（红色字体）</li>
<li><code>0x05</code> — <code>EFI_MAGENTA</code>（紫色字体）</li>
<li><code>0x06</code> — <code>EFI_BROWN</code>（棕色字体）</li>
<li><code>0x07</code> — <code>EFI_LIGHTGRAY</code>（亮灰色字体）</li>
<li><code>0x08</code> — <code>EFI_DARKGRAY</code>（暗灰色字体）</li>
<li><code>0x09</code> — <code>EFI_LIGHTBLUE</code>（淡蓝色字体）</li>
<li><code>0x0A</code> — <code>EFI_LIGHTGREEN</code>（淡绿色字体）</li>
<li><code>0x0B</code> — <code>EFI_LIGHTCYAN</code>（淡青色字体）</li>
<li><code>0x0C</code> — <code>EFI_LIGHTRED</code>（淡红色字体）</li>
<li><code>0x0D</code> — <code>EFI_LIGHTMAGENTA</code>（淡紫色字体）</li>
<li><code>0x0E</code> — <code>EFI_YELLOW</code>（黄色字体）</li>
<li><code>0x0F</code> — <code>EFI_WHITE</code>（白色字体）</li>
<li><code>0x00</code> — <code>EFI_BACKGROUND_BLACK</code>（黑色背景）</li>
<li><code>0x10</code> — <code>EFI_BACKGROUND_BLUE</code>（蓝色背景）</li>
<li><code>0x20</code> — <code>EFI_BACKGROUND_GREEN</code>（绿色背景）</li>
<li><code>0x30</code> — <code>EFI_BACKGROUND_CYAN</code>（青色背景）</li>
<li><code>0x40</code> — <code>EFI_BACKGROUND_RED</code>（红色背景）</li>
<li><code>0x50</code> — <code>EFI_BACKGROUND_MAGENTA</code>（紫色背景）</li>
<li><code>0x60</code> — <code>EFI_BACKGROUND_BROWN</code>（棕色背景）</li>
<li><code>0x70</code> — <code>EFI_BACKGROUND_LIGHTGRAY</code>（亮灰色背景）</li>
</ul>
<p><em>注</em>：这个选项可能和 TextRenderer 的 <code>System</code> 参数有冲突，设置一个非黑的背景可以用来测试 GOP 是否正常运行。</p>
<h3 id="HibernateMode"><code>HibernateMode</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: <code>None</code><br>
<strong>Description</strong>: 休眠检测模式。 支持以下模式：</p>
<ul>
<li><code>None</code> — 禁用休眠</li>
<li><code>Auto</code> — 从 RTC 或 NVRAM 中检测</li>
<li><code>RTC</code> — 从 RTC 检测</li>
<li><code>NVRAM</code> — 从 NVRAM 检测</li>
</ul>
<h3 id="HideAuxiliary"><code>HideAuxiliary</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 默认情况下，隐藏开机引导项菜单中的辅助条目。</p>
<p>满足任一以下条件的引导项条目即会被视为「辅助项目」</p>
<ul>
<li>该引导项是 macOS Recovery 分区</li>
<li>该引导项是 macOS Time Machine 分区</li>
<li>该引导项被标记为 <code>Auxiliary</code></li>
<li>该引导项是一个系统（如 <code>Clean NVRAM</code>）</li>
</ul>
<p>即使被隐藏，你仍然可以通过 <code>空格</code> 进入「扩展模式」查看所有条目（引导项菜单会被重新加载）：</p>
<p>一般的，隐藏辅助条目有助于加快启动速度。</p>
<h3 id="HideSelf"><code>HideSelf</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 在 OpenCore 的启动选择中隐藏自身 EFI 分区内的其它启动项，如 UEFI OS 等、Recovery、Reset NVRAM 等。</p>
<h3 id="PickerAttributes"><code>PickerAttributes</code></h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: 设置开机引导菜单的属性。</p>
<p>不同的选项可以用属性掩码的方式来设置，其中掩码包含 OpenCore 的预留值（<code>BIT0</code> ~ <code>BIT15</code>）和 OEM 特定值（<code>BIT16</code> ~ <code>BIT31</code>）。</p>
<p>目前 OpenCore 提供的值包括：</p>
<ul>
<li><code>0x0001</code> — <code>OC_ATTR_USE_VOLUME_ICON</code>，提供引导项自定义图标：
<ul>
<li><code>.VolumeIcon.icns</code> 文件，位于 APFS <code>Preboot</code> 根目录下。</li>
<li><code>.VolumeIcon.icns</code> 文件，位于其他文件系统的卷宗的根目录下。</li>
<li><code>&lt;TOOL_NAME&gt;.icns</code> 文件，用来显示 <code>Tools</code> 图标。</li>
</ul>
</li>
</ul>
<p>卷宗图标可以在访达中设置。注意，启用此功能可能会导致 外部可移除硬盘的图标 和 内部不可移除硬盘的图标 无法区分。</p>
<ul>
<li><code>0x0002</code> — <code>OC_ATTR_USE_DISK_LABEL_FILE</code>，提供引导项自定义渲染的标题：
<ul>
<li><code>.disk_label</code> (<code>.disk_label_2x</code>) 文件与 bootloader 相关，适用于所有文件系统。</li>
<li><code>&lt;TOOL_NAME.lbl</code> (<code>&lt;TOOL_NAME.l2x</code>) 文件与工具相关，适用于 <code>Tools</code>。</li>
</ul>
</li>
</ul>
<p>可用 <code>disklabel</code> 实用工具或 <code>bless</code> 命令来生成预置标签。当禁用或者缺少文本标签 (<code>.contentDetails</code> or <code>.disk_label.contentDetails</code>) 时将以它来代替渲染。</p>
<ul>
<li><code>0x0004</code> — <code>OC_ATTR_USE_GENERIC_LABEL_IMAGE</code>，为没有自定义条目的启动项提供预定义的标签图像。可能会缺少实际启动项的详细信息。</li>
</ul>
<h3 id="PickerAudioAssist"><code>PickerAudioAssist</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 在开机引导菜单中启用 屏幕朗读。</p>
<p>macOS Bootloader 屏幕朗读 的偏好设置是存在 <code>isVOEnabled.int32</code> 文件的 <code>preferences.efires</code> 中、并受操作系统控制。这里仅提供一个等效的开关。切换 OpenCore 开机引导菜单和 macOS BootLoader FileVault 2 登录界面也可以使用快捷键 <code>Command</code> + <code>F5</code>。</p>
<p><em>注</em>：屏幕朗读 依赖可以正常工作的音频设备。</p>
<h3 id="PollAppleHotKeys"><code>PollAppleHotKeys</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 在开机引导菜单中启用 <code>modifier hotkey</code>。</p>
<p>除了 <code>action hotkeys</code>（在 <code>PickerMode</code> 一节中有所描述，由 Apple BDS 处理），还有由操作系统 bootloader 处理的修饰键，即 <code>boot.efi</code>。这些键可以通过提供不同的启动模式来改变操作系统的行为。</p>
<p>在某些固件上，由于驱动程序不兼容，使用修饰键可能会有问题。为了解决问题，这个选项允许你在启动选择器中以更宽松的方式注册选择的热键，比如：在按住 <code>Shift</code> 和其他按键的同时支持敲击按键，而不是只按 <code>Shift</code>，这在许多 PS/2 键盘上是无法识别的。已知的 <code>modifier hotkeys</code> 包括：</p>
<ul>
<li><code>CMD+C+MINUS</code> — 禁用主板兼容性检查。</li>
<li><code>CMD+K</code> — 从 release 版本的内核启动，类似于 <code>kcsuffix=release</code> 参数。</li>
<li><code>CMD+R</code> — 从恢复分区启动。</li>
<li><code>CMD+S</code> — 启动至单用户模式。</li>
<li><code>CMD+S+MINUS</code> — 禁用 KASLR slide，需要事先禁用 SIP。</li>
<li><code>CMD+V</code> — 启用 <code>-v</code>。</li>
<li><code>Shift</code> — 启用安全模式。</li>
</ul>
<h3 id="ShowPicker"><code>ShowPicker</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 是否显示开机引导菜单。</p>
<h3 id="TakeoffDelay"><code>TakeoffDelay</code></h3>
<p><strong>Type</strong>: <code>plist integer</code>, 32 bit<br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: 在 处理引导项启动 和 处理 <code>action hotkeys</code> 之前的延迟，以微秒为单位。</p>
<p>引入这一延迟有助于为你争取时间去完成按住 <code>action hotkey</code> 的操作，比如启动到恢复模式。在某些平台上，可能需要把此项设置为至少 <code>5000-10000</code> 来使 <code>action hotkeys</code> 生效，具体取决于键盘驱动程序的性质。</p>
<h3 id="Timeout"><code>Timeout</code></h3>
<p><strong>Type</strong>: <code>plist integer</code>, 32 bit<br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: 开机引导菜单中，启动默认启动项之前超时时间（以秒为单位）。 使用 <code>0</code> 禁用倒计时。</p>
<blockquote>
<p>译者注：<code>0</code> 为关闭倒计时而非跳过倒计时，相当于 Clover 的 <code>-1</code>。</p>
</blockquote>
<h3 id="PickerMode"><code>PickerMode</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: <code>Builtin</code><br>
<strong>Description</strong>: 选择启动管理器的界面。</p>
<p>这里描述的是具有可选用户界面的底层启动管理器，支持以下值：</p>
<ul>
<li><code>Builtin</code> — 使用由 OpenCore 处理的启动管理器，简单的文本用户界面。</li>
<li><code>External</code> — 如果可用，则使用外部启动管理器协议，否则使用 <code>Builtin</code> 模式。</li>
<li><code>Apple</code> — 如果可用，则使用 Apple 启动管理器，否则使用 <code>Builtin</code> 模式。</li>
</ul>
<p><code>External</code> 模式一旦成功，就会完全禁用 OpenCore 中的除策略强制执行的所有其他启动管理器，而 <code>Apple</code> 模式下可以绕过策略的强制执行。请参阅 <code>ueficanopy</code> 插件以了解自定义用户界面的实例。</p>
<p>OpenCore 内置的启动选择器包含了一系列在启动过程中选择的操作。支持的操作与 Apple BDS 类似，一般来说能够通过在启动过程中按住 <code>action hotkeys</code> 来实现，目前有以下几种：</p>
<ul>
<li><code>Default</code> — 此项为默认选项，可以让 OpenCore 内置的启动选择器按照 <a target="_blank" rel="noopener" href="https://support.apple.com/HT202796">启动磁盘</a> 偏好设置中指定的方式加载默认的启动项。</li>
<li><code>ShowPicker</code> — 此项会强制显示启动选择器，通常可以在启动时按住 <code>OPT</code> 键来实现。将 <code>ShowPicker</code> 设置为 <code>true</code> 会使 <code>ShowPicker</code> 成为默认选项。</li>
<li><code>ResetNvram</code> — 此项会擦除 UEFI 变量，通常是在启动时按住 <code>CMD+OPT+P+R</code> 组合键来实现。另一种擦除 UEFI 变量的方法是在选择器中选择 <code>Reset NVRAM</code>，要使用这种方式需要将 <code>AllowNvramReset</code> 设置为 <code>true</code>。</li>
<li><code>BootApple</code> — 此项会启动到第一个找到的 Apple 操作系统，除非 Apple 已经默认选择了操作系统。按住 <code>X</code> 来选择此选项。</li>
<li><code>BootAppleRecovery</code> — 此项会启动到 Apple 操作系统的恢复系统。这里的系统要么是「与默认选中的操作系统相关的恢复系统」，要么是「第一个找到的非 Apple 的默认操作系统的恢复系统」，要么是「无恢复系统」。按住 <code>CMD+R</code> 组合键来选择此选项。</li>
</ul>
<p><em>注 1</em>：需要激活 <code>KeySupport</code>、<code>OpenUsbKbDxe</code> 或类似的驱动程序才能工作。无法获得全部按键功能的固件有很多。</p>
<p><em>注 2</em>：当禁用 <code>ShowPicker</code> 时，除了 <code>OPT</code> 键之外，OpenCore 还支持 <code>Escape</code> 键来显示启动选项。这个键不仅适用于 <code>Apple</code> 启动选择器模式，也适用于 PS/2 键盘的固件，因为这种键盘无法提交按住 <code>OPT</code> 键的请求，需要连续点按 <code>Escape</code> 键来进入启动选择菜单。</p>
<p><em>注 3</em>：有些 Mac 的 GOP 很棘手，可能很难进入 Apple 启动选择器。要解决这个问题，可以在不加载 GOP 的情况下 bless OpenCore 的 <code>BootKicker</code> 实用工具。</p>
<h2 id="8-4-Debug-Properties">8.4 Debug Properties</h2>
<h3 id="AppleDebug"><code>AppleDebug</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 启用将 <code>boot.efi</code> 调试日志保存到 OpenCore 日志。</p>
<p><em>注</em>：此项仅适用于 10.15.4 和更新版本。</p>
<h3 id="ApplePanic"><code>ApplePanic</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 将 macOS Kernel Panic 保存到 OpenCore 根分区。</p>
<p>保存的文件为 <code>panic-YYYY-MM-DD-HHMMSS.txt</code>。强烈建议使用 <code>keepsyms=1</code> 引导参数来查看 Panic 日志中的调试符号。如果没有，可以用 <code>kpdescribe.sh</code> 实用程序（OpenCore 绑定）来部分恢复堆栈跟踪。</p>
<p>开发者内核和调试内核会产生更有用的 Kernel Panic。调试的时候，可以考虑从 <a target="_blank" rel="noopener" href="https://developer.apple.com">developer.apple.com</a> 下载并安装 <code>KernelDebugKit</code>。如果要激活开发者内核，需要添加一个 <code>kcsuffix=development</code> 引导参数。使用 <code>uname -a</code> 命令来确保你当前加载的内核是一个开发者（或调试）内核。</p>
<p>如果没有实用 OpenCore 的 Kernel Panic 保存机制，仍然可以在 <code>/Library/Logs/DiagnosticReports</code> 目录下找到 Panic 日志。从 macOS Catalina 开始，Kernel Panic 会以 JSON 格式储存，所以在传递给 <code>kpdescribe.sh</code> 之前需要预处理：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat Kernel.panic | grep macOSProcessedStackshotData | python -c <span class="string">&#x27;import json,sys;print(json.load(sys.stdin)[&quot;macOSPanicString&quot;])&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="DisableWatchDog"><code>DisableWatchDog</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 某些固件可能无法成功快速启动操作系统，尤其是在调试模式下，这会导致看门狗定时器中止引导过程。此选项关闭看门狗定时器，用于排错。</p>
<h3 id="DisplayDelay"><code>DisplayDelay</code></h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: 屏幕上打印每行输出之间的延迟。</p>
<h3 id="3-DisplayLevel">3.<code>DisplayLevel</code></h3>
<p><strong>Type</strong>: <code>plist integer</code>, 64 bit<br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: 与屏幕显示相关的 EDK II 调试级别的位掩码（总和）。除非 <code>Target</code> 启用了控制台在屏幕上输出日志，否则屏幕上的调试输出将不可见。支持以下级别（更多信息参见 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/audk/blob/master/MdePkg/Include/Library/DebugLib.h">DebugLib.h</a>）：</p>
<ul>
<li><code>0x00000002</code> (bit <code>1</code>) — <code>DEBUG_WARN</code> in <code>DEBUG</code>, <code>NOOPT</code>, <code>RELEASE</code>.</li>
<li><code>0x00000040</code> (bit <code>6</code>) — <code>DEBUG_INFO</code> in <code>DEBUG</code>, <code>NOOPT</code>.</li>
<li><code>0x00400000</code> (bit <code>22</code>) — <code>DEBUG_VERBOSE</code> in custom builds.</li>
<li><code>0x80000000</code> (bit <code>31</code>) — <code>DEBUG_ERROR</code> in <code>DEBUG</code>, <code>NOOPT</code>, <code>RELEASE</code>.</li>
</ul>
<h3 id="Target"><code>Target</code></h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: 启用日志记录目标的位掩码（总和）。默认所有日志的输出都是隐藏的，所以当需要调试时，有必要设置这个选项。</p>
<p>支持以下日志记录目标：</p>
<ul>
<li><code>0x01</code> (bit <code>0</code>) — 启用日志记录，否则所有日志都会被丢弃</li>
<li><code>0x02</code> (bit <code>1</code>) — 在屏幕上输出日志</li>
<li><code>0x04</code> (bit <code>2</code>) — 启用把日志记录到 Data Hub</li>
<li><code>0x08</code> (bit <code>3</code>) — 启用串行端口记录</li>
<li><code>0x10</code> (bit <code>4</code>) — 启用 UEFI 变量记录</li>
<li><code>0x20</code> (bit <code>5</code>) — 启用非易失性 UEFI 变量记录</li>
<li><code>0x40</code> (bit <code>6</code>) — 启用在 ESP 分区生成日志文件</li>
</ul>
<p>控制台日志会比其他日志少，根据 build 类型（<code>RELEASE</code>、<code>DEBUG</code> 或 <code>NOOPT</code>）的不同，读取到的日志量也会不同（从最少到最多）。</p>
<p>Data Hub 日志中不包括 Kernel 和 Kext 的日志。要获取 Data Hub 日志，请使用 ioreg：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ioreg -lw0 -p IODeviceTree | grep boot-log | sort | sed &#39;s&#x2F;.*&lt;\(.*\)&gt;.*&#x2F;\1&#x2F;&#39; | xxd -r -p</span><br></pre></td></tr></table></figure>
<p>UEFI 变量日志中不包含某些信息，也没有性能数据。为了安全起见，日志大小被限制在 32 KB。有些固件可能会提前截断它，或者在它无内存时完全删除它。使用非易失性 flag 将会在每打印一行后把日志写入 NVRAM 闪存。如要获取 UEFI 变量日志，请在 macOS 中使用以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvram 4D1FDA02-38C7-4A6A-9CC6-4BCCA8B30102:boot-log | awk &#39;&#123;gsub(&#x2F;%0d%0a%00&#x2F;,&quot;&quot;);gsub(&#x2F;%0d%0a&#x2F;,&quot;\n&quot;)&#125;1&#39;</span><br></pre></td></tr></table></figure>
<p><em>警告</em>：有些固件的 NVRAM 垃圾收集据说存在问题，它们可能无法做到在每次变量删除后都释放空间。在这类设备上，没有额外需要的话，请不要使用非易失性 NVRAM 日志。</p>
<p>虽然 OpenCore 的引导日志已经包含了基本的版本信息（包括 build 类型和日期），但即使在禁用引导日志的情况下，这些数据也可以在 NVRAM 中的 <code>opencore-version</code> 变量中找到。</p>
<p>文件记录会在 EFI 卷宗的根目录下创建一个名为 <code>opencore-YYYY-MM-DD-HHMMSS.txt</code> 的文件，其中包含了日志的内容（大写字母部分会被替换为固件中的日期和时间）请注意，固件中的一些文件系统驱动程序不可靠，并且可能会通过 UEFI 写入文件时损坏数据。日志是尝试用最安全的方式来写入的，因此速度很慢。当你使用慢速硬盘时，请确保已将 <code>DisableWatchDog</code> 设置为 <code>true</code>。</p>
<p>When interpreting the log, note that the lines are prefixed with a tag describing the relevant location (module) of the log line allowing one to better attribute the line to the functionality. The list of currently used tags is provided below.</p>
<p><strong>Drivers and tools</strong>:</p>
<ul>
<li><code>BMF</code> — OpenCanopy, bitmap font</li>
<li><code>BS</code> — Bootstrap</li>
<li><code>GSTT</code> — GoptStop</li>
<li><code>HDA</code> — AudioDxe</li>
<li><code>KKT</code> — KeyTester</li>
<li><code>MMDD</code> — MmapDump</li>
<li><code>OCPAVP</code> — PavpProvision</li>
<li><code>OCRST</code> — ResetSystem</li>
<li><code>OCUI</code> — OpenCanopy</li>
<li><code>OC</code> — OpenCore main</li>
</ul>
<p><strong>Libraries</strong>:</p>
<ul>
<li><code>AAPL</code> — OcDebugLogLib, Apple EfiBoot logging</li>
<li><code>OCABC</code> — OcAfterBootCompatLib</li>
<li><code>OCAE</code> — OcAppleEventLib</li>
<li><code>OCAK</code> — OcAppleKernelLib</li>
<li><code>OCAU</code> — OcAudioLib</li>
<li><code>OCAV</code> — OcAppleImageVerificationLib</li>
<li><code>OCA</code> —- OcAcpiLib</li>
<li><code>OCBP</code> — OcAppleBootPolicyLib</li>
<li><code>OCB</code> — OcBootManagementLib</li>
<li><code>OCCL</code> — OcAppleChunkListLib</li>
<li><code>OCCPU</code> — OcCpuLib</li>
<li><code>OCC</code> — OcConsoleLib</li>
<li><code>OCDH</code> — OcDataHubLib</li>
<li><code>OCDI</code> — OcAppleDiskImageLib</li>
<li><code>OCFSQ</code> — OcFileLib, UnblockFs quirk</li>
<li><code>OCFS</code> — OcFileLib</li>
<li><code>OCFV</code> — OcFirmwareVolumeLib</li>
<li><code>OCHS</code> — OcHashServicesLib</li>
<li><code>OCIC</code> — OcImageConversionLib</li>
<li><code>OCII</code> — OcInputLib</li>
<li><code>OCJS</code> — OcApfsLib</li>
<li><code>OCKM</code> — OcAppleKeyMapLib</li>
<li><code>OCL</code> — OcDebugLogLib</li>
<li><code>OCMCO</code> — OcMachoLib</li>
<li><code>OCME</code> — OcHeciLib</li>
<li><code>OCMM</code> — OcMemoryLib</li>
<li><code>OCPI</code> — OcFileLib, partition info</li>
<li><code>OCPNG</code> — OcPngLib</li>
<li><code>OCRAM</code> — OcAppleRamDiskLib</li>
<li><code>OCRTC</code> — OcRtcLib</li>
<li><code>OCSB</code> — OcAppleSecureBootLib</li>
<li><code>OCSMB</code> — OcSmbiosLib</li>
<li><code>OCSMC</code> — OcSmcLib</li>
<li><code>OCST</code> — OcStorageLib</li>
<li><code>OCS</code> — OcSerializedLib</li>
<li><code>OCTPL</code> — OcTemplateLib</li>
<li><code>OCUC</code> — OcUnicodeCollationLib</li>
<li><code>OCUT</code> — OcAppleUserInterfaceThemeLib</li>
<li><code>OCXML</code> — OcXmlLib</li>
</ul>
<h2 id="8-5-Security-Properties">8.5 Security Properties</h2>
<h3 id="AllowNvramReset"><code>AllowNvramReset</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 启用这一选项后将允许使用 <code>CMD+OPT+P+R</code> 快捷键重置 NVRAM，同时 <code>NVRAM Reset</code> 条目也会出现在开机引导菜单中。</p>
<h3 id="AllowSetDefault"><code>AllowSetDefault</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 允许使用 <code>CTRL+Enter</code> 和 <code>CTRL+[数字]</code> 设置默认启动项。</p>
<h3 id="AuthRestart"><code>AuthRestart</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 启用与 <code>VirtualSMC</code> 兼容的 authenticated restart.</p>
<p>authenticated restart 可以在重启 FileVault2 分区时不用再次输入密码。你可以使用下述指令执行一次 authenticated restart：<code>sudo fdesetup authrestart</code>。macOS 在安装系统更新使用的也是 authenticated restart。</p>
<p>VirtualSMC 通过将磁盘加密密钥拆分保存在 NVRAM 和 RTC 中来执行 authenticated restart。虽然 OpenCore 在启动系统后立刻删除密钥，但是这仍然可能被视为安全隐患。</p>
<h3 id="BootProtect"><code>BootProtect</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: <code>None</code><br>
<strong>Description</strong>: 该选项试图保证 Bootloader 的持久性、一致性。</p>
<p>可以使用的值有：</p>
<ul>
<li><code>None</code>: 什么都不做</li>
<li><code>Bootstrap</code>: 在启动引导程序时，在 UEFI 变量存储中创建或更新最高优先级  <code>\EFI\OC\Bootstrap\Bootstrap.efi</code> 引导选项 (<code>Boot9696</code>)。要使用这个选项，必须同时开启 <code>RequestBootVarRouting</code>。</li>
</ul>
<p>在安装和升级第三方操作系统时 <code>\EFI\BOOT\BOOTx64.efi</code> 文件可能会被覆盖掉，该选项则保证了出现覆盖情况时 Bootloader 的一致性。在 <code>Bootstrap</code> 模式下创建一个自定义启动项后，<code>\EFI\BOOT\BOOTx64.efi</code> 这个文件路径将不再用于引导 OpenCore。</p>
<p><em>注 1</em>：某些固件的 NVRAM 本身存在问题，可能会出现无启动项支持，或者其他各种不兼容的情况。虽然可能性不大，但使用此选项可能会导致启动失败。请在已知兼容的主板上使用，风险自行考虑。</p>
<p><em>注 2</em>：请注意，NVRAM 重置也会同时清除 <code>Bootstrap</code> 模式下创建的启动选项。</p>
<h3 id="ExposeSensitiveData"><code>ExposeSensitiveData</code></h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: <code>0x6</code><br>
<strong>Description</strong>: 用于向操作系统暴露敏感数据的位掩码（总和）。</p>
<ul>
<li><code>0x01</code> — 将可打印的引导器路径作为 UEFI 变量暴露出来</li>
<li><code>0x02</code> — 将 OpenCore 版本作为 UEFI 变量暴露出来</li>
<li><code>0x04</code> — 将 OpenCore 版本暴露在启动选择菜单的标题位置</li>
<li><code>0x08</code> — 将 OEM 信息作为一组 UEFI 变量暴露出来</li>
</ul>
<p>根据加载顺序，暴露的启动器路径指向 OpenCore.efi 或其引导器。如要获得引导器路径，请在 macOS 中使用以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvram 4D1FDA02-38C7-4A6A-9CC6-4BCCA8B30102:boot-path</span><br></pre></td></tr></table></figure>
<p>如要使用启动器路径加载启动器卷宗，请在 macOS 中使用以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">u&#x3D;$(nvram 4D1FDA02-38C7-4A6A-9CC6-4BCCA8B30102:boot-path | sed &#39;s&#x2F;.*GPT,\([^,]*\),.*&#x2F;\1&#x2F;&#39;); \</span><br><span class="line">if [ &quot;$u&quot; !&#x3D; &quot;&quot; ]; then sudo diskutil mount $u ; fi</span><br></pre></td></tr></table></figure>
<p>如要获取 OpenCore 版本信息，请在 macOS 中使用以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvram 4D1FDA02-38C7-4A6A-9CC6-4BCCA8B30102:opencore-version</span><br></pre></td></tr></table></figure>
<p>如要获取 OEM 信息，请在 macOS 中使用以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nvram 4D1FDA02-38C7-4A6A-9CC6-4BCCA8B30102:oem-product # SMBIOS Type1 ProductName</span><br><span class="line">nvram 4D1FDA02-38C7-4A6A-9CC6-4BCCA8B30102:oem-vendor # SMBIOS Type2 Manufacturer</span><br><span class="line">nvram 4D1FDA02-38C7-4A6A-9CC6-4BCCA8B30102:oem-board # SMBIOS Type2 ProductName</span><br></pre></td></tr></table></figure>
<h3 id="HaltLevel"><code>HaltLevel</code></h3>
<p><strong>Type</strong>: <code>plist integer</code>, 64 bit<br>
<strong>Failsafe</strong>: <code>0x80000000</code> (<code>DEBUG_ERROR</code>)<br>
<strong>Description</strong>: EDK II 调试级别的位掩码（总和），使 CPU 在获得 <code>HaltLevel</code> 消息后中止（停止执行）。可能的值与 <code>DisplayLevel</code> 值相匹配。</p>
<h3 id="Vault"><code>Vault</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: <code>Secure</code><br>
<strong>Description</strong>: 启用 OpenCore 的 vault 机制。</p>
<p>有效值：</p>
<ul>
<li><code>Optional</code> — 无要求，vault 不加载，不安全。</li>
<li><code>Basic</code> — 需要有 <code>vault.plist</code> 文件存放在 <code>OC</code> 目录下。这个值提供了基本的文件系统完整性验证，可以防止无意中的文件系统损坏。</li>
<li><code>Secure</code> — 需要有 <code>vault.sig</code> 签名的 <code>vault.plist</code> 文件存放在 <code>OC</code> 目录下。这个值包括了 <code>Basic</code> 完整性检查，但也会尝试建立一个可信的引导链。</li>
</ul>
<p><code>vault.plist</code> 文件应该包含 OpenCore 使用的所有文件的 SHA-256 哈希值。强烈建议使用这个文件，以确保无意中的文件修改（包括文件系统损坏）不会被忽视。要自动创建这个文件，请使用 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg/tree/master/Utilities/CreateVault"><code>create_vault.sh</code></a> 脚本。无论底层的文件系统如何，路径名和大小写必须在 <code>config.plist</code> 和 <code>vault.plist</code> 之间相匹配。</p>
<p><code>vault.sig</code> 文件应该包含一个来自 <code>vault.plist</code> SHA-256 哈希值的原始的 256 字节 RSA-2048 签名。这个签名是根据嵌入到 <code>OpenCore.efi</code> 中的公钥来验证的。如要嵌入公钥，以下任一步骤均可：</p>
<ul>
<li>在 <code>OpenCore.efi</code> 编译过程中，在 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg/blob/master/Platform/OpenCore/OpenCoreVault.c"><code>OpenCoreVault.c</code></a> 文件中提供公钥。</li>
<li>用二进制补丁的方式将 <code>OpenCore.efi</code> 中 <code>=BEGIN OC VAULT=</code> 和 <code>==END OC VAULT==</code> ASCII 码之间的 0 替换为公钥。</li>
</ul>
<p>RSA 公钥的 520 字节格式可参阅 Chromium OS 文档。如要从 X.509 证书或 PEM 文件中转换公钥，请使用 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg/tree/master/Utilities/CreateVault">RsaTool</a>。</p>
<p>以下操作的完整指令：</p>
<ul>
<li>创建 <code>vault.plist</code></li>
<li>创建一个新的 RSA 密钥（总是要这样做，以避免加载旧配置）</li>
<li>将 RSA 密钥嵌入到 <code>OpenCore.efi</code></li>
<li>创建 <code>vault.sig</code></li>
</ul>
<p>可以参照如下指令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;Volumes&#x2F;EFI&#x2F;EFI&#x2F;OC</span><br><span class="line">&#x2F;path&#x2F;to&#x2F;create_vault.sh .</span><br><span class="line">&#x2F;path&#x2F;to&#x2F;RsaTool -sign vault.plist vault.sig vault.pub</span><br><span class="line">off&#x3D;$(($(strings -a -t d OpenCore.efi | grep &quot;&#x3D;BEGIN OC VAULT&#x3D;&quot; | cut -f1 -d&#39; &#39;)+16))</span><br><span class="line">dd of&#x3D;OpenCore.efi if&#x3D;vault.pub bs&#x3D;1 seek&#x3D;$off count&#x3D;528 conv&#x3D;notrunc</span><br><span class="line">rm vault.pub</span><br></pre></td></tr></table></figure>
<p><em>注 1</em>：必须使用外部方法来验证 <code>OpenCore.efi</code> 和 <code>BOOTx64.efi</code> 的安全启动路径，尽管它们看似显而易见。为此，建议你至少使用自定义证书来启用 UEFI 的 SecureBoot，并使用自定义的密钥来签名 <code>OpenCore.efi</code> 和 <code>BOOTx64.efi</code> 。关于在现代固件上定制安全启动的更多细节，请参见 <a target="_blank" rel="noopener" href="https://habr.com/post/273497/">Taming UEFI SecureBoot</a>（俄文）。</p>
<p><em>注 2</em>：当 <code>vault.plist</code> 存在，或者当公钥嵌入到 <code>OpenCore.efi</code> 中的时候，无论这个选项是什么，<code>vault.plist</code> 和 <code>vault.sig</code> 都会被使用。设置这个选项仅仅会确保配置的合理性，否则启动过程会中止。</p>
<h3 id="ScanPolicy"><code>ScanPolicy</code></h3>
<p><strong>Type</strong>: <code>plist integer</code>, 32 bit<br>
<strong>Failsafe</strong>: <code>0xF0103</code><br>
<strong>Description</strong>: 定义操作系统检测策略。</p>
<p>通过设置该值来根据所选 flag 的位掩码（总和）防止从非信任源扫描（和启动）。由于不可能可靠地检测到每一个文件类型或设备类型，因此在开放环境中不能完全依赖此功能，需要采取额外的措施。</p>
<p>第三方驱动程序可能会根据提供的扫描策略引入额外的安全（和性能）措施。扫描策略暴露在 <code>4D1FDA02-38C7-4A6A-9CC6-4BCCA8B30102</code> GUID 的 <code>scan-policy</code> 变量中，仅适用于 UEFI 启动服务。</p>
<ul>
<li><code>0x00000001</code> (bit <code>0</code>) — <code>OC_SCAN_FILE_SYSTEM_LOCK</code>，将扫描限制于仅扫描此策略定义的已知文件系统。文件系统驱动可能感知不到这个策略，为了避免挂载不必要的文件系统，最好不要加载它的驱动程序。此 bit 不影响 dmg 挂载，因为它可能有各种文件系统。已知文件系统的前缀为 <code>OC_SCAN_ALLOW_FS_</code>。</li>
<li><code>0x00000002</code> (bit <code>1</code>) — <code>OC_SCAN_DEVICE_LOCK</code>，将扫描限制于仅扫描此策略定义的已知设备类型。由于协议隧道并不一定能被检测到，因此请注意，在某些系统上可能会出现 USB 硬盘被识别成 SATA 等情况。如有类似情况，请务必报告。已知设备类型的前缀为 <code>OC_SCAN_ALLOW_DEVICE_</code>。</li>
<li><code>0x00000100</code> (bit <code>8</code>) — <code>OC_SCAN_ALLOW_FS_APFS</code>，允许扫描 APFS 文件系统。</li>
<li><code>0x00000200</code> (bit <code>9</code>) — <code>OC_SCAN_ALLOW_FS_HFS</code>，允许扫描 HFS 文件系统。</li>
<li><code>0x00000400</code> (bit <code>10</code>) — <code>OC_SCAN_ALLOW_FS_ESP</code>，允许扫描 EFI 系统分区文件系统。</li>
<li><code>0x00000800</code> (bit <code>11</code>) — <code>OC_SCAN_ALLOW_FS_NTFS</code>，允许扫描 NTFS（MSFT Basic Data）文件系统。</li>
<li><code>0x00001000</code> (bit <code>12</code>) — <code>OC_SCAN_ALLOW_FS_EXT</code>，允许扫描 EXT（Linux Root）文件系统。</li>
<li><code>0x00010000</code> (bit <code>16</code>) — <code>OC_SCAN_ALLOW_DEVICE_SATA</code>，允许扫描 SATA 设备。</li>
<li><code>0x00020000</code> (bit <code>17</code>) — <code>OC_SCAN_ALLOW_DEVICE_SASEX</code>，允许扫描 SAS 和 Mac NVMe 设备。</li>
<li><code>0x00040000</code> (bit <code>18</code>) — <code>OC_SCAN_ALLOW_DEVICE_SCSI</code>，允许扫描 SCSI 设备。</li>
<li><code>0x00080000</code> (bit <code>19</code>) — <code>OC_SCAN_ALLOW_DEVICE_NVME</code>，允许扫描 NVMe 设备。</li>
<li><code>0x00100000</code> (bit <code>20</code>) — <code>OC_SCAN_ALLOW_DEVICE_ATAPI</code>，允许扫描 CD/DVD 设备。</li>
<li><code>0x00200000</code> (bit <code>21</code>) — <code>OC_SCAN_ALLOW_DEVICE_USB</code>，允许扫描 USB 设备。</li>
<li><code>0x00400000</code> (bit <code>22</code>) — <code>OC_SCAN_ALLOW_DEVICE_FIREWIRE</code>，允许扫描 FireWire 设备。</li>
<li><code>0x00800000</code> (bit <code>23</code>) — <code>OC_SCAN_ALLOW_DEVICE_SDCARD</code>，允许扫描读卡器设备。</li>
</ul>
<p><em>注</em>：举例：根据以上描述，<code>0xF0103</code> 值允许扫描带有 APFS 文件系统的 SATA、SAS、SCSI 和 NVMe 设备，不扫描 USB、CD 和 FireWire 设备上的 APFS 文件系统，也不扫描任何带有 HFS 或 FAT32 文件系统的设备。该值表示如下组合：</p>
<ul>
<li><code>OC_SCAN_FILE_SYSTEM_LOCK</code></li>
<li><code>OC_SCAN_DEVICE_LOCK</code></li>
<li><code>OC_SCAN_ALLOW_FS_APFS</code></li>
<li><code>OC_SCAN_ALLOW_DEVICE_SATA</code></li>
<li><code>OC_SCAN_ALLOW_DEVICE_SASEX</code></li>
<li><code>OC_SCAN_ALLOW_DEVICE_SCSI</code></li>
<li><code>OC_SCAN_ALLOW_DEVICE_NVME</code></li>
</ul>
<h2 id="8-6-Entry-Properties">8.6 Entry Properties</h2>
<h3 id="Arguments"><code>Arguments</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: 对该引导条目使用的引导参数。</p>
<h3 id="Auxiliary"><code>Auxiliary</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: false<br>
<strong>Description</strong>: 当 <code>HideAuxiliary</code> 被启用时，这一值为 <code>true</code> 的引导条目将不会显示在开机引导菜单中。</p>
<h3 id="Comment"><code>Comment</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: 用于为条目提供人类可读参考的任意 ASCII 字符串（译者注：即注释）。</p>
<h3 id="Enabled"><code>Enabled</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 除非设置为 <code>true</code>，否则该引导条目不会显示在开机引导菜单中。</p>
<h3 id="Name"><code>Name</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: 引导条目在开机引导菜单中显示的名字。</p>
<h3 id="Path"><code>Path</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: 引导入口。</p>
<ul>
<li><code>Entries</code> 用于指定外部启动选项，因此会在 <code>Path</code> 中取设备路径。这些值不会被检查，所以要非常小心。例如：<code>PciRoot(0x0)/Pci(0x1,0x1)/.../\EFI\COOL.EFI</code>。</li>
<li><code>Tools</code> 用于指定内部引导选项，这些选项隶属于 bootloader vault，因此会取相对于 <code>OC/Tools</code> 目录的文件路径。例如：<code>OpenShell.efi</code>。</li>
</ul>
<h1>9. NVRAM</h1>
<hr>
<h2 id="9-1-Introduction">9.1 Introduction</h2>
<p>设置易失性 UEFI 变量（通常被称作 NVRAM 变量），数据类型为 <code>plist dict</code>。使用 <code>man nvram</code> 获取详细信息。macOS 广泛使用 NVRAM 变量使 操作系统、BootLoader、固件 之间互通，因此需要提供多个 NVRAM 变量才能正常运行 macOS。</p>
<p>每个 NVRAM 变量均由其名称、值、属性（参考 UEFI 规范）以及 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Universally_unique_identifier">GUID</a> 组成，表示 NVRAM 变量属于哪一区域。macOS 使用如下（包括但不限于）几种 GUID：</p>
<ul>
<li><code>4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14</code> (<code>APPLE_VENDOR_VARIABLE_GUID</code>)</li>
<li><code>7C436110-AB2A-4BBB-A880-FE41995C9F82</code> (<code>APPLE_BOOT_VARIABLE_GUID</code>)</li>
<li><code>8BE4DF61-93CA-11D2-AA0D-00E098032B8C</code> (<code>EFI_GLOBAL_VARIABLE_GUID</code>)</li>
<li><code>4D1FDA02-38C7-4A6A-9CC6-4BCCA8B30102</code> (<code>OC_VENDOR_VARIABLE_GUID</code>)</li>
</ul>
<p><em>注</em>：某些变量可以通过 <code>PlatformNVRAM</code> 或 <code>PlatformInfo</code> 节的 <code>Generic</code> 子节添加。请确保本节中的变量不会与它们发生冲突，否则可能导致未定义的行为。</p>
<p>为了使 macOS 正常运行，通常需要使用 <code>OC_FIRMWARE_RUNTIME</code> 协议。该协议的实现目前是 <code>OpenRuntime</code>（原名 <code>FwRuntimeServices.efi</code>）驱动程序的一部分。虽然可能带来一些好处，但根据用途不同也会存在某些限制。</p>
<ul>
<li>并非所有工具都可能知道受保护的名称空间。当使用 <code>RequestBootVarRouting</code> 时，在独立的命名空间中会限制对 <code>Boot</code> 前缀的变量访问。要访问原始变量，工具必须了解 <code>OC_FIRMWARE_RUNTIME</code> 协议的工作原理。</li>
</ul>
<h2 id="9-2-Properties">9.2 Properties</h2>
<h3 id="1-Add">1. <code>Add</code></h3>
<p><strong>Type</strong>: <code>plist dict</code><br>
<strong>Description</strong>: 将 NVRAM 变量从 GUID 映射（<code>plist dict</code>）设置为变量名称及变量值的映射，格式为 <code>plist metadata</code>。GUID 必须以 Canonical String 格式提供，大写或小写均可（如 <code>8BE4DF61-93CA-11D2-AA0D-00E098032B8C</code>）。</p>
<p>创建的变量会设置 <code>EFI_VARIABLE_BOOTSERVICE_ACCESS</code> 和 <code>EFI_VARIABLE_RUNTIME_ACCESS</code> 的属性。变量只有在不存在且未被屏蔽的情况下才会被设置，也就是说，如果想要覆盖一个现有的变量值，请将该变量的名称添加到 <code>Delete</code> 部分，这种方法能够提供一个默认的值，直到操作系统接手为止。</p>
<p><em>注</em>：如果 <code>plist key</code> 不符合 GUID 格式，则可能出现一些未定义的行为。</p>
<h3 id="2-Delete">2. <code>Delete</code></h3>
<p><strong>Type</strong>: <code>plist dict</code><br>
<strong>Description</strong>: 将 NVRAM 变量从 GUID 映射（<code>plist dict</code>）移除到一个变量名称数组（<code>plist array</code>）中，格式为 <code>plist string</code>。</p>
<h3 id="3-LegacyEnable">3. <code>LegacyEnable</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 允许从 ESP 分区的根目录中的 <code>nvram.plist</code> 文件读取 NVRAM 变量。</p>
<p>该文件必须有 Root <code>plist dictionary</code> 类型，并包含以下两个字段：</p>
<ul>
<li><code>Version</code> — <code>plist integer</code>，文件版本，必须设定为 1。</li>
<li><code>Add</code> — <code>plist dictionary</code>，等同于 <code>config.plist</code> 中的 <code>Add</code>。</li>
</ul>
<p>变量加载优先于 <code>Delete</code>（以及 <code>Add</code>）阶段。除非启用了 <code>LegacyOverwrite</code>，否则不会覆盖现有的任何变量。允许设置的变量必须指定于 <code>LegacySchema</code> 中。第三方脚本可以用来创建 <code>nvram.plist</code> 文件，脚本示例可参照 <code>Utilities</code>。使用第三方脚本可能要将 <code>ExposeSensitiveData</code> 设置为 <code>0x3</code> 来为 <code>boot-path</code> 变量提供 OpenCore EFI 分区的 UUID。</p>
<p><strong>警告</strong>: 这一功能非常危险，因为会将不受保护的数据传递给固件中的变量服务。只有在你的硬件不提供硬件 NVRAM 或与之不兼容时才使用。</p>
<h3 id="4-LegacyOverwrite">4. <code>LegacyOverwrite</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 允许用 <code>nvram.plist</code> 文件中的变量覆盖现有 NVRAM 中的变量。</p>
<p><em>注</em>：只有操作系统访问的到的变量会被覆盖。</p>
<h3 id="5-LegacySchema">5. <code>LegacySchema</code></h3>
<p><strong>Type</strong>: <code>plist dict</code><br>
<strong>Description</strong>: 允许从 GUID 映射（<code>plist dict</code>）中选择 NVRAM 变量设置到一个变量名称数组（<code>plist array</code>），格式为 <code>plist string</code>。</p>
<p>可用 <code>*</code> 值来接受所有用来选择 GUID 的变量。</p>
<p><strong>警告</strong>：选择变量要非常慎重，因为 nvram.plist 不会被存储。比如，不要把 <code>boot-args</code> 或 <code>csr-active-config</code> 放进去，因为会绕过 SIP。</p>
<h3 id="6-WriteFlash">6. <code>WriteFlash</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 允许将所有添加的变量写入闪存。</p>
<p><em>注</em>：这个 Quirk 本应该在大多数固件上启用，但是由于可能存在 NVRAM 变量存储 GC 或类似的问题的固件，所以我们将这个 Quirk 设计为可配置的。</p>
<p>要从 macOS 中读取 NVRAM 变量的值，可以使用 <code>nvram</code>，并将变量 GUID 和名称用 <code>:</code> 符号隔开，形如 <code>nvram 7C436110-AB2A-4BBB-A880-FE41995C9F82:boot-args</code>。</p>
<p>变量列表可参照相关文档（持续更新）：<a target="_blank" rel="noopener" href="https://docs.google.com/spreadsheets/d/1HTCBwfOBkXsHiK7os3b2CUc6k68axdJYdGl-TyXqLu0">NVRAM Variables</a>。</p>
<h2 id="9-3-Mandatory-Variables">9.3 Mandatory Variables</h2>
<p><em>警告</em>：这些变量可通过 PlatformNVRAM 或 PlatformInfo 的 Generic 部分添加。推荐使用 <code>PlatformInfo</code> 来设置这些变量。</p>
<p>以下变量为 macOS 运行必需：</p>
<ul>
<li><code>4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14:FirmwareFeatures</code><br>
32 位 <code>FirmwareFeatures</code>。存在于所有 Mac 上，用来避免额外解析 SMBIOS 表。</li>
<li><code>4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14:FirmwareFeaturesMask</code><br>
32 位 <code>FirmwareFeaturesMask</code>。存在于所有 Mac 上，用来避免额外解析 SMBIOS 表。</li>
<li><code>4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14:MLB</code><br>
<code>BoardSerialNumber</code>。存在于较新的 Mac 上（至少 2013 年以后），用来避免额外解析 SMBIOS 表，尤其是在 <code>boot.efi</code> 中。</li>
<li><code>4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14:ROM</code><br>
主要的网络适配器的 MAC 地址或替换值。存在于较新的 Mac（至少 2013 年以后）上，用来避免访问特殊内存区域，尤其是在 <code>boot.efi</code> 中。</li>
</ul>
<h2 id="9-4-Recommended-Variables">9.4 Recommended Variables</h2>
<p>建议使用以下变量来加快启动速度或改善其他表现：</p>
<ul>
<li><code>7C436110-AB2A-4BBB-A880-FE41995C9F82:csr-active-config</code><br>
32 位系统完整性保护的位掩码，声明于 XNU 源码 <a target="_blank" rel="noopener" href="https://opensource.apple.com/source/xnu/xnu-4570.71.2/bsd/sys/csr.h.auto.html">csr.h</a>。</li>
<li><code>4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14:ExtendedFirmwareFeatures</code><br>
结合 <code>FirmwareFeatures</code> 和 <code>ExtendedFirmwareFeatures</code>。存在于较新的 Mac 上，用来避免额外解析 SMBIOS 表。</li>
<li><code>4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14:ExtendedFirmwareFeaturesMask</code><br>
结合 <code>FirmwareFeaturesMask</code> 和 <code>ExtendedFirmwareFeaturesMask</code>。存在于较新的 Mac 上，用来避免额外解析 SMBIOS 表。</li>
<li><code>4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14:HW_BID</code><br>
硬件 <code>BoardProduct</code>（如 <code>Mac-35C1E88140C3E6CF</code>）。在真正的 Mac 上不存在，但可用于避免额外解析 SMBIOS 表，尤其是在 <code>boot.efi</code> 中。</li>
<li><code>4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14:HW_MLB</code><br>
硬件 <code>BoardSerialNumber</code>。覆盖 MLB，存在于较新的 Mac 上（至少 2013 年以后）。</li>
<li><code>4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14:HW_ROM</code><br>
硬件 ROM。覆盖 ROM，存在于较新的 Mac 上（至少 2013 年以后）。</li>
<li><code>7C436110-AB2A-4BBB-A880-FE41995C9F82:prev-lang:kbd</code><br>
定义默认键盘布局的 ASCII 字符串。格式为 <code>lang-COUNTRY:keyboard</code>，例如 <code>ru-RU:252</code> 代表俄语和 ABC 键盘。也接受简短形式：<code>ru:252</code> 或 <code>ru:0</code>（美国键盘，兼容 10.9）。完整的键盘列表解码来自 <code>AppleKeyboardLayouts-L.dat</code>，可前往<a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg/tree/master/Utilities/AppleKeyboardLayouts">这里</a>查看。与之前或之后的 macOS 版本不同，在 10.14 上，使用非拉丁语键盘将无法启用 ABC 键盘，因此假如你需要使用 10.14 版本则不建议你使用这一变量。</li>
<li><code>7C436110-AB2A-4BBB-A880-FE41995C9F82:security-mode</code><br>
定义 FireWire 安全模式的 ASCII 字符串。这一变量旧版本才有，可在 <a target="_blank" rel="noopener" href="https://opensource.apple.com/source/IOFireWireFamily/IOFireWireFamily-473/IOFireWireFamily.kmodproj/IOFireWireController.cpp.auto.html">IOFireWireController.cpp</a> 中的 IOFireWireFamily 源码里找到。建议不要设置这个变量，这样可能会加快启动速度。设置为 <code>full</code> 等同于不设置该变量，设置为 <code>none</code> 将禁用 FireWire 安全性。</li>
<li><code>4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14:UIScale</code><br>
定义 <code>boot.efi</code> 用户界面缩放比例的一字节数据。普通屏幕应为 <strong>01</strong>，HiDPI 屏幕应为 <strong>02</strong>。</li>
<li><code>4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14:DefaultBackgroundColor</code><br>
定义 <code>boot.efi</code> 用户界面背景色的四字节 <code>BGRA</code> 数据。标准色包括 <code>BF BF BF 00</code>（浅灰）和 <code>00 00 00 00</code>（西拉黑）。其他颜色可根据用户喜好设置。</li>
</ul>
<h2 id="9-5-Other-Variables">9.5 Other Variables</h2>
<p>以下变量对于某些特定的配置或进行故障排除可能会很有用：</p>
<ul>
<li><code>7C436110-AB2A-4BBB-A880-FE41995C9F82:boot-args</code> 内核参数，用于将配置传递给 Apple 内核和驱动程序。很多参数可以通过在内核或驱动程序代码中寻找 <code>PE_parse_boot_argn</code> 函数找到。已知的引导参数包括：
<ul>
<li><code>acpi_layer=0xFFFFFFFF</code></li>
<li><code>acpi_level=0xFFFF5F</code> — 表示 <a target="_blank" rel="noopener" href="https://github.com/acpica/acpica/blob/master/source/include/acoutput.h"><code>ACPI_ALL_COMPONENTS</code></a></li>
<li><code>batman=VALUE</code> — <code>AppleSmartBatteryManager</code> 调试掩码</li>
<li><code>batman-nosmc=1</code> — 禁用 <code>AppleSmartBatteryManager</code> SMC 接口</li>
<li><code>cpus=VALUE</code> — 最大可用 CPU 数量</li>
<li><code>debug=VALUE</code> — Debug 掩码</li>
<li><code>io=VALUE</code> — <code>IOKit</code> 调试掩码</li>
<li><code>keepsyms=1</code> — 显示 Panic 日志调试符号</li>
<li><code>kextlog=VALUE</code> — Kext 调试掩码</li>
<li><code>nv_disable=1</code> — 禁用 NVIDIA GPU 加速</li>
<li><code>nvda_drv=1</code> — 启用 NVIDIA web driver 的传统方法，这一参数在 macOS 10.12 中被去除</li>
<li><code>npci=0x2000</code> — <a target="_blank" rel="noopener" href="https://www.insanelymac.com/forum/topic/260539-1068-officially-released/?do=findComment&amp;comment=1707972">旧方法</a> 禁用 <code>kIOPCIConfiguratorPFM64</code></li>
<li><code>lapic_dont_panic=1</code></li>
<li><code>slide=VALUE</code> — 手动设置 KASLR 偏移值</li>
<li><code>smcdebug=VALUE</code> — <code>AppleSMC</code> 调试掩码</li>
<li><code>-amd_no_dgpu_accel</code> — 替代 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/WhateverGreen">WhateverGreen</a> 的 <code>-radvesa</code>，用于较新的 GPUs</li>
<li><code>-nehalem_error_disable</code></li>
<li><code>-no_compat_check</code> — 禁用机型检查</li>
<li><code>-s</code> — 单用户模式</li>
<li><code>-v</code> — 啰嗦模式</li>
<li><code>-x</code> — 安全模式</li>
</ul>
</li>
</ul>
<p>这里有一些网站收集了 macOS 内置的启动参数列表：<a target="_blank" rel="noopener" href="https://osxeon.wordpress.com/2015/08/10/boot-argument-options-in-os-x">列表 1</a>、<a target="_blank" rel="noopener" href="https://superuser.com/questions/255176/is-there-a-list-of-available-boot-args-for-darwin-os-x">列表 2</a>.</p>
<ul>
<li><code>7C436110-AB2A-4BBB-A880-FE41995C9F82:bootercfg</code><br>
Booter 参数，类似于 <code>boot-args</code>，但用于 <code>boot.efi</code> 。接受参数为一组十六进制的 64 位值，带或不带 <code>0x</code>。在不同阶段，<code>boot.efi</code> 会请求不同的调试（日志）模式（例如，在 <code>ExitBootServices</code> 之后它只会打印到串行调试接口）。<br>
有些 Booter 参数会控制这些请求是否成功。<br>
下面是已知请求的列表：
<ul>
<li><code>0x00</code> – <code>INIT</code></li>
<li><code>0x01</code> – <code>VERBOSE</code> （如 <code>-v</code>，强制控制台记录日志）</li>
<li><code>0x02</code> – <code>EXIT</code></li>
<li><code>0x03</code> – <code>RESET:OK</code></li>
<li><code>0x04</code> – <code>RESET:FAIL</code> （如未知的 <code>board-id</code>，休眠错配，Panic 循环，等等）</li>
<li><code>0x05</code> – <code>RESET:RECOVERY</code></li>
<li><code>0x06</code> – <code>RECOVERY</code></li>
<li><code>0x07</code> – <code>REAN:START</code></li>
<li><code>0x08</code> – <code>REAN:END</code></li>
<li><code>0x09</code> – <code>DT</code> （不再将日志记录到设备树）</li>
<li><code>0x0A</code> – <code>EXITBS:START</code> （仅强制的串行调试接口）</li>
<li><code>0x0B</code> – <code>EXITBS:END</code> （仅强制的串行调试接口）</li>
<li><code>0x0C</code> – <code>UNKNOWN</code></li>
</ul>
</li>
</ul>
<p>在 10.15 中，由于某种重构和 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg/blob/master/Include/Apple/Protocol/AppleDebugLog.h">新调试协议</a> 的引入，10.15.4 之前的调试支持基本上不能用了。下面的一些参数和值可能不适用于 10.15.4 之前的版本。以下是已知参数的列表：</p>
<ul>
<li><code>boot-save-log=VALUE</code> — 正常启动时的调试日志保存模式
<ul>
<li><code>0</code></li>
<li><code>1</code></li>
<li><code>2</code> — 默认</li>
<li><code>3</code></li>
<li><code>4</code> — 保存到文件</li>
</ul>
</li>
<li><code>wake-save-log=VALUE</code> — 休眠唤醒时的调试日志保存模式
<ul>
<li><code>0</code> — 禁用</li>
<li><code>1</code></li>
<li><code>2</code> — 默认</li>
<li><code>3</code> — 不可用</li>
<li><code>4</code> — 保存到文件，不可用</li>
</ul>
</li>
<li><code>breakpoint=VALUE</code> — 调试中断相关（在产品 <code>boot.efi</code> 中缺少）
<ul>
<li><code>0</code> — 禁用错误时的调试中断（默认）</li>
<li><code>1</code> — 启用错误时的调试中断</li>
</ul>
</li>
<li><code>console=VALUE</code> — 启用控制台日志记录
<ul>
<li><code>0</code> — 禁用控制台日志记录</li>
<li><code>1</code> — 当缺少调试协议时，启用控制台日志记录（默认）</li>
<li><code>2</code> — 无条件启用控制台日志记录（不可用）</li>
</ul>
</li>
<li><code>embed-log-dt=VALUE</code> — 设备树日志记录相关
<ul>
<li><code>0</code> — 禁用设备树日志记录</li>
<li><code>1</code> — 启用设备树日志记录</li>
</ul>
</li>
<li><code>kc-read-size=VALUE</code> — 用于网络或磁盘缓冲 I/O 的数据块大小，用于预链接内核读取和相关用途。默认设置为 1MB<br>
(0x100000)，可以通过调整使启动更快</li>
<li><code>log-level=VALUE</code> — 日志等级位掩码
<ul>
<li><code>0x01</code> — 启用跟踪记录（默认）</li>
</ul>
</li>
<li><code>serial=VALUE</code> — 串行控制台日志记录相关
<ul>
<li><code>0</code> — 禁用串行日志记录（默认）</li>
<li><code>1</code> — 从 <code>EXITBS:END</code> 开始启用串行日志记录</li>
<li><code>1</code> — 从 <code>EXITBS:START</code> 开始启用串行日志记录</li>
<li><code>3</code> — 当缺少调试协议时，启用串行日志记录</li>
<li><code>4</code> — 无条件启用串行日志记录</li>
</ul>
</li>
<li><code>timestamps=VALUE</code> — 时间戳日志记录相关
<ul>
<li><code>0</code> — 禁用时间戳记录</li>
<li><code>1</code> — 启用时间戳记录（默认）</li>
</ul>
</li>
<li><code>log=VALUE</code> — 10.15 开始弃用</li>
</ul>
<p><em>注</em>：如要查看现代 macOS 版本上的 <code>boot.efi</code> verbose 输出，请启用 <code>AppleDebug</code> 选项。这样会把日志保存到通用 OpenCore 日志中。对于 10.15.4 之前的版本，将 <code>bootercfg</code> 设置为 <code>log=1</code>，可以将 verbose 输出打印在屏幕上。</p>
<ul>
<li><code>7C436110-AB2A-4BBB-A880-FE41995C9F82:efiboot-perf-record</code><br>
启用 <code>boot.efi</code> 中的性能日志保存功能。性能日志会被保存到物理内存中，并通过 <code>efiboot-perf-record-data</code> 和 <code>efiboot-perf-record-size</code> 变量进行指向。从 10.15.4 开始，它也可以通过 <code>AppleDebug</code> 选项保存到 OpenCore 日志中。</li>
<li><code>7C436110-AB2A-4BBB-A880-FE41995C9F82:bootercfg-once</code><br>
在首次启动后删除 Booter 参数覆盖，否则等同于 <code>bootercfg</code>。</li>
<li><code>7C436110-AB2A-4BBB-A880-FE41995C9F82:fmm-computer-name</code><br>
当前保存的主机名称，格式为 ASCII 字符串。</li>
<li><code>7C436110-AB2A-4BBB-A880-FE41995C9F82:nvda_drv</code><br>
NVIDIA Web Driver 的控制变量。用 ASCII 数字 <code>1</code> 来启用或用 <code>0</code> 来禁用已安装的驱动程序。</li>
<li><code>7C436110-AB2A-4BBB-A880-FE41995C9F82:StartupMute</code><br>
开机时禁用固件引导提示音。8 进制整数。<code>0x00</code> 指代不静音、其他任何值（或缺少该值）表示静音。这一选项只影响带 T2 的机器。</li>
<li><code>7C436110-AB2A-4BBB-A880-FE41995C9F82:SystemAudioVolume</code><br>
固件音频支持的系统音频音量等级。8 进制整数。<code>0x80</code> 指代静音。低位用于编码安装的音频编码解码器的音量范围。该值以 <code>MaximumBootBeepVolume</code> AppleHDA layout 值为上限，以避免固件中的音频播放声音过大。</li>
</ul>
<h1>10. PlatformInfo</h1>
<hr>
<p>机型信息由手动生成、填充以与 macOS 服务兼容的几个标识字段组成。配置的基础部分可以从 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg/blob/master/AppleModels"><code>AppleModels</code></a>、一个可以从 <a target="_blank" rel="noopener" href="https://yaml.org/spec/1.2/spec.html">YAML</a> 格式的数据库中生成一组接口的工具包中获得。这些字段将会被写入三个位置：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.dmtf.org/standards/smbios">SMBIOS</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg/blob/master/Include/Intel/Protocol/DataHub.h">DataHub</a></li>
<li>NVRAM</li>
</ul>
<p>大多数字段在 SMBIOS 中指定覆盖，并且这些字段的名称符合 EDK2 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/audk/blob/master/MdePkg/Include/IndustryStandard/SmBios.h">SmBios.h</a> 头文件。但是，在 Data Hub 和 NVRAM 中有几个重要的字段。有些值可以在多个字段 和/或 目标中找到，因此有两种方法可以控制它们的更新过程：手动指定所有值（默认方法）；半自动。</p>
<p>可以使用 <a target="_blank" rel="noopener" href="http://www.nongnu.org/dmidecode">dmidecode</a> 工具来检查 SMBIOS 内容。你可以从 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/dmidecode/releases">Acidanthera/dmidecode</a> 下载 Acidanthera 制作的增强版。</p>
<h2 id="10-1-Properties">10.1 Properties</h2>
<h3 id="1-Automatic">1. <code>Automatic</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 基于 <code>Generic</code> 属性而不是 <code>DataHub</code>、<code>NVRAM</code> 和 <code>SMBIOS</code> 属性生成机型信息。</p>
<p>当 <code>Generic</code> 属性足够灵活的时候，这一选项将会变得非常有用：</p>
<ul>
<li>When enabled <code>SMBIOS</code>、<code>DataHub</code>、<code>PlatformNVRAM</code> is used.</li>
<li>When disabled <code>Generic</code> is not used.</li>
</ul>
<h3 id="2-UpdateDataHub">2. <code>UpdateDataHub</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 更新 Data Hub 字段。根据 <code>Automatic</code> 的值，这些字段会从 <code>Generic</code> 或 <code>DataHub</code> 中读取。</p>
<h3 id="3-UpdateNVRAM">3. <code>UpdateNVRAM</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 是否更新 NVRAM 中关于机型信息的相关字段。</p>
<p>根据 <code>Automatic</code> 的值，这些字段会从 <code>Generic</code> 或 <code>PlatformNVRAM</code> 中读取。所有其他字段都将在 <code>NVRAM</code> 部分中指定。</p>
<p>如果将此值设置为 <code>false</code>，则可以使用 <code>nvram</code> 部分更新上述变量；反之若将此值设置为 <code>true</code>，而同时 <code>nvram</code> 部分存在任何字段，会产生意料之外的行为。</p>
<h3 id="4-UpdateSMBIOS">4. <code>UpdateSMBIOS</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 更新 SMBIOS 字段。根据 <code>Automatic</code> 的值，这些字段会从 <code>Generic</code> 或 <code>SMBIOS</code> 中读取。</p>
<h3 id="5-UpdateSMBIOSMode">5. <code>UpdateSMBIOSMode</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: <code>Create</code><br>
<strong>Description</strong>: 更新 SMBIOS 字段的方式有：</p>
<ul>
<li><code>TryOverwrite</code> — 如果新的数据大小 小于等于 按页对齐的原始数据，且对解锁 legacy region 没有影响，则选择 <code>Overwrite</code> 方式；否则选择 <code>Create</code> 方式。在某些硬件上可能会有问题。</li>
<li><code>Create</code> — 在 AllocateMaxAddress 将表替换为新分配的 EfiReservedMemoryType，没有回退机制。</li>
<li><code>Overwrite</code> — 如果数据大小合适则覆盖现有的 gEfiSmbiosTableGuid 和 gEfiSmbiosTable3Guid，否则将以不明状态中止。</li>
<li><code>Custom</code> — 把第一个 SMBIOS 表（<code>gEfiSmbios(3)TableGuid</code>）写入 <code>gOcCustomSmbios(3)TableGuid</code>，以此来解决固件在 ExitBootServices 覆盖 SMBIOS 内容的问题；否则等同于 <code>Create</code>。需要 AppleSmbios.kext 和 AppleACPIPlatform.kext 打补丁来读取另一个 GUID: <code>&quot;EB9D2D31&quot;</code> - <code>&quot;EB9D2D35&quot;</code> (in ASCII)， 这一步由 <code>CustomSMBIOSGuid</code> quirk 自动完成。</li>
</ul>
<p><em>注</em>： 使用 <code>Custom</code> 有一个副作用（译者注：我怎么感觉是好事）使得 SMBIOS 设置只对 macOS 生效，避免了与现有的 Windows 激活和依赖机型的 OEM 设置的相关问题。不过，苹果在 Windows 下的特定工具（译者注：如 BootCamp for Windows）可能会受到影响</p>
<h3 id="6-Generic">6. <code>Generic</code></h3>
<p><strong>Type</strong>: <code>plist dictonary</code><br>
<strong>Optional</strong>: <code>Automatic</code> 为 <code>false</code> 时可不填<br>
<strong>Description</strong>: 更新所有字段。当 <code>Automatic</code> 激活时此处为只读。</p>
<h3 id="7-DataHub">7. <code>DataHub</code></h3>
<p><strong>Type</strong>: <code>plist dictonary</code><br>
<strong>Optional</strong>: <code>Automatic</code> 为 <code>true</code> 时可不填<br>
<strong>Description</strong>: 更新 Data Hub 字段。当 <code>Automatic</code> 未激活时此处为只读。</p>
<h3 id="8-PlatformNVRAM">8. <code>PlatformNVRAM</code></h3>
<p><strong>Type</strong>: <code>plist dictonary</code><br>
<strong>Optional</strong>: <code>Automatic</code> 为 <code>true</code> 时可不填<br>
<strong>Description</strong>: 更新 platform NVRAM 字段。当 <code>Automatic</code> 未激活时此处为只读。</p>
<h3 id="9-SMBIOS">9. <code>SMBIOS</code></h3>
<p><strong>Type</strong>: <code>plist dictonary</code><br>
<strong>Optional</strong>: <code>Automatic</code> 为 <code>true</code> 时可不填<br>
<strong>Description</strong>: 更新 SMBIOS 字段。当 <code>Automatic</code> 未激活时此处为只读。</p>
<h2 id="10-2-Generic-Properties">10.2 Generic Properties</h2>
<h3 id="1-SpoofVendor">1. <code>SpoofVendor</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 将 SMBIOS 中的 vendor 字段设置为 <code>Acidanthera</code>。</p>
<p>由于在 <code>SystemManufacturer</code> 相关介绍中介绍的原因，在 SMBIOS 的 vendor 字段中使用 <code>Apple</code> 是危险的。但是，某些固件可能无法提供有效值，可能会导致某些软件的破坏。</p>
<h3 id="2-AdviseWindows">2. <code>AdviseWindows</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 在 <code>FirmwareFeatures</code> 中强制提供 Windows 支持。</p>
<p>向 <code>FirmwareFeatures</code> 中添加如下比特：</p>
<ul>
<li><code>FW_FEATURE_SUPPORTS_CSM_LEGACY_MODE</code> (<code>0x1</code>) - 如果没有此比特，且 EFI 分区不是硬盘中的第一个分区，那么则无法重新启动到硬盘里的 Windows 系统。</li>
<li><code>FW_FEATURE_SUPPORTS_UEFI_WINDOWS_BOOT</code> (<code>0x20000000</code>) - 如果没有此比特，且 EFI 分区是硬盘中的第一个分区，那么则无法重新启动到硬盘里的 Windows 系统。</li>
</ul>
<h3 id="3-SystemProductName">3. <code>SystemProductName</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: <code>MacPro6,1</code><br>
<strong>Description</strong>: 请参考下文 SMBIOS 章节中的 <code>SystemProductName</code>。</p>
<h3 id="4-SystemSerialNumber">4. <code>SystemSerialNumber</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: <code>OPENCORE_SN1</code><br>
<strong>Description</strong>: 请参考下文 SMBIOS 章节中的 <code>SystemSerialNumber</code>。</p>
<h3 id="5-SystemUUID">5. <code>SystemUUID</code></h3>
<p><strong>Type</strong>: <code>plist string</code>, GUID<br>
<strong>Failsafe</strong>: OEM specified<br>
<strong>Description</strong>: 请参考下文 SMBIOS 章节中的 <code>SystemUUID</code>。</p>
<h3 id="6-MLB">6. <code>MLB</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: <code>OPENCORE_MLB_SN11</code><br>
<strong>Description</strong>: 请参考下文 SMBIOS 章节中的 <code>BoardSerialNumber</code>。</p>
<h3 id="7-ROM">7. <code>ROM</code></h3>
<p><strong>Type</strong>: <code>plist data</code>, 6 bytes<br>
<strong>Failsafe</strong>: all zero<br>
<strong>Description</strong>: 参考 <code>4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14:ROM</code>。</p>
<h2 id="10-3-DataHub-Properties">10.3 DataHub Properties</h2>
<h3 id="1-PlatformName">1. <code>PlatformName</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Not installed<br>
<strong>Description</strong>: 在 <code>gEfiMiscSubClassGuid</code> 中设置 <code>name</code>。在 Mac 上找到的值为 ASCII 码形式的 <code>platform</code>。</p>
<h3 id="2-SystemProductName">2. <code>SystemProductName</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Not installed<br>
<strong>Description</strong>: 在 <code>gEfiMiscSubClassGuid</code> 中设置 <code>Model</code>。在 Mac 上找到的值等于 Unicode 形式的 SMBIOS <code>SystemProductName</code>。</p>
<h3 id="3-SystemSerialNumber">3. <code>SystemSerialNumber</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Not installed<br>
<strong>Description</strong>: 在 <code>gEfiMiscSubClassGuid</code> 中设置 <code>SystemSerialNumber</code>。在 Mac 上找到的值等于 Unicode 形式的 SMBIOS <code>SystemSerialNumber</code>。</p>
<h3 id="4-SystemUUID">4. <code>SystemUUID</code></h3>
<p><strong>Type</strong>: <code>plist string</code>, GUID<br>
<strong>Failsafe</strong>: Not installed<br>
<strong>Description</strong>: 在 <code>gEfiMiscSubClassGuid</code> 中设置 <code>system-id</code>。在 Mac 上找到的值等于 SMBIOS <code>SystemUUID</code>。</p>
<h3 id="5-BoardProduct">5. <code>BoardProduct</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Not installed<br>
<strong>Description</strong>: 在 <code>gEfiMiscSubClassGuid</code> 中设置 <code>board-id</code>。在 Mac 上找到的值等于 ASCII 码形式的 SMBIOS <code>BoardProduct</code>。</p>
<h3 id="6-BoardRevision">6. <code>BoardRevision</code></h3>
<p><strong>Type</strong>: <code>plist data</code>, 1 byte<br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: 在 <code>gEfiMiscSubClassGuid</code> 中设置 <code>board-rev</code>。在 Mac 上找到的值似乎与 internal board revision 相对应（e.g. <code>01</code>）。</p>
<h3 id="7-StartupPowerEvents">7. <code>StartupPowerEvents</code></h3>
<p><strong>Type</strong>: <code>plist integer</code>, 64-bit<br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: 在 <code>gEfiMiscSubClassGuid Sets</code> 中设置 <code>StartupPowerEvents</code>。在 Mac 上找到的值是 power management state 位掩码，通常为 0。<code>X86PlatformPlugin.kext</code> 能读取的已知 bit 有：</p>
<ul>
<li><code>0x00000001</code> — Shutdown cause was a <code>PWROK</code> event (Same as <code>GEN_PMCON_2</code> bit 0)</li>
<li><code>0x00000002</code> — Shutdown cause was a <code>SYS_PWROK</code> event (Same as <code>GEN_PMCON_2</code> bit 1)</li>
<li><code>0x00000004</code> — Shutdown cause was a <code>THRMTRIP#</code>event (Same as <code>GEN_PMCON_2</code> bit 3)</li>
<li><code>0x00000008</code> — Rebooted due to a <code>SYS_RESET#</code> event (Same as <code>GEN_PMCON_2</code> bit 4)</li>
<li><code>0x00000010</code> — Power Failure (Same as <code>GEN_PMCON_3</code> bit 1 <code>PWR_FLR</code>)</li>
<li><code>0x00000020</code> — Loss of RTC Well Power (Same as <code>GEN_PMCON_3</code> bit 2 <code>RTC_PWR_STS</code>)</li>
<li><code>0x00000040</code> — General Reset Status (Same as <code>GEN_PMCON_3</code> bit 9 <code>GEN_RST_STS</code>)</li>
<li><code>0xffffff80</code> — SUS Well Power Loss (Same as <code>GEN_PMCON_3</code> bit 14)</li>
<li><code>0x00010000</code> — Wake cause was a ME Wake event (Same as PRSTS bit 0, <code>ME_WAKE_STS</code>)</li>
<li><code>0x00020000</code> — Cold Reboot was ME Induced event (Same as <code>PRSTS</code> bit 1 <code>ME_HRST_COLD_STS</code>)</li>
<li><code>0x00040000</code> — Warm Reboot was ME Induced event (Same as <code>PRSTS</code> bit 2 <code>ME_HRST_WARM_STS</code>)</li>
<li><code>0x00080000</code> — Shutdown was ME Induced event (Same as <code>PRSTS</code> bit 3 <code>ME_HOST_PWRDN</code>)</li>
<li><code>0x00100000</code> — Global reset ME Wachdog Timer event (Same as <code>PRSTS</code> bit 6)</li>
<li><code>0x00200000</code> — Global reset PowerManagment Wachdog Timer event (Same as <code>PRSTS</code> bit 15)</li>
</ul>
<h3 id="8-InitialTSC">8. <code>InitialTSC</code></h3>
<p><strong>Type</strong>: <code>plist integer</code>, 64-bit<br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: 在 <code>gEfiProcessorSubClassGuid</code> 中设置 <code>InitialTSC</code>。设置初始 TSC 值，通常为 0。</p>
<h3 id="9-FSBFrequency">9. <code>FSBFrequency</code></h3>
<p><strong>Type</strong>: <code>plist integer</code>, 64-bit<br>
<strong>Failsafe</strong>: Automatic<br>
<strong>Description</strong>: 在 <code>gEfiProcessorSubClassGuid</code> 中设置 <code>FSBFrequency</code>。</p>
<p>设置 CPU FSB 频率。此值等于 CPU 主频除以最高总线比率，以 Hz 为单位。请参考 <code>MSR_NEHALEM_PLATFORM_INFO</code>(<code>CEh</code>) MSR 值来确定 Intel CPU 的最高总线比率。</p>
<p><em>注</em>：此值虽然不是用于 Skylake 或更新的平台，但也可设置。</p>
<h3 id="10-ARTFrequency">10. <code>ARTFrequency</code></h3>
<p><strong>Type</strong>: <code>plist integer</code>, 64-bit<br>
<strong>Failsafe</strong>: Automatic<br>
<strong>Description</strong>: 在 <code>gEfiProcessorSubClassGuid</code> 中设置 <code>ARTFrequency</code>。</p>
<p>此值包含 CPU ART 频率，即晶体时钟频率。为 Skylake 或更新的平台独有，以 Hz 为单位。Client Intel segment 通常为 24 MHz，Server Intel segment 通常为 25 MHz，Intel Atom CPUs 通常为 19.2 MHz。macOS 10.15 及以下均默认为 24 MHz。</p>
<p><em>注</em>：由于 Intel Skylake X 平台特有 EMI-reduction 电路，其 ART 频率可能会比 24 或 25 MHz 有所损失（大约 0.25%）。参考 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/bugtracker/issues/448#issuecomment-524914166">Acidanthera Bugtracker</a>。</p>
<h3 id="11-DevicePathsSupported">11. <code>DevicePathsSupported</code></h3>
<p><strong>Type</strong>: <code>plist integer</code>, 32-bit<br>
<strong>Failsafe</strong>: Not installed<br>
<strong>Description</strong>: 在 <code>gEfiMiscSubClassGuid</code> 中设置 <code>DevicePathsSupported</code>。必须设置为 <code>1</code> 才能确保 AppleACPIPlatform.kext 将 SATA 设备路径添加到 <code>Boot####</code> 和 <code>efi-boot-device-data</code> 变量。所有新款 Mac 都设置为 <code>1</code>。</p>
<h3 id="12-SmcRevision">12. <code>SmcRevision</code></h3>
<p><strong>Type</strong>: <code>plist data</code>, 6 bytes<br>
<strong>Failsafe</strong>: Not installed<br>
<strong>Description</strong>: 在 <code>gEfiMiscSubClassGuid</code> 中设置 <code>REV</code>。自定义属性由 <code>VirtualSMC</code> 或 <code>FakeSMC</code> 读取，用于生成 SMC <code>REV</code> key。</p>
<h3 id="13-SmcBranch">13. <code>SmcBranch</code></h3>
<p><strong>Type</strong>: <code>plist data</code>, 8 bytes<br>
<strong>Failsafe</strong>: Not installed<br>
<strong>Description</strong>: 在 <code>gEfiMiscSubClassGuid</code> 中设置 <code>RBr</code>。自定义属性由 <code>VirtualSMC</code> 或 <code>FakeSMC</code> 读取，用于生成 SMC <code>RBr</code> key。</p>
<h3 id="14-SmcPlatform">14. <code>SmcPlatform</code></h3>
<p><strong>Type</strong>: <code>plist data</code>, 8 bytes<br>
<strong>Failsafe</strong>: Not installed<br>
<strong>Description</strong>: 在 <code>gEfiMiscSubClassGuid</code> 中设置 <code>RPlt</code>。自定义属性由 <code>VirtualSMC</code> 或 <code>FakeSMC</code> 读取，用于生成 SMC <code>RPlt</code> key。</p>
<h2 id="10-4-PlatformNVRAM-Properties">10.4 PlatformNVRAM Properties</h2>
<h3 id="1-BID">1. <code>BID</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Not installed<br>
<strong>Description</strong>: 指定 NVRAM 变量 <code>4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14:HW_BID</code>。</p>
<h3 id="2-ROM">2. <code>ROM</code></h3>
<p><strong>Type</strong>: <code>plist data</code>, 6 bytes<br>
<strong>Failsafe</strong>: Not installed<br>
<strong>Description</strong>: 指定 NVRAM 变量 <code>4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14:HW_ROM</code> 和 <code>4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14:ROM</code>。</p>
<h3 id="3-MLB">3. <code>MLB</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Not installed<br>
<strong>Description</strong>: 指定 NVRAM 变量 <code>4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14:HW_MLB</code> 和 <code>4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14:MLB</code>。</p>
<h3 id="4-FirmwareFeatures">4. <code>FirmwareFeatures</code></h3>
<p><strong>Type</strong>: <code>plist data</code>, 8 bytes<br>
<strong>Failsafe</strong>: Not installed<br>
<strong>Description</strong>: 此变量与 <code>FirmwareFeaturesMask</code> 配对使用。指定 NVRAM 变量：</p>
<ul>
<li><code>4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14:FirmwareFeatures</code></li>
<li><code>4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14:ExtendedFirmwareFeatures</code></li>
</ul>
<h3 id="5-FirmwareFeaturesMask">5. <code>FirmwareFeaturesMask</code></h3>
<p><strong>Type</strong>: <code>plist data</code>, 8 bytes<br>
<strong>Failsafe</strong>: Not installed<br>
<strong>Description</strong>: 此变量与 <code>FirmwareFeatures</code> 配对使用。指定 NVRAM 变量：</p>
<ul>
<li><code>4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14:FirmwareFeaturesMask</code></li>
<li><code>4D1EDE05-38C7-4A6A-9CC6-4BCCA8B38C14:ExtendedFirmwareFeaturesMask</code></li>
</ul>
<h2 id="10-5-SMBIOS-Properties">10.5 SMBIOS Properties</h2>
<h3 id="1-BIOSVendor">1. <code>BIOSVendor</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: OEM specified<br>
<strong>SMBIOS</strong>: BIOS Information (Type 0) — Vendor<br>
<strong>Description</strong>: BIOS 供应商。<code>SystemManufacturer</code> 的所有规则都适用。</p>
<h3 id="2-BIOSVersion">2. <code>BIOSVersion</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: OEM specified<br>
<strong>SMBIOS</strong>: BIOS Information (Type 0) — BIOS Version<br>
<strong>Description</strong>: 固件版本。此值更新时会同时影响更新推送配置文件以及 macOS 版本的兼容性。在较旧的固件中看起来类似于 <code>MM71.88Z.0234.B00.1809171422</code>，并且在 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg/blob/master/Include/Apple/Guid/BiosId.h">BiosId.h</a> 中有所描述。在较新的固件中看起来类似于 <code>236.0.0.0.0</code> 或 <code>220.230.16.0.0 (iBridge: 16.16.2542.0.0,0)</code>。 iBridge 版本是从 <code>BridgeOSVersion</code> 变量中读取的，并且只在具有 T2 芯片的 Mac 上有显示。</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Apple ROM Version</span><br><span class="line"> BIOS ID:      MBP151.88Z.F000.B00.1811142212</span><br><span class="line"> Model:        MBP151</span><br><span class="line"> EFI Version:  220.230.16.0.0</span><br><span class="line"> Built by:     root@quinoa</span><br><span class="line"> Date:         Wed Nov 14 22:12:53 2018</span><br><span class="line"> Revision:     220.230.16 (B&amp;I)</span><br><span class="line"> ROM Version:  F000_B00</span><br><span class="line"> Build Type:   Official Build, RELEASE</span><br><span class="line"> Compiler:     Apple LLVM version 10.0.0 (clang-1000.2.42)</span><br><span class="line"> UUID:         E5D1475B-29FF-32BA-8552-682622BA42E1</span><br><span class="line"> UUID:         151B0907-10F9-3271-87CD-4BF5DBECACF5</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 3. &#96;BIOSReleaseDate&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist string&#96;</span><br><span class="line">**Failsafe**: OEM specified</span><br><span class="line">**SMBIOS**: BIOS Information (Type 0) --- BIOS Release Date</span><br><span class="line">**Description**: 固件发布日期。与 &#96;BIOSVersion&#96; 类似，看起来像是 &#96;12&#x2F;08&#x2F;2017&#96; 这种格式。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 4. &#96;SystemManufacturer&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist string&#96;</span><br><span class="line">**Failsafe**: OEM specified</span><br><span class="line">**SMBIOS**: System Information (Type 1) --- Manufacturer</span><br><span class="line">**Description**: 特定主板的 OEM 制造商。除非特别需要，否则最好不要设定，也不要包含 &#96;Apple Inc.&#96; 字样，这样做会混淆操作系统中的大量服务，例如固件更新、eficheck 以及 Acidanthera 开发的内核扩展（如 Lilu 及其插件）。此外还可能导致某些操作系统（如 Linux）无法引导。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 5. &#96;SystemProductName&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist string&#96;</span><br><span class="line">**Failsafe**: OEM specified</span><br><span class="line">**SMBIOS**: System Information (Type 1), Product Name</span><br><span class="line">**Description**: 选择偏好的 Mac 机型来把设备标记为系统支持的机型。在任何配置中都应指定该值，以便之后自动生成 SMBIOS 表的相关值和相关配置参数。如果 &#96;SystemProductName&#96; 与目标操作系统不兼容，可用引导参数 &#96;-no_compat_check&#96; 来覆盖。</span><br><span class="line"></span><br><span class="line">_注_：如果 &#96;SystemProductName&#96; 位置，并且相关字段也未指定，默认值会被设定为 &#96;MacPro6,1&#96;。目前已知产品的列表详见 &#96;MacInfoPkg&#96;。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 6. &#96;SystemVersion&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist string&#96;</span><br><span class="line">**Failsafe**: OEM specified</span><br><span class="line">**SMBIOS**: System Information (Type 1) --- Version</span><br><span class="line">**Description**: 产品迭代版本号。可能与 &#96;1.1&#96; 类似。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 7. &#96;SystemSerialNumber&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist string&#96;</span><br><span class="line">**Failsafe**: OEM specified</span><br><span class="line">**SMBIOS**: System Information (Type 1) --- Serial Number</span><br><span class="line">**Description**: 按照格式定义的产品序列号。已知的序列号的格式在 [macserial](https:&#x2F;&#x2F;github.com&#x2F;acidanthera&#x2F;OpenCorePkg&#x2F;blob&#x2F;master&#x2F;Utilities&#x2F;macserial&#x2F;FORMAT.md) 中可以找到。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 8. &#96;SystemUUID&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist string&#96;, GUID</span><br><span class="line">**Failsafe**: OEM specified</span><br><span class="line">**SMBIOS**: System Information (Type 1) --- UUID</span><br><span class="line">**Description**: UUID 被设计为在时间和空间上都是唯一的标识符，其生成是随机与去中心化的。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 9. &#96;SystemSKUNumber&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist string&#96;</span><br><span class="line">**Failsafe**: OEM specified</span><br><span class="line">**SMBIOS**: System Information (Type 1) --- SKU Number</span><br><span class="line">**Description**: Mac 主板 ID (&#96;board-id&#96;)。在旧型号的机器中看起来类似于 &#96;Mac-7BA5B2D9E42DDD94&#96; 或 &#96;Mac-F221BEC8&#96;。有时可以直接留空。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 10. &#96;SystemFamily&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist string&#96;</span><br><span class="line">**Failsafe**: OEM specified</span><br><span class="line">**SMBIOS**: System Information (Type 1) --- Family</span><br><span class="line">**Description**: 系列名称，看起来类似于 &#96;iMac Pro&#96;。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 11. &#96;BoardManufacturer&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist string&#96;</span><br><span class="line">**Failsafe**: OEM specified</span><br><span class="line">**SMBIOS**: Baseboard (or Module) Information (Type 2) - Manufacturer</span><br><span class="line">**Description**: 主板制造商。&#96;SystemManufacturer&#96; 的所有规则都适用。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 12. &#96;BoardProduct&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist string&#96;</span><br><span class="line">**Failsafe**: OEM specified</span><br><span class="line">**SMBIOS**: Baseboard (or Module) Information (Type 2) - Product</span><br><span class="line">**Description**: Mac 主板 ID (&#96;board-id&#96;)。在旧型号机器中看起来类似于 &#96;Mac-7BA5B2D9E42DDD94&#96; 或 &#96;Mac-F221BEC8&#96;。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 13. &#96;BoardVersion&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist string&#96;</span><br><span class="line">**Failsafe**: OEM specified</span><br><span class="line">**SMBIOS**: Baseboard (or Module) Information (Type 2) - Version</span><br><span class="line">**Description**: 主板版本号。有各种各样，可能与 &#96;SystemProductName&#96; 或 &#96;SystemProductVersion&#96; 匹配。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 14. &#96;BoardSerialNumber&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist string&#96;</span><br><span class="line">**Failsafe**: OEM specified</span><br><span class="line">**SMBIOS**: Baseboard (or Module) Information (Type 2) --- Serial Number</span><br><span class="line">**Description**: 主板序列号，有对应的格式，具体格式见 [macserial](https:&#x2F;&#x2F;github.com&#x2F;acidanthera&#x2F;OpenCorePkg&#x2F;blob&#x2F;master&#x2F;Utilities&#x2F;macserial&#x2F;FORMAT.md) 的描述。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 15. &#96;BoardAssetTag&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist string&#96;</span><br><span class="line">**Failsafe**: OEM specified</span><br><span class="line">**SMBIOS**: Baseboard (or Module) Information (Type 2) --- Asset Tag</span><br><span class="line">**Description**: 资产标签号。有各种各样，可以留空或填 &#96;Type2 - Board Asset Tag&#96;。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 16. &#96;BoardType&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist integer&#96;</span><br><span class="line">**Failsafe**: OEM specified</span><br><span class="line">**SMBIOS**: Baseboard (or Module) Information (Type 2) --- Board Type</span><br><span class="line">**Description**:  &#96;0xA&#96; (Motherboard (includes processor, memory, and I&#x2F;O) 或 &#96;0xB&#96; (Processor&#x2F;Memory Module)，详见 Table 15 -- Baseboard: Board Type for more details。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 17. &#96;BoardLocationInChassis&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist string&#96;</span><br><span class="line">**Failsafe**: OEM specified</span><br><span class="line">**SMBIOS**: Baseboard (or Module) Information (Type 2) --- Location in Chassis</span><br><span class="line">**Description**: 各种各样，可以留空或填 &#96;Part Component&#96;。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 18. &#96;ChassisManufacturer&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist string&#96;</span><br><span class="line">**Failsafe**: OEM specified</span><br><span class="line">**SMBIOS**: System Enclosure or Chassis (Type 3) --- Manufacturer</span><br><span class="line">**Description**: 主板制造商。&#96;SystemManufacturer&#96; 的所有规则都适用。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 19. &#96;ChassisType&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist integer&#96;</span><br><span class="line">**Failsafe**: OEM specified</span><br><span class="line">**SMBIOS**: System Enclosure or Chassis (Type 3) --- Type</span><br><span class="line">**Description**: 机箱类型，详见 Table 17 --- System Enclosure or Chassis Types。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 20. &#96;ChassisVersion&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist string&#96;</span><br><span class="line">**Failsafe**: OEM specified</span><br><span class="line">**SMBIOS**: System Enclosure or Chassis (Type 3) --- Version</span><br><span class="line">**Description**: 应和 &#96;BoardProduct&#96; 符合。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 21. &#96;ChassisSerialNumber&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist string&#96;</span><br><span class="line">**Failsafe**: OEM specified</span><br><span class="line">**SMBIOS**: System Enclosure or Chassis (Type 3) --- Version</span><br><span class="line">**Description**: 应和 &#96;SystemSerialNumber&#96; 符合。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 22. &#96;ChassisAssetTag&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist string&#96;</span><br><span class="line">**Failsafe**: OEM specified</span><br><span class="line">**SMBIOS**: System Enclosure or Chassis (Type 3) --- Asset Tag Number</span><br><span class="line">**Description**: 机箱类型名称。有各种各样，可以留空或填 &#96;MacBook-Aluminum&#96;。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 23. &#96;PlatformFeature&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist integer&#96;, 32-bit</span><br><span class="line">**Failsafe**: &#96;0xFFFFFFFF&#96;</span><br><span class="line">**SMBIOS**: &#96;APPLE_SMBIOS_TABLE_TYPE133&#96; - &#96;PlatformFeature&#96;</span><br><span class="line">**Description**: 平台功能位掩码，详见 [AppleFeatures.h](https:&#x2F;&#x2F;github.com&#x2F;acidanthera&#x2F;OpenCorePkg&#x2F;blob&#x2F;master&#x2F;Include&#x2F;Apple&#x2F;IndustryStandard&#x2F;AppleFeatures.h)。填写 &#96;0xFFFFFFFF&#96; 值时不提供此表。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 24. &#96;SmcVersion&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist data&#96;, 16 bytes</span><br><span class="line">**Failsafe**: All zero</span><br><span class="line">**SMBIOS**: &#96;APPLE_SMBIOS_TABLE_TYPE134&#96; - &#96;Version&#96;</span><br><span class="line">**Description**: ASCII 字符串，包含 SMC 版本号（大写）。在基于 T2 芯片的 Mac 设备上缺少这一字段。当此值设置为零时，这一选项会被忽略。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 25. &#96;FirmwareFeatures&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist data&#96;, 8 bytes</span><br><span class="line">**Failsafe**: &#96;0&#96;</span><br><span class="line">**SMBIOS**: &#96;APPLE_SMBIOS_TABLE_TYPE128&#96; - &#96;FirmwareFeatures&#96; and &#96;ExtendedFirmwareFeatures&#96;</span><br><span class="line">**Description**: 64 位固件功能位掩码。详见 [AppleFeatures.h](https:&#x2F;&#x2F;github.com&#x2F;acidanthera&#x2F;OpenCorePkg&#x2F;blob&#x2F;master&#x2F;Apple&#x2F;Include&#x2F;IndustryStandard&#x2F;AppleFeatures.h)。低 32 位与 &#96;FirmwareFeatures&#96; 匹配，高 64 位与 &#96;ExtendedFirmwareFeatures&#96; 匹配。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 26.&#96;FirmwareFeaturesMask&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist data&#96;, 8 bytes</span><br><span class="line">**Failsafe**: &#96;0&#96;</span><br><span class="line">**SMBIOS**: &#96;APPLE_SMBIOS_TABLE_TYPE128&#96; - &#96;FirmwareFeaturesMask&#96; and &#96;ExtendedFirmwareFeaturesMask&#96;</span><br><span class="line">**Description**: 扩展固件功能位掩码。详见 [AppleFeatures.h](https:&#x2F;&#x2F;github.com&#x2F;acidanthera&#x2F;OpenCorePkg&#x2F;blob&#x2F;master&#x2F;Apple&#x2F;Include&#x2F;IndustryStandard&#x2F;AppleFeatures.h)。低 32 位与 &#96;FirmwareFeatures&#96; 匹配，高 64 位与 &#96;ExtendedFirmwareFeatures&#96; 匹配。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 27. &#96;ProcessorType&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist integer&#96;, 16-bit</span><br><span class="line">**Failsafe**: Automatic</span><br><span class="line">**SMBIOS**: &#96;APPLE_SMBIOS_TABLE_TYPE131&#96; - &#96;ProcessorType&#96;</span><br><span class="line">**Description**: 由处理器的主要和次要类型组成。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 28. &#96;MemoryFormFactor&#96;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**Type**: &#96;plist integer&#96;, 8-bit</span><br><span class="line">**Failsafe**: OEM specified</span><br><span class="line">**SMBIOS**: Memory Device (Type 17) --- Form Factor</span><br><span class="line">**Description**: Memory Form Factor。在 Mac 上应为 DIMM 或 SODIMM。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 11. UEFI</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 11.1 Introduction</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[UEFI](https:&#x2F;&#x2F;uefi.org&#x2F;specifications)（统一可扩展固件接口）是一种规范，用于定义操作系统和平台固件之间的软件接口。本部分允许加载其他 UEFI 模块 和&#x2F;或 对板载固件进行调整。要检查固件内容，应用修改并执行升级，可以使用 [UEFITool](https:&#x2F;&#x2F;github.com&#x2F;LongSoft&#x2F;UEFITool&#x2F;releases) 和其他实用程序。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 11.2 Drivers</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">根据固件不同、可能需要不同的驱动程序。加载不兼容的驱动程序可能会导致无法启动系统，甚至导致固件永久性损坏。OpenCore 目前对以下 UEFI 驱动提供支持。OpenCore 可能兼容对其他 UEFI 驱动，但不能确定。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- [&#96;OpenRuntime&#96;](https:&#x2F;&#x2F;github.com&#x2F;acidanthera&#x2F;OpenCorePkg) --- （原名 &#96;FwRuntimeServices.efi&#96;）&#96;OC_FIRMWARE_RUNTIME&#96; 协议通过支持只读、只写 NVRAM 变量，提升了 OpenCore 和 Lilu 的安全性。有些 Quirks 如 &#96;RequestBootVarRouting&#96; 依赖此驱动程序。由于 runtime 驱动饿性质（与目标操作系统并行运行），因此它不能在 OpenCore 本身实现，而是与 OpenCore 捆绑在一起。</span><br><span class="line">- [&#96;HiiDatabase&#96;](https:&#x2F;&#x2F;github.com&#x2F;acidanthera&#x2F;audk) --- 来自 &#96;MdeModulePkg&#96; 的 HII 服务驱动。Ivy Bridge 及其以后的大多数固件中都已内置此驱动程序。某些带有 GUI 的应用程序（例如 UEFI Shell）可能需要此驱动程序才能正常工作。</span><br><span class="line">- [&#96;EnhancedFatDxe&#96;](https:&#x2F;&#x2F;github.com&#x2F;acidanthera&#x2F;audk) --- 来自 &#96;FatPkg&#96; 的 FAT 文件系统驱动程序。这个驱动程序已经被嵌入到所有 UEFI 固件中，无法为 OpenCore 使用。众所周知，许多固件的 FAT 支持实现都有错误，导致在尝试写操作时损坏文件系统。如果在引导过程中需要写入 EFI 分区，则可能组要将此驱动程序嵌入固件中。</span><br><span class="line">- [&#96;NvmExpressDxe&#96;](https:&#x2F;&#x2F;github.com&#x2F;acidanthera&#x2F;audk) --- 来自&#96;MdeModulePkg&#96; 的 NVMe 驱动程序。从 Broadwell 一代开始的大多数固件都包含此驱动程序。对于 Haswell 以及更早的版本，如果安装了 NVMe SSD 驱动器，则将其嵌入固件中可能会更理想。</span><br><span class="line">- [&#96;OpenUsbKbDxe&#96;](https:&#x2F;&#x2F;github.com&#x2F;acidanthera&#x2F;OpenCorePkg) --- USB 键盘驱动在自定义 USB 键盘驱动程序的基础上新增了对 &#96;AppleKeyMapAggregator&#96; 协议的支持。这是内置的 &#96;KeySupport&#96; 的等效替代方案。根据固件不同，效果可能会更好或者更糟。</span><br><span class="line">- [&#96;HfsPlus&#96;](https:&#x2F;&#x2F;github.com&#x2F;acidanthera&#x2F;OcBinaryData) - Apple 固件中常见的具有 Bless 支持的专有 HFS 文件系统驱动程序。对于 &#96;Sandy Bridge&#96; 和更早的 CPU，由于缺少 &#96;RDRAND&#96; 指令支持，应使用 &#96;HfsPlusLegacy&#96; 驱动程序。</span><br><span class="line">- [&#96;VBoxHfs&#96;](https:&#x2F;&#x2F;github.com&#x2F;acidanthera&#x2F;OpenCorePkg) --- 带有 bless 支持的 HFS 文件系统驱动。是 Apple 固件中 &#96;HfsPlus&#96; 驱动的开源替代。虽然功能完善，但是启动速度比 &#96;HFSPlus&#96; 慢三倍，并且尚未经过安全审核。</span><br><span class="line">- [&#96;XhciDxe&#96;](https:&#x2F;&#x2F;github.com&#x2F;acidanthera&#x2F;audk) --- 来自 &#96;MdeModulePkg&#96; 的 XHCI USB controller 驱动程序。从 Sandy Bridge 代开始的大多数固件中都包含此驱动程序。在较早的固件或旧系统可以用于支持外部 USB 3.0 PCI 卡。</span><br><span class="line">- [&#96;AudioDxe&#96;](https:&#x2F;&#x2F;github.com&#x2F;acidanthera&#x2F;OpenCorePkg) --- UEFI 固件中的 HDA 音频驱动程序，适用于大多数 Intel 和其他一些模拟音频控制器。Refer to [acidanthera&#x2F;bugtracker#740](https:&#x2F;&#x2F;github.com&#x2F;acidanthera&#x2F;bugtracker&#x2F;issues&#x2F;740) for known issues in AudioDxe.</span><br><span class="line">- [&#96;ExFatDxe&#96;](https:&#x2F;&#x2F;github.com&#x2F;acidanthera&#x2F;OcBinaryData) --- 用于 Bootcamp 支持的专有 ExFAT 文件系统驱动程序，通常可以在 Apple 固件中找到。 对于 &#96;Sandy Bridge&#96; 和更早的 CPU，由于缺少 &#96;RDRAND&#96; 指令支持，应使用 &#96;ExFatDxeLegacy&#96; 驱动程序。</span><br><span class="line">- [&#96;Ps2KeyboardDxe&#96;](https:&#x2F;&#x2F;github.com&#x2F;acidanthera&#x2F;audk) --- 从 &#96;MdeModulePkg&#96; 提取出来的 PS&#x2F;2 键盘驱动。OpenDuetPkg 和一些固件可能不包括这个驱动，但对于 PS&#x2F;2 键盘来说该驱动是必须的。注：和 &#96;OpenUsbKbDxe&#96; 不同，该驱动不提供对 &#96;AppleKeyMapAggregator&#96; 的支持、因此需要启用 &#96;KeySupport&#96; 这个 Quirk。</span><br><span class="line">- [&#96;Ps2MouseDxe&#96;](https:&#x2F;&#x2F;github.com&#x2F;acidanthera&#x2F;audk) --- 从 &#96;MdeModulePkg&#96; 提取出来的 PS&#x2F;2 鼠标驱动。该固件，虽然只有非常老旧的笔记本的固件中可能没有不包含该驱动，但是笔记本依赖该驱动才能在引导界面使用触控板。</span><br><span class="line">- [&#96;UsbMouseDxe&#96;](https:&#x2F;&#x2F;github.com&#x2F;acidanthera&#x2F;audk) --- 从 &#96;MdeModulePkg&#96; 提取出来的 USB 鼠标驱动。该固件，一般只有虚拟机（如 OVMF）的固件中可能没有不包含该驱动，但是这些虚拟机依赖该驱动才能在引导界面使用鼠标。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">要从 UDK（EDK II）编译驱动程序，可以使用编译 OpenCore 类似的命令。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;bash</span><br><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;acidanthera&#x2F;audk UDK</span><br><span class="line">cd UDK</span><br><span class="line">source edksetup.sh</span><br><span class="line">make -C BaseTools</span><br><span class="line">build -a X64 -b RELEASE -t XCODE5 -p FatPkg&#x2F;FatPkg.dsc</span><br><span class="line">build -a X64 -b RELEASE -t XCODE5 -p MdeModulePkg&#x2F;MdeModulePkg.dsc</span><br></pre></td></tr></table></figure>
<h2 id="11-3-Tools">11.3 Tools</h2>
<p>一些不依赖 OpenCore 的工具可以帮助调试固件和硬件。下面列出了一些已知的工具。虽然有些工具可以从 OpenCore 启动，但大部分工具都应该直接或从 <code>OpenCoreShell</code> 中单独运行。</p>
<p>要启动到 <code>OpenShell</code> 或任何其他工具，直接将 <code>OpenShell.efi</code> 保存在 FAT32 分区中的 <code>EFI/BOOT/BOOTX64.EFI</code> 下。此时分区方案是 <code>GPT</code> 还是 <code>MBR</code> 并不重要。<br>
虽然这种方法可以在 Mac 和其他计算机上都可以使用，但是如果只在 Mac 上使用的话还可以在 HFS+ 或 APFS 分区上使用该工具。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo bless --verbose --file /Volumes/VOLNAME/DIR/OpenShell.efi --folder /Volumes/VOLNAME/DIR/ --setBoot</span><br></pre></td></tr></table></figure>
<p><em>Note 1</em>: You may have to copy <code>/System/Library/CoreServices/BridgeVersion.bin</code> to <code>/Volumes/VOLNAME/DIR</code>.<br>
<em>Note 2</em>: To be able to use <code>bless</code> you may have to <a target="_blank" rel="noopener" href="https://developer.apple.com/library/archive/documentation/Security/Conceptual/System_Integrity_Protection_Guide/ConfiguringSystemIntegrityProtection/ConfiguringSystemIntegrityProtection.html">disable System Integrity Protection</a>.<br>
<em>Note 3</em>: To be able to boot you may have to <a target="_blank" rel="noopener" href="https://support.apple.com/HT208330">disable Secure Boot</a> if present.</p>
<p>一些已知的 UEFI 工具：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg"><code>BootKicker</code></a> (<strong>内置</strong>) - 进入 Apple 的 BootPicker 菜单（仅 Mac 同款显卡才可以使用）。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg"><code>ChipTune</code></a> (<strong>内置</strong>) - 测试 BeepGen 协议，生成不同频率和长度的音频信号。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg"><code>CleanNvram</code></a> (<strong>内置</strong>) - 重置 NVRAM，以一个单独的工具呈现。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg"><code>FwProtect</code></a> (<strong>内置</strong>) - 解锁和回锁 NVRAM 保护，让其他工具在从 OpenCore 启动时能够获得完整的 NVRAM 访问权限。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg"><code>GopStop</code></a> (<strong>内置</strong>) - 用一个 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg/tree/master/Application/GopStop">简单的场景</a> 测试 GraphicOutput 协议。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg"><code>HdaCodecDump</code></a> (<strong>内置</strong>) - 解析和转储高清晰度音频编解码器（Codec）信息（需要 <code>AudioDxe</code>）。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg"><code>KeyTester</code></a> (<strong>内置</strong>) - 在 <code>SimpleText</code> 模式下测试键盘输入。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg"><code>OpenCore Shell</code></a> (<strong>内置</strong>) - 由 OpenCore 配置的 <a target="_blank" rel="noopener" href="http://github.com/tianocore/edk2"><code>UEFI Shell</code></a>，与绝大部分固件兼容。</li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg"><code>RtcRw</code></a> - Utility to read and write RTC (CMOS) memory.</li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg"><code>PavpProvision</code></a> - Perform EPID provisioning (requires certificate data configuration).</li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg"><code>ResetSystem</code></a> - Utility to perform system reset. Takes reset type as an argument: <code>ColdReset</code>, <code>WarmReset</code>, <code>Shutdown</code>. Default to <code>ColdReset</code>.</li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg"><code>VerifyMsrE2</code></a> (<strong>内置</strong>) - 检查 <code>CFG Lock</code>（MSR <code>0xE2</code> 写保护）在所有 CPU 核心之间的一致性。</li>
</ul>
<h2 id="11-4-OpenCanopy">11.4 OpenCanopy</h2>
<p>OpenCanopy 是一个 OpenCore 的图形化界面接口，基于 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg">OpenCorePkg</a> <code>OcBootManagementLib</code> 实现，提供与现有的文字模式类似的功能。当 <code>PickerMode</code> 设置为 <code>External</code> 时启用。</p>
<p>OpenCanopy 所需的图象资源位于 <code>Resources</code> 目录下，一些简单的资源（字体和图标）可以在 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/OcBinaryData">OcBinaryData 仓库</a> 中获取。<br>
字体为 12pt 的 Helvetica，比例缩放。</p>
<p>Font format corresponds to <a target="_blank" rel="noopener" href="https://www.angelcode.com/products/bmfont">AngelCode binary BMF</a>. While there are many utilities to generate font files, currently it is recommended to use <a target="_blank" rel="noopener" href="https://github.com/danpla/dpfontbaker">dpFontBaker</a> to generate bitmap font (<a target="_blank" rel="noopener" href="https://github.com/danpla/dpfontbaker/pull/1">using CoreText produces best results</a>) and <a target="_blank" rel="noopener" href="https://github.com/usr-sse2/fonverter">fonverter</a> to export it to binary format.</p>
<p><em>Note</em>: OpenCanopy 是一个试验性质的功能、不应用于日常使用。你可以在 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/bugtracker/issues/759">acidanthera/bugtracker#759</a> 获取相关的详细信息。</p>
<h2 id="11-5-OpenRuntime">11.5 OpenRuntime</h2>
<p><code>OpenRuntime</code> 是一个 OpenCore 的插件，提供了对 <code>OC_FIRMWARE_RUNTIME</code> 协议的实现。该协议对 OpenCore 的部分功能提供了支持，而这部分功能由于需要 Runtime（如操作系统）中运行、因此无法内置在 OpenCore 中。该协议提供了包括但不限于如下功能：</p>
<ul>
<li>NVRAM namespaces, allowing to isolate operating systems from accessing select variables (e.g. <code>RequestBootVarRouting</code> or <code>ProtectSecureBoot</code>).</li>
<li>Read-only and write-only NVRAM variables, enhancing the security of OpenCore, Lilu, and Lilu plugins, like VirtualSMC, which implements <code>AuthRestart</code> support.</li>
<li>NVRAM isolation, allowing to protect all variables from being written from an untrusted operating system (e.g. <code>DisableVariableWrite</code>).</li>
<li>UEFI Runtime Services memory protection management to workaround read-only mapping (e.g. <code>EnableWriteUnprotector</code>).</li>
</ul>
<h2 id="11-6-Properties">11.6 Properties</h2>
<h3 id="APFS"><code>APFS</code></h3>
<p><strong>Type</strong>: <code>plist dict</code><br>
<strong>Failsafe</strong>: None<br>
<strong>Description</strong>: 配置 APFS 分区驱动，具体配置内容参见下文 <code>APFS Properties</code> 部分。</p>
<h3 id="Audio"><code>Audio</code></h3>
<p><strong>Type</strong>: <code>plist dict</code><br>
<strong>Failsafe</strong>: None<br>
<strong>Description</strong>: 配置音频后端支持，具体配置如下文所述。</p>
<p>Audio support provides a way for upstream protocols to interact with the selected hardware and audio resources. All audio resources should reside in <code>\EFI\OC\Resources\Audio</code> directory. Currently the only supported audio file format is WAVE PCM. While it is driver-dependent which audio stream format is supported, most common audio cards support 16-bit signed stereo audio at 44100 or 48000 Hz.</p>
<p>Audio file path is determined by audio type, audio localisation, and audio path. Each filename looks as follows: <code>[audio type]_[audio localisation]_[audio path].wav</code>. For unlocalised files filename does not include the language code and looks as follows: <code>[audio type]_[audio path].wav</code>.</p>
<ul>
<li>Audio type can be <code>OCEFIAudio</code> for OpenCore audio files or <code>AXEFIAudio</code> for macOS bootloader audio files.</li>
<li>Audio localisation is a two letter language code (e.g. <code>en</code>) with an exception for Chinese, Spanish, and Portuguese. Refer to <a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg/blob/master/Include/Apple/Protocol/AppleVoiceOver.h"><code>APPLE_VOICE_OVER_LANGUAGE_CODE</code> definition</a> for the list of all supported localisations.</li>
<li>Audio path is the base filename corresponding to a file identifier. For macOS bootloader audio paths refer to <a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg/blob/master/Include/Apple/Protocol/AppleVoiceOver.h"><code>APPLE_VOICE_OVER_AUDIO_FILE</code> definition</a>. For OpenCore audio paths refer to <a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg/blob/master/Include/Protocol/OcAudio.h"><code>OC_VOICE_OVER_AUDIO_FILE</code> definition</a>. The only exception is OpenCore boot chime file, which is <code>OCEFIAudio_VoiceOver_Boot.wav</code>.</li>
</ul>
<p>Audio localisation is determined separately for macOS bootloader and OpenCore. For macOS bootloader it is set in <code>preferences.efires</code> archive in <code>systemLanguage.utf8</code> file and is controlled by the operating system. For OpenCore the value of <code>prev-lang:kbd</code> variable is used. When native audio localisation of a particular file is missing, English language (<code>en</code>) localisation is used. Sample audio files can be found in <a target="_blank" rel="noopener" href="https://github.com/acidanthera/OcBinaryData">OcBinaryData repository</a>.</p>
<h3 id="ConnectDrivers"><code>ConnectDrivers</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 驱动程序加载后执行 UEFI 控制器连接操作。</p>
<p>此选项对于加载某些遵循 UEFI 驱动模型的 驱动程序（如文件系统驱动、音频输出驱动）很有用，因为这些驱动可能无法自行启动。此选项对会自动连接的驱动程序来说是不必要的，并且可能会稍微减慢启动速度。</p>
<p><em>注</em>：某些固件（特别是 Apple 的）仅连接包含操作系统的驱动器以加快启动过程。启用此选项可以在拥有多个驱动器时查看所有引导选项。</p>
<h3 id="Drivers"><code>Drivers</code></h3>
<p><strong>Type</strong>: <code>plist array</code><br>
<strong>Failsafe</strong>: None<br>
<strong>Description</strong>: 从 <code>OC/Drivers</code> 目录下加载选择的驱动。</p>
<p>设计为填充 UEFI 驱动程序加载的文件名。</p>
<h3 id="Input"><code>Input</code></h3>
<p><strong>Type</strong>: <code>plist dict</code><br>
<strong>Failsafe</strong>: None<br>
<strong>Description</strong>: Apply individual settings designed for input (keyboard and mouse) in <a href="">Input Properties</a> section below.</p>
<h3 id="Output"><code>Output</code></h3>
<p><strong>Type</strong>: <code>plist dict</code><br>
<strong>Failsafe</strong>: None<br>
<strong>Description</strong>: Apply individual settings designed for output (text and graphics) in <a href="">Output Properties</a> section below.</p>
<h3 id="ProtocolOverrides"><code>ProtocolOverrides</code></h3>
<p><strong>Type</strong>: <code>plist dict</code><br>
<strong>Failsafe</strong>: None<br>
<strong>Description</strong>: Force builtin versions of select protocols described in <a href="">ProtocolOverrides Properties</a> section below.</p>
<p><em>注</em>：all protocol instances are installed prior to driver loading.</p>
<h3 id="Quirks"><code>Quirks</code></h3>
<p><strong>Type</strong>: <code>plist dict</code><br>
<strong>Failsafe</strong>: None<br>
<strong>Description</strong>: Apply individual firmware quirks described in <a href="">Quirks Properties</a> section below.</p>
<h3 id="ReservedMemory"><code>ReservedMemory</code></h3>
<p><strong>Type</strong>: <code>plist array</code><br>
<strong>Description</strong>: Designed to be filled with <code>plist dict</code> values, describing memory areas exquisite to particular firmware and hardware functioning, which should not be used by the operating system. An example of such memory region could be second 256 MB corrupted by Intel HD 3000 or an area with faulty RAM.</p>
<h2 id="11-7-APFS-Properties">11.7 APFS Properties</h2>
<h3 id="EnableJumpstart"><code>EnableJumpstart</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>False</code><br>
<strong>Description</strong>: 从一个 APFS 容器中加载 APFS 驱动。</p>
<p>APFS 的 EFI 驱动内置在所有可以作为系统启动盘的 APFS 容器之中。这一选项将会根据基于 <code>ScanPolicy</code> 找到的 APFS 容器，从中加载 APFS 驱动。更多详情请查看 <a target="_blank" rel="noopener" href="https://developer.apple.com/support/apple-file-system/Apple-File-System-Reference.pdf">苹果 APFS 文件系统参考手册</a> 中的 <code>EFI Jummpstart</code> 章节。</p>
<h3 id="HideVerbose"><code>HideVerbose</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>False</code><br>
<strong>Description</strong>: 是否隐藏 APFS 驱动的 verbose 信息。</p>
<p>APFS 驱动的 verbose 信息有助于 debug。</p>
<h3 id="JumpstartHotPlug"><code>JumpstartHotPlug</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>False</code><br>
<strong>Description</strong>: 允许从进入 OpenCore 引导菜单后插入的可移除硬盘上的 APFS 容器中加载 APFS 驱动。</p>
<p>这一选项不仅提供了进入 OpenCore 以后再插入 U 盘的支持，而且还允许了在 OpenCore 引导菜单下 APFS U 盘的热插拔。</p>
<h3 id="MinDate"><code>MinDate</code></h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: 允许加载的最老 APFS 驱动的发布日期</p>
<p>APFS 驱动的版本号基于其发布日期。较旧版本的 APFS 驱动可能与较新的系统不兼容、或者有未修补的漏洞。通过这一选项可以避免 OpenCore 加载过旧版本的 APFS 驱动。</p>
<ul>
<li><code>0</code> - 使用默认数值。OpenCore 会随着未来更新，内置的默认数值也会不断更新。如果你会一直更新你的系统，我们推荐使用这一数值。目前默认数值为 <code>2018/06/21</code>。</li>
<li><code>-1</code> - 允许使用任何版本的 APFS 驱动（强烈不推荐）。</li>
<li>其他数值 - 数值格式应为形如 <code>20200401</code> 的格式。你可以从 OpenCore 的启动日志和 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg/blob/master/Include/Library/OcApfsLib.h">OcApfsLib</a> 中找到 APFS 驱动的版本号。</li>
</ul>
<h3 id="MinVersion"><code>MinVersion</code></h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: 允许加载的最老 APFS 驱动的版本号</p>
<p>APFS 驱动的版本号和 macOS 版本相关。较旧版本的 APFS 驱动可能与较新的系统不兼容、或者有未修补的漏洞。通过这一选项可以避免 OpenCore 加载过旧版本的 APFS 驱动。</p>
<ul>
<li><code>0</code> - 使用默认数值。OpenCore 会随着未来更新，内置的默认数值也会不断更新。如果你会一直更新你的系统，我们推荐使用这一数值。目前默认数值选自 App Store 中能够下载到的 High Sierra（<code>748077008000000</code>）。</li>
<li><code>-1</code> - 允许使用任何版本的 APFS 驱动（强烈不推荐）。</li>
<li>其他数值 - 数值格式应为形如 <code>1412101001000000</code> 的格式（这是 macOS Catalina 10.15.4 的 APFS 驱动版本号）你可以从 OpenCore 的启动日志和 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg/blob/master/Include/Library/OcApfsLib.h">OcApfsLib</a> 中找到 APFS 驱动的版本号。</li>
</ul>
<h2 id="11-8-Audio-Properties">11.8 Audio Properties</h2>
<h3 id="AudioCodec"><code>AudioCodec</code></h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: Codec address on the specified audio controller for audio support.</p>
<p>Normally this contains first audio codec address on the builtin analog audio controller (<code>HDEF</code>). Audio codec addresses, e.g. <code>2</code>, can be found in the debug log (marked in bold):</p>
<p><code>OCAU: 1/3 PciRoot(0x0)/Pci(0x1,0x0)/Pci(0x0,0x1)/VenMsg(&lt;redacted&gt;,00000000) (4 outputs)</code><br>
<code>OCAU: 2/3 PciRoot(0x0)/Pci(0x3,0x0)/VenMsg(&lt;redacted&gt;,00000000) (1 outputs)</code><br>
<code>OCAU: 3/3 PciRoot(0x0)/Pci(0x1B,0x0)/VenMsg(&lt;redacted&gt;,02000000) (7 outputs)</code></p>
<p>As an alternative this value can be obtained from <code>IOHDACodecDevice</code> class in I/O Registry containing it in <code>IOHDACodecAddress</code> field.</p>
<h3 id="AudioDevice"><code>AudioDevice</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: empty string<br>
<strong>Description</strong>: Device path of the specified audio controller for audio support.</p>
<p>Normally this contains builtin analog audio controller (<code>HDEF</code>) device path, e.g. <code>PciRoot(0x0)/Pci(0x1b,0x0)</code>. The list of recognised audio controllers can be found in the debug log (marked in bold):</p>
<p><code>OCAU: 1/3 PciRoot(0x0)/Pci(0x1,0x0)/Pci(0x0,0x1)/VenMsg(&lt;redacted&gt;,00000000) (4 outputs)</code><br>
<code>OCAU: 2/3 PciRoot(0x0)/Pci(0x3,0x0)/VenMsg(&lt;redacted&gt;,00000000) (1 outputs)</code><br>
<code>OCAU: 3/3 PciRoot(0x0)/Pci(0x1B,0x0)/VenMsg(&lt;redacted&gt;,02000000) (7 outputs)</code></p>
<p>As an alternative <code>gfxutil -f HDEF</code> command can be used in macOS. Specifying empty device path will result in the first available audio controller to be used.</p>
<h3 id="AudioOut"><code>AudioOut</code></h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: Index of the output port of the specified codec starting from 0.</p>
<p>Normally this contains the index of the green out of the builtin analog audio controller (<code>HDEF</code>). The number of output nodes in the debug log (marked in bold):</p>
<p><code>OCAU: 1/3 PciRoot(0x0)/Pci(0x1,0x0)/Pci(0x0,0x1)/VenMsg(&lt;redacted&gt;,00000000) (4 outputs)</code><br>
<code>OCAU: 2/3 PciRoot(0x0)/Pci(0x3,0x0)/VenMsg(&lt;redacted&gt;,00000000) (1 outputs)</code><br>
<code>OCAU: 3/3 PciRoot(0x0)/Pci(0x1B,0x0)/VenMsg(&lt;redacted&gt;,02000000) (7 outputs)</code></p>
<p>The quickest way to find the right port is to bruteforce the values from <code>0</code> to <code>N - 1</code>.</p>
<h3 id="AudioSupport"><code>AudioSupport</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 通过连接到固件音频驱动程序以激活音频支持。</p>
<p>Enabling this setting routes audio playback from builtin protocols to a dedicated audio port (<code>AudioOut</code>) of the specified codec (<code>AudioCodec</code>) located on the audio controller (<code>AudioDevice</code>).</p>
<h3 id="MinimumVolume"><code>MinimumVolume</code></h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: Minimal heard volume level from <code>0</code> to <code>100</code>.</p>
<p>Screen reader will use this volume level, when the calculated volume level is less than <code>MinimumVolume</code>. Boot chime sound will not play if the calculated volume level is less than <code>MinimumVolume</code>.</p>
<h3 id="PlayChime"><code>PlayChime</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 开机时播放 Mac 特有的风铃的声音。</p>
<p>Enabling this setting plays boot chime through builtin audio support. Volume level is determined by <code>MinimumVolume</code> and <code>VolumeAmplifier</code> settings and <code>SystemAudioVolume</code> NVRAM variable.</p>
<p><em>Note</em>: this setting is separate from <code>StartupMute</code> NVRAM variable to avoid conflicts when the firmware is able to play boot chime.</p>
<h3 id="VolumeAmplifier"><code>VolumeAmplifier</code></h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: Multiplication coefficient for system volume to raw volume linear translation from <code>0</code> to <code>1000</code>.</p>
<p>Volume level range read from <code>SystemAudioVolume</code> varies depending on the codec. To transform read value in <code>[0, 127]</code> range into raw volume range<br>
<code>[0, 100]</code> the read value is scaled to <code>VolumeAmplifier</code> percents:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RawVolume &#x3D; MIN&#123; [(SystemAudioVolume * VolumeAmplifier) &#x2F; 100], 100 &#125;</span><br></pre></td></tr></table></figure>
<p><em>Note</em>: the transformation used in macOS is not linear, but it is very close and this nuance is thus ignored.</p>
<h2 id="11-9-Input-Properties">11.9 Input Properties</h2>
<h3 id="KeyFiltering"><code>KeyFiltering</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: Enable keyboard input sanity checking.</p>
<p>Apparently some boards like GA Z77P-D3 may return uninitialised data in <code>EFI_INPUT_KEY</code> with all input protocols. This option discards keys that are neither ASCII, nor are defined in the UEFI specification (see tables 107 and 108 in version 2.8).</p>
<h3 id="KeyForgetThreshold"><code>KeyForgetThreshold</code></h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: 两次按键之间的间隔时间，单位为毫秒。</p>
<p><code>AppleKeyMapAggregator</code> 协议应该包含当前按下的键的固定长度的缓冲。但是大部分驱动程序仅将按键按下报告为中断、并且按住按键会导致在一定的时间间隔后再提交按下行为。一旦超时到期，我们就是用超时从缓冲区中删除一次按下的键，并且没有新提交。</p>
<p>此选项允许根据你的平台设置此超时。在大多数平台上有效的推荐值为 <code>5</code> 毫秒。作为参考，在 VMWare 上按住一个键大约每 2 毫秒就会重复一次，而在 APTIO V 上是 3 - 4 毫秒。因此，可以在较快的平台上设置稍低的值、在较慢的平台设置稍高的值，以提高响应速度。</p>
<h3 id="KeyMergeThreshold"><code>KeyMergeThreshold</code></h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: 按住按键被重置的间隔时间，单位为毫秒。</p>
<p>与 <code>KeyForgetThreshold</code> 类似，这一选项适用于按键提交的顺序。为了能够识别同时按下的按键，我们需要设置一个超时时间，在这个时间内可以假定这两个按键是同时按下的。</p>
<p>对于 VMWare，同时按下多个键的间隔是 2 毫秒。对于 APTIO V 平台为 1 毫毛。一个接一个地按下按键会导致 6 毫秒和 10 毫秒的延迟。此选项的建议值为 2 毫秒，但对于较快的平台可以选取较小的值，反之亦然。</p>
<h3 id="KeySupport"><code>KeySupport</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 启用这一选项后将会开启内置键盘支持。</p>
<p>这一选项基于 <code>AppleGenericInput</code>（<code>AptioInputFix</code>），激活内部键盘拦截器驱动程序以填充 <code>AppleKeyMapAggregator</code> 数据库以实现输入功能。如果使用了单独的驱动程序（如 <code>AppleUsbKbDxe</code>），则永远不要开启这一选项。</p>
<h3 id="KeySupportMode"><code>KeySupportMode</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: empty string<br>
<strong>Description</strong>: 将内部键盘的输入转换设置为 <code>AppleKeyMapAggregator</code> 协议模式。</p>
<ul>
<li><code>Auto</code> — 从下述选项中自动选择</li>
<li><code>V1</code> — UEFI 传统输入协议 <code>EFI_SIMPLE_TEXT_INPUT_PROTOCOL</code>.</li>
<li><code>V2</code> — UEFI 现代标准输入协议 <code>EFI_SIMPLE_TEXT_INPUT_EX_PROTOCOL</code>.</li>
<li><code>AMI</code> — APTIO 输入协议 <code>AMI_EFIKEYCODE_PROTOCOL</code>.</li>
</ul>
<p><em>Note</em>: Currently <code>V1</code>, <code>V2</code>, and <code>AMI</code> unlike <code>Auto</code> only do filtering of the particular specified protocol. This may change in the future versions.</p>
<h3 id="KeySwap"><code>KeySwap</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 启用后将交换 <code>Command</code> 和 <code>Option</code>。</p>
<p>此选项对于 <code>Option</code> 键位于 <code>Command</code> 右侧的键盘来说会很有用。</p>
<h3 id="PointerSupport"><code>PointerSupport</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 启用后将试图修复 UEFI 选择器协议。</p>
<p>该选项通过选择 OEM 协议实现标准 UEFI 指针协议 <code>EFI_SIMPLE_POINTER_PROTOCOL</code>。该选项在 Z87 华硕主板可能有用（该主板的 <code>EFI_SIMPLE_POINTER_PROTOCOL</code> 存在问题）。</p>
<h3 id="PointerSupportMode"><code>PointerSupportMode</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: empty string<br>
<strong>Description</strong>: 设置用于内部指针驱动程序的 OEM 协议。</p>
<p>目前只支持 <code>ASUS</code> 值，使用的是 Z87 和 Z97 主板上的特殊协议。更多详情请参考 <a target="_blank" rel="noopener" href="https://github.com/LongSoft/UEFITool/pull/116"><code>LongSoft/UefiTool#116</code></a>。</p>
<h3 id="TimerResolution"><code>TimerResolution</code></h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: 固件始终刷新的频率（单位 100 纳秒）</p>
<p>设置较低的值可以提高界面和输入处理性能的响应能力。建议值为 <code>50000</code>（即 5 毫秒）或稍高一些。选择 ASUS Z87 主板时，请使用 <code>60000</code>，苹果主板请使用 <code>100000</code>。你也可以将此值保留为 0，由 OpenCore 自动计算。</p>
<h2 id="11-10-Output-Properties">11.10 Output Properties</h2>
<h3 id="TextRenderer"><code>TextRenderer</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: <code>BuiltinGraphics</code><br>
<strong>Description</strong>: 选择通过标准控制台输出的渲染器。</p>
<p>Currently two renderers are supported: <code>Builtin</code> and <code>System</code>. <code>System</code> renderer uses firmware services for text rendering. <code>Builtin</code> bypassing firmware services and performs text rendering on its own. Different renderers support a different set of options. It is recommended to use <code>Builtin</code> renderer, as it supports HiDPI mode and uses full screen resolution.</p>
<p>UEFI firmwares generally support <code>ConsoleControl</code> with two rendering modes: <code>Graphics</code> and <code>Text</code>. Some firmwares do not support <code>ConsoleControl</code> and rendering modes. OpenCore and macOS expect text to only be shown in <code>Graphics</code> mode and graphics to be drawn in any mode. Since this is not required by UEFI specification, exact behaviour varies.</p>
<p>Valid values are combinations of text renderer and rendering mode:</p>
<ul>
<li><code>BuiltinGraphics</code> — Switch to <code>Graphics</code> mode and use <code>Builtin</code> renderer with custom <code>ConsoleControl</code>.</li>
<li><code>SystemGraphics</code> — Switch to <code>Graphics</code> mode and use <code>System</code> renderer with custom <code>ConsoleControl</code>.</li>
<li><code>SystemText</code> — Switch to <code>Text</code> mode and use <code>System</code> renderer with custom <code>ConsoleControl</code>.</li>
<li><code>SystemGeneric</code> — Use <code>System</code> renderer with system <code>ConsoleControl</code> assuming it behaves correctly.</li>
</ul>
<p>The use of <code>BuiltinGraphics</code> is generally straightforward. For most platforms it is necessary to enable <code>ProvideConsoleGop</code>, set <code>Resolution</code> to <code>Max</code>.</p>
<p>The use of <code>System</code> protocols is more complicated. In general the preferred setting is <code>SystemGraphics</code> or <code>SystemText</code>. Enabling <code>ProvideConsoleGop</code>, setting <code>Resolution</code> to <code>Max</code>, enabling <code>ReplaceTabWithSpace</code> is useful on almost all platforms. <code>SanitiseClearScreen</code>, <code>IgnoreTextInGraphics</code>, and <code>ClearScreenOnModeSwitch</code> are more specific, and their use depends on the firmware.</p>
<p><em>注</em>：Some Macs, namely <code>MacPro5,1</code>, may have broken console output with newer GPUs, and thus only <code>BuiltinGraphics</code> may work for them.</p>
<h3 id="ConsoleMode"><code>ConsoleMode</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: Sets console output mode as specified with the <code>WxH</code> (e.g. <code>80x24</code>) formatted string.</p>
<p>Set to empty string not to change console mode. Set to <code>Max</code> to try to use largest available console mode. Currently <code>Builtin</code> text renderer supports only one console mode, so this option is ignored.</p>
<p><em>注</em>：This field is best to be left empty on most firmwares.</p>
<h3 id="Resolution"><code>Resolution</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: 设置控制台的屏幕分辨率。</p>
<ul>
<li>Set to <code>WxH@Bpp</code> (e.g. <code>1920x1080@32</code>) or <code>WxH</code> (e.g. <code>1920x1080</code>) formatted string to request custom resolution from GOP if available.</li>
<li>Set to empty string not to change screen resolution.</li>
<li>Set to <code>Max</code> to try to use largest available screen resolution.</li>
</ul>
<p>On HiDPI screens <code>APPLE_VENDOR_VARIABLE_GUID</code> <code>UIScale</code> NVRAM variable may need to be set to <code>02</code> to enable HiDPI scaling in in <code>Builtin</code> text renderer, FileVault 2 UEFI password interface, FileVault 2 UEFI password interface and boot screen logo. Refer to <a href="">Recommended Variables</a> section for more details.</p>
<p><em>注</em>：This will fail when console handle has no GOP protocol. When the firmware does not provide it, it can be added with <code>ProvideConsoleGop</code> set to <code>true</code>.</p>
<h3 id="ClearScreenOnModeSwitch"><code>ClearScreenOnModeSwitch</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 有些固件在从图形模式切换到文本模式时，只会清除部分屏幕、而会留下一部分之前绘制的图像。启用这一选项后，在切换到文本模式之前会用黑色填充整个图形屏幕。</p>
<p><em>注</em>：这一选项只会在 <code>System</code> 渲染器上生效。</p>
<h3 id="DirectGopRendering"><code>DirectGopRendering</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: Use builtin graphics output protocol renderer for console.</p>
<p>On some firmwares this may provide better performance or even fix rendering issues, like on <code>MacPro5,1</code>. However it is recommended not to use this option unless there is an obvious benefit as it may even result in slower scrolling.</p>
<h3 id="IgnoreTextInGraphics"><code>IgnoreTextInGraphics</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: Select firmwares output text onscreen in both graphics and text mode. This is normally unexpected, because random text may appear over graphical images and cause UI corruption. Setting this option to <code>true</code> will discard all text output when console control is in mode different from <code>Text</code>.</p>
<p><em>注</em>：This option only applies to <code>System</code> renderer.</p>
<h3 id="ReplaceTabWithSpace"><code>ReplaceTabWithSpace</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: Some firmwares do not print tab characters or even everything that follows them, causing difficulties or inability to use the UEFI Shell builtin text editor to edit property lists and other documents. This option makes the console output spaces instead of tabs.</p>
<p><em>注</em>：This option only applies to <code>System</code> renderer.</p>
<h3 id="ProvideConsoleGop"><code>ProvideConsoleGop</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: Ensure GOP (Graphics Output Protocol) on console handle.</p>
<p>macOS bootloader requires GOP to be present on console handle, yet the exact location of GOP is not covered by the UEFI specification. This option will ensure GOP is installed on console handle if it is present.</p>
<p><em>注</em>：This option will also replace broken GOP protocol on console handle, which may be the case on <code>MacPro5,1</code> with newer GPUs.</p>
<h3 id="ReconnectOnResChange"><code>ReconnectOnResChange</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: Reconnect console controllers after changing screen resolution.</p>
<p>On some firmwares when screen resolution is changed via GOP, it is required to reconnect the controllers, which produce the console protocols (simple text out). Otherwise they will not produce text based on the new resolution.</p>
<p><em>注</em>：On several boards this logic may result in black screen when launching OpenCore from Shell and thus it is optional. In versions prior to 0.5.2 this option was mandatory and not configurable. Please do not use this unless required.</p>
<h3 id="SanitiseClearScreen"><code>SanitiseClearScreen</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: Some firmwares reset screen resolution to a failsafe value (like <code>1024x768</code>) on the attempts to clear screen contents when large display (e.g. 2K or 4K) is used. This option attempts to apply a workaround.</p>
<p><em>注</em>：This option only applies to <code>System</code> renderer. On all known affected systems <code>ConsoleMode</code> had to be set to empty string for this to work.</p>
<h2 id="11-11-Protocols-Properties">11.11 Protocols Properties</h2>
<h3 id="AppleAudio"><code>AppleAudio</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: Reinstalls Apple audio protocols with builtin versions.</p>
<p>Apple audio protocols allow macOS bootloader and OpenCore to play sounds and signals for screen reading or audible error reporting. Supported<br>
protocols are beep generation and VoiceOver. VoiceOver protocol is specific to Gibraltar machines (T2) and is not supported before macOS High Sierra (10.13). Instead older macOS versions use AppleHDA protocol, which is currently not implemented.</p>
<p>Only one set of audio protocols can be available at a time, so in order to get audio playback in OpenCore user interface on Mac system implementing some of these protocols this setting should be enabled.</p>
<p><em>Note</em>: Backend audio driver needs to be configured in <code>UEFI Audio</code> section for these protocols to be able to stream audio.</p>
<h3 id="AppleBootPolicy"><code>AppleBootPolicy</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 重新安装内置的 Apple Boot Policy 协议，可用于确保 VM 或旧版 Mac 设备上的 APFS 兼容性。</p>
<p><em>注</em>：某些 Mac 设备（如 <code>MacPro5,1</code>）虽然兼容 APFS，但是其 Apple Boot Policy 协议包含了恢复分区检测问题，因此也建议启用这一选项。</p>
<h3 id="AppleDebugLog"><code>AppleDebugLog</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 重新安装内置的 Apple 调试日志输出协议。</p>
<h3 id="AppleEvent"><code>AppleEvent</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 重新安装内置的 Apple Event 协议，可以确保在 VM 或旧版 Mac 设备上的 Faile Vault V2 兼容性。</p>
<h3 id="AppleImageConversion"><code>AppleImageConversion</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 重新安装内置的 Apple Image Conservation 协议。</p>
<h3 id="AppleKeyMap"><code>AppleKeyMap</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 重新安装内置的 Apple Key Map 协议。</p>
<h3 id="AppleRtcRam"><code>AppleRtcRam</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 重新安装内置的 Apple RTC RAM 协议。</p>
<p><em>注</em>：内置的 Apple RTC RAM 协议可能会过滤掉 RTC 内存地址的潜在 I/O。地址列表可以在 <code>4D1FDA02-38C7-4A6A-9CC6-4BCCA8B30102:rtc-blacklist</code> 中以数组的方式指定。</p>
<h3 id="AppleSmcIo"><code>AppleSmcIo</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 重新安装内置的 SMC I/O 协议。</p>
<p>这一协议代替了传统的 <code>VirtualSmc.efi</code>，并与所有 SMC kext 驱动兼容。如果你在用 FakeSMC，可能需要手动往 NVRAM 中添加键值对。</p>
<h3 id="AppleUserInterfaceTheme"><code>AppleUserInterfaceTheme</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 重新安装内置的 Apple User Interface Theme 协议。</p>
<h3 id="DataHub"><code>DataHub</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 重新安装具有内置版本的 Data Hub 协议。如果已经安装了协议，这将删除所有先前的属性。</p>
<h3 id="DeviceProperties"><code>DeviceProperties</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 重新安装内置版本的 Device Property 协议。 如果已经安装，它将删除所有以前的属性。这一选项可用于确保在 VM 或旧版 Mac 设备上的兼容性。</p>
<h3 id="FirmwareVolume"><code>FirmwareVolume</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 强制包装固件卷协议或安装新版本以支持 File Vault 2 的自定义光标图像。建议启用这一选项以确保 File Vault 2 在除 VM 和传统 Mac 设备之外的兼容性。</p>
<p><em>注</em>：包括 VMWare 在内的多个虚拟机在 HiDPI 模式下光标会损坏，因此建议为所有虚拟机启用这一选项。</p>
<h3 id="HashServices"><code>HashServices</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 强制重新安装内置版本的 Hash Services 协议。为了在 SHA-1 哈希协议不完整的固件上确保 File Vault 2 的兼容性，这一 Quirk 应设置为 <code>true</code>。对于大多数固件来说，你可以通过将 <code>UIScale</code> 设置为 <code>02</code> 查看是否会出现禁行图标，来诊断你的固件是否需要这一 Quirk。一般来说，APTIO V（Haswell 和更早的平台）之前的平台都会受到影响。</p>
<h3 id="OSInfo"><code>OSInfo</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 强制使用内置版本重新安装 OS Info 协议。该协议通常用于通过固件或其他应用程序从 macOS 引导加载程序接收通知。</p>
<h3 id="UnicodeCollation"><code>UnicodeCollation</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 强制重新安装内置版本的 Unicode Collation 服务。建议启用这一选项以确保 UEFI Shell 的兼容性。一些较旧的固件破坏了 Unicode 排序规则, 启用后可以修复这些系统上 UEFI Shell 的兼容性 (通常为用于 IvyBridge 或更旧的设备)</p>
<h2 id="11-12-Quirks">11.12 Quirks</h2>
<h3 id="DeduplicateBootOrder"><code>DeduplicateBootOrder</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: Remove duplicate entries in <code>BootOrder</code> variable in <code>EFI_GLOBAL_VARIABLE_GUID</code>.</p>
<p>This quirk requires <code>RequestBootVarRouting</code> to be enabled and therefore <code>OC_FIRMWARE_RUNTIME</code> protocol implemented in <code>OpenRuntime.efi</code>.</p>
<p>By redirecting <code>Boot</code> prefixed variables to a separate GUID namespace with the help of <code>RequestBootVarRouting</code> quirk we achieve multiple goals:</p>
<ul>
<li>Operating systems are jailed and only controlled by OpenCore boot environment to enhance security.</li>
<li>Operating systems do not mess with OpenCore boot priority, and guarantee fluent updates and hibernation wakes for cases that require reboots with OpenCore in the middle.</li>
<li>Potentially incompatible boot entries, such as macOS entries, are not deleted or anyhow corrupted.</li>
</ul>
<p>However, some firmwares do their own boot option scanning upon startup by checking file presence on the available disks. Quite often this scanning includes non-standard locations, such as Windows Bootloader paths. Normally it is not an issue, but some firmwares, ASUS firmwares on APTIO V in particular, have bugs. For them scanning is implemented improperly, and firmware preferences may get accidentally corrupted due to <code>BootOrder</code> entry duplication (each option will be added twice) making it impossible to boot without cleaning NVRAM.</p>
<p>To trigger the bug one should have some valid boot options (e.g. OpenCore) and then install Windows with <code>RequestBootVarRouting</code> enabled. As Windows bootloader option will not be created by Windows installer, the firmware will attempt to create it itself, and then corrupt its boot option list.</p>
<p>This quirk removes all duplicates in <code>BootOrder</code> variable attempting to resolve the consequences of the bugs upon OpenCore loading. It is recommended to use this key along with <code>BootProtect</code> option.</p>
<h3 id="ExitBootServicesDelay"><code>ExitBootServicesDelay</code></h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: 在 <code>EXIT_BOOT_SERVICES</code> 事件后添加延迟，单位为毫秒。</p>
<p>这是一个非常丑陋的 Quirks，用于修复 <code>Still waiting for root device</code> 提示信息。在使用 FileVault 2 时，特别是华硕 Z87-Pro 等 APTIO IV 固件这种错误经常发生。似乎因为某种原因，FileVault 与 <code>EXIT_BOOT_SERVICES</code> 同时执行、导致 macOS 无法访问 SATA 控制器。未来应该会找到一个更好的方法。如果需要启用这一选项，设置 3-5 秒的延时就可以了。</p>
<h3 id="IgnoreInvalidFlexRatio"><code>IgnoreInvalidFlexRatio</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: Select firmwares, namely APTIO IV, may contain invalid values in <code>MSR_FLEX_RATIO</code> (<code>0x194</code>) MSR register. These values may cause macOS boot failure on Intel platforms.</p>
<p><em>注</em>：While the option is not supposed to induce harm on unaffected firmwares, its usage is not recommended when it is not required.</p>
<h3 id="ReleaseUsbOwnership"><code>ReleaseUsbOwnership</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 尝试从固件驱动程序中分离 USB 控制器所有权。尽管大多数固件都设法正确执行了该操作或者提供有一个选项，但某些固件没有，从而导致操作系统可能会在启动时冻结。除非需要，否则不建议启用这一选项。</p>
<h3 id="RequestBootVarRouting"><code>RequestBootVarRouting</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 请求将所有带有 <code>Boot</code> 前缀的变量从 <code>EFI_GLOBAL_VARIABLE_GUID</code> 重定向到 <code>OC_VENDOR_VARIABLE_GUID</code>。</p>
<p>This quirk requires <code>OC_FIRMWARE_RUNTIME</code> protocol implemented in <code>OpenRuntime.efi</code>（原名 <code>FwRuntimeServices.efi</code>）. 当固件删除不兼容的启动条目时，这一 Quirk 可以让默认的启动条目保存在引导菜单中。简单地说就是，如果你想使用「系统偏好设置」中的「<a target="_blank" rel="noopener" href="https://support.apple.com/HT202796">启动磁盘</a>」，就必须启用这一 Quirk。</p>
<h3 id="UnblockFsConnect"><code>UnblockFsConnect</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: 某些固件通过「按驱动程序」模式下来阻止引导项加载。</p>
<p><em>注</em>：如果惠普笔记本在 OpenCore 界面没有看到引导项时启用这一选项。</p>
<h2 id="11-13-ReservedMemory-Properties">11.13 ReservedMemory Properties</h2>
<h3 id="Address"><code>Address</code></h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: Start address of the reserved memory region, which should be allocated as reserved effectively marking the memory of this type inaccessible to the operating system.</p>
<p>The addresses written here must be part of the memory map, have <code>EfiConventionalMemory</code> type, and page-aligned (4 KBs).</p>
<h3 id="Comment-2"><code>Comment</code></h3>
<p><strong>Type</strong>: <code>plist string</code><br>
<strong>Failsafe</strong>: Empty string<br>
<strong>Description</strong>: Arbitrary ASCII string used to provide human readable reference for the entry. It is implementation defined whether this value is used.</p>
<h3 id="Size"><code>Size</code></h3>
<p><strong>Type</strong>: <code>plist integer</code><br>
<strong>Failsafe</strong>: <code>0</code><br>
<strong>Description</strong>: Size of the reserved memory region, must be page-aligned (4 KBs).</p>
<h3 id="Enabled-2"><code>Enabled</code></h3>
<p><strong>Type</strong>: <code>plist boolean</code><br>
<strong>Failsafe</strong>: <code>false</code><br>
<strong>Description</strong>: This region will not be reserved unless set to <code>true</code>.</p>
<h1>12. 排错</h1>
<hr>
<h2 id="12-1-Windows-支持">12.1 Windows 支持</h2>
<h3 id="我能安装-Windows-系统吗？">我能安装 Windows 系统吗？</h3>
<p>虽然 OpenCore 并没有提供官方的 Windows 支持，但是使用 Boot Camp 安装 64 位 UEFI Windows（即 Windows 8 及更高版本）应该是可以正常工作的。安装第三方 UEFI、或者仅部分支持 UEFI 引导的系统（如 Windows 7）可能需要额外注意。不论如何，记住以下几点：</p>
<ul>
<li>MBR (Master Boot Record) 属于 Legacy 引导，因此将不会被支持。</li>
<li>在同一块硬盘上安装 Windows、macOS 和 OpenCore 时，你可以在 <code>BlessOverride</code> 部分中指定 Windows Bootloader 的路径（<code>\EFI\Microsoft\Boot\bootmgfw.efi</code>）。</li>
<li>在 OpenCore 上应用的所有更改（ACPI、NVRAM、SMBIOS）都应该与操作系统本身无关。OpenCore 会将这些改动生效于所有操作系统，这样在 Windows 上可以获得 Boot Camp 的体验。</li>
<li>macOS 要求硬盘中的第一份分区为 EFI 分区，并且与 Windows 的默认布局不支持。尽管 OpenCore 确实提供了一个 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/bugtracker/issues/327">解决方法</a>，但是强烈建议不要依赖这个方法。</li>
<li>Windows 系统可能需要重新激活。为了避免这种情况发生，请考虑将 SystemUUID 设置为原始固件的 UUID。请注意，在旧固件上 UUID 可能是无效的（非随机的）。如果你还遇到了什么问题，可以考虑使用 HWID 或 KMS38 的 Windows 许可证。从 OpenCore 0.5.8 开始，你还可以通过设置 <code>UpdateSMBIOSMode</code> 为 <code>Custom</code> 来避免 OEM 激活失效。Windows 激活的细节不在本文档的讨论范围内，你应该能够在网上查找到相关资料。</li>
</ul>
<h3 id="我需要安装其他什么软件吗？">我需要安装其他什么软件吗？</h3>
<p>在大多数情况下，要启用多操作系统切换、安装相关驱动程序，你将需要 <a target="_blank" rel="noopener" href="https://support.apple.com/boot-camp">Boot Camp</a> 提供的 Windows 支持软件。为了简化下载过程、或者配置硬盘中已经安装好的 Windows，可以使用 <a target="_blank" rel="noopener" href="https://github.com/timsutton/brigadier">Brigadier</a> 这个实用软件。请注意在使用 Brigadier 之前，你可能需要先下载并安装 <a target="_blank" rel="noopener" href="https://www.7-zip.org">7-Zip</a>。</p>
<blockquote>
<p>译者注：<a target="_blank" rel="noopener" href="https://sparanoid.com/lab/7z/">7-zip 官方中文网站</a></p>
</blockquote>
<p>记住，一定要使用最新版本的 Boot Camp 的 Windows 支持软件。6.1 之前的版本不支持 APFS 文件系统、因此无法运行。要下载最新的软件，请将最新 Mac 的型号作为参数传递给 Brigadier，如 <code>./brigadier.exe -m iMac19,1</code>。之后，在不受支持的 Mac 型号上安装 Boot Camp，请以管理员身份运行 PowerShell，输入 <code>msiexec /i BootCamp.msi</code> 即可。如果你之前不小心已经安装了旧版本的 Boot Camp，则必须先通过运行 <code>msiexec /x BootCamp.msi</code> 将其卸载。<code>BootCamp.msi</code> 文件位于 <code>BootCamp/Drivers/Apple</code> 目录中、可以通过资源管理器访问。</p>
<blockquote>
<p>译者注：在资源管理器下，按住 同时右击窗口中空白处，此时菜单中会显示「在此处运行 PowerShell」，即在当前目录下运行 PowerShell。但是这种方式启动的 PowerShell 不具备管理员权限。</p>
</blockquote>
<p>尽管 Boot Camp 提供的 Windows 支持软件解决了大多数兼容性问题，但是有时候您还是需要手动解决一些问题：</p>
<ul>
<li>要反转鼠标滚轮的滚动方向，必须按照 <a target="_blank" rel="noopener" href="https://superuser.com/a/364353">这个网站</a> 提供的方法、设置 <code>FlipFlopWheel</code> 的值为 <code>1</code>。</li>
</ul>
<blockquote>
<p>译者注：<br>
涉及到的注册表是 <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Enum\HID\VID_???\VID_???\Device Parameters.</code><br>
你可以在 PowerShell 中执行下述命令进行设置；</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h1>获取当前设置</h1>
<p>Get-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Enum\HID**\Device` Parameters FlipFlopWheel -EA 0</p>
<h1>修改设置</h1>
<h1>鼠标滚动方向 相反 FlipFlopWheel 1</h1>
<h1>鼠标滚动方向 自然滚动 FlipFlopWheel 0</h1>
<p>Get-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Enum\HID**\Device` Parameters FlipFlopWheel -EA 0 | ForEach-Object { Set-ItemProperty $_.PSPath FlipFlopWheel 1 }</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; 如果需要撤销更改，可以使用下述命令：</span><br><span class="line">&gt; &#96;&#96;&#96;powershell</span><br><span class="line"># 恢复鼠标滚动方向</span><br><span class="line">Get-ItemProperty HKLM:\SYSTEM\CurrentControlSet\Enum\HID\*\*\Device&#96; Parameters FlipFlopWheel -EA 1 | ForEach-Object &#123; Set-ItemProperty $_.PSPath FlipFlopWheel 0 &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>RealTimeIsUniversal</code> 必须设置为 <code>1</code> 以避免 Windows 和 macOS 之间的时间不同步。</li>
</ul>
<blockquote>
<p>译者注：众所周知，Windows 将硬件时间视为本地时间，而 macOS 会计算 UTC 后当做系统时间。通过修改上述提到的注册表值，可以让 Windows 将硬件时间视为 UTC 时间。用到的 CMD 命令如下所示：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Reg add HKLM\SYSTEM\CurrentControlSet\Control\TimeZoneInformation /v RealTimeIsUniversal /t REG_DWORD /d <span class="number">1</span></span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 如果要访问 Apple 的文件系统（APFS、HFS），你可能需要安装单独的软件。已知的工具有 [Apple HFS+ driver](https:&#x2F;&#x2F;forums.macrumors.com&#x2F;threads&#x2F;apple-hfs-windows-driver-download.1368010&#x2F;) ([hack for Windows 10](https:&#x2F;&#x2F;forums.macrumors.com&#x2F;threads&#x2F;apple-hfs-windows-driver-download.1368010&#x2F;post-24180079))、[HFSExplorer](http:&#x2F;&#x2F;www.catacombae.org&#x2F;hfsexplorer)、MacDrive、Paragon APFS、Paragon HFS+、TransMac，等等。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; 译者注：**切记不要在 Windows 下写入 APFS 或 HFS，十有八九你会导致分区表错误和无法恢复的数据丢失。别怪我们没有警告过你！！**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### 为什么我会在 Boot Camp 启动硬盘 控制面板 中看到 &#96;Basic data partition&#96;？</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Boot Camp 使用 GPT 分区表获取每个引导选项的名称。独立安装 Windows 后，你必须手动重新标记分区。这可以通过许多工具完成，比如开源的 [gdisk](https:&#x2F;&#x2F;sourceforge.net&#x2F;projects&#x2F;gptfdisk)，使用方法如下：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; **Listing 3: Relabeling Windows volume**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;powershell</span><br><span class="line">PS C:\gdisk&gt; .\gdisk64.exe \\.\physicaldrive0</span><br><span class="line">GPT fdisk (gdisk) version 1.0.4</span><br><span class="line"></span><br><span class="line">Command (? for help): p</span><br><span class="line">Disk \\.\physicaldrive0: 419430400 sectors, 200.0 GiB</span><br><span class="line">Sector size (logical): 512 bytes</span><br><span class="line">Disk identifier (GUID): DEC57EB1-B3B5-49B2-95F5-3B8C4D3E4E12</span><br><span class="line">Partition table holds up to 128 entries</span><br><span class="line">Main partition table begins at sector 2 and ends at sector 33</span><br><span class="line">First usable sector is 34, last usable sector is 419430366</span><br><span class="line">Partitions will be aligned on 2048-sector boundaries</span><br><span class="line">Total free space is 4029 sectors (2.0 MiB)</span><br><span class="line"></span><br><span class="line">Number  Start (sector)    End (sector)  Size       Code  Name</span><br><span class="line">   1            2048         1023999   499.0 MiB   2700  Basic data partition</span><br><span class="line">   2         1024000         1226751   99.0 MiB    EF00  EFI system partition</span><br><span class="line">   3         1226752         1259519   16.0 MiB    0C01  Microsoft reserved ...</span><br><span class="line">   4         1259520       419428351   199.4 GiB   0700  Basic data partition</span><br><span class="line"></span><br><span class="line">Command (? for help): c</span><br><span class="line">Partition number (1-4): 4</span><br><span class="line">Enter name: BOOTCAMP</span><br><span class="line"></span><br><span class="line">Command (? for help): w</span><br><span class="line"></span><br><span class="line">Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING PARTITIONS!!</span><br><span class="line"></span><br><span class="line">Do you want to proceed? (Y&#x2F;N): Y</span><br><span class="line">OK; writing new GUID partition table (GPT) to \\.\physicaldrive0.</span><br><span class="line">Disk synchronization succeeded! The computer should now use the new partition table.</span><br><span class="line">The operation has completed successfully.</span><br></pre></td></tr></table></figure>
<h3 id="如何选择-NTFS-驱动程序">如何选择 NTFS 驱动程序</h3>
<p>提供 NTFS 读写支持的第三方驱动程序，如 <a target="_blank" rel="noopener" href="https://www.tuxera.com/community/open-source-ntfs-3g">NTFS-3G</a>、Paragon NTFS、Tuxera NTFS 或 <a target="_blank" rel="noopener" href="https://www.seagate.com/support/software/paragon">希捷移动硬盘 Paragon 驱动程序</a> 会破坏 macOS 的功能，比如 系统偏好设置 中的 启动磁盘 选项。<br>
虽然我们仍然不建议使用这些经常破坏文件系统的驱动程序（我们推荐使用 macOS 内建的 NTFS 读写支持，可以通过终端或 GUI 启用），但是这些驱动程序的厂商也提供了他们各自的解决方案，在这里我们仅列举两个：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.tuxera.com/products/tuxera-ntfs-for-mac/faq">Tuxera 的常见问题解答页面</a></li>
<li><a target="_blank" rel="noopener" href="https://kb.paragon-software.com/article/6604">Paragon 相关的技术支持文档</a></li>
</ul>
<blockquote>
<p>译者注：虽然 acidanthera 团队推荐使用 macOS 内置的 NTFS 支持，但是译者强烈反对这种方法（不论是直接方法还是使用类似 Mounty 的第三方工具）。修改 fstab 的风险是极高的。在你清楚你在做什么之前，不要轻举妄动！！</p>
</blockquote>
<h2 id="12-2-调试">12.2 调试</h2>
<p>与其他硬件相关的项目类似，OpenCore 也支持审计与调试。使用 NOOPT 或 DEBUG 构建版本（而非 RELEASE 构建版本）可以产生更多的调试输出。对于 NOOPT 构建版本，你还可以使用 GDB 或 IDA Pro 进行调试。对于 GDB 请查看 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg/tree/master/Debug">OpenCore Debug</a> 相关页面；对于 IDA Pro，你需要 7.3 或更高版本，更多详细信息请参考 IDA Pro 提供的页面：<a target="_blank" rel="noopener" href="https://www.hex-rays.com/products/ida/support/tutorials/index.shtml">Debugging the XNU Kernel with IDA Pro</a>。</p>
<p>To obtain the log during boot you can make the use of serial port debugging. Serial port debugging is enabled in <code>Target</code>, e.g. <code>0xB</code> for onscreen with serial. OpenCore uses <code>115200</code> baud rate, <code>8</code> data bits, no parity, and <code>1</code> stop bit. For macOS your best choice are CP2102-based UART devices. Connect motherboard <code>TX</code> to USB UART <code>RX</code>, and motherboard <code>GND</code> to USB UART <code>GND</code>. Use <code>screen</code> utility to get the output, or download GUI software, such as <a target="_blank" rel="noopener" href="https://freeware.the-meiers.org">CoolTerm</a>.</p>
<p><em>注释</em>: On several motherboards (and possibly USB UART dongles) PIN naming may be incorrect. It is very common to have <code>GND</code> swapped with <code>RX</code>, thus you have to connect motherboard <code>&quot;TX&quot;</code> to USB UART <code>GND</code>, and motherboard <code>&quot;GND&quot;</code> to USB UART <code>RX</code>.</p>
<p>Remember to enable <code>COM</code> port in firmware settings, and never use USB cables longer than 1 meter to avoid output corruption. To additionally enable XNU kernel serial output you will need <code>debug=0x8</code> boot argument.</p>
<h2 id="12-3-技巧和窍门">12.3 技巧和窍门</h2>
<h3 id="1-啊呀呀呀我系统没法启动了我该怎么看日志啊？">1. 啊呀呀呀我系统没法启动了我该怎么看日志啊？</h3>
<p>通常情况下，获取实际的错误信息就足够了。为此，请确保：</p>
<ul>
<li>你正在使用 OpenCore 的 DEBUG 或 NOOPT 版本。</li>
<li>日志已启用（<code>1</code>）并且在屏幕上显示（<code>2</code>）：<code>Misc =&gt; Debug =&gt; Target = 3</code>.</li>
<li>将以下这些等级的日志输出到屏幕上：<code>DEBUG_ERROR</code> (<code>0x80000000</code>)、<code>DEBUG_WARN</code> (<code>0x00000002</code>) 和 <code>DEBUG_INFO</code> (<code>0x00000040</code>)：<code>Misc =&gt; Debug =&gt; DisplayLevel = 0x80000042</code>.</li>
<li>遇到 <code>DEBUG_ERROR</code> 这样的致命错误时中止启动：<code>Misc =&gt; Security =&gt; HaltLevel = 0x80000000</code>。</li>
<li>禁用 Watch Dog 以避免自动重启：<code>Misc =&gt; Debug =&gt; DisableWatchDog = true</code>。</li>
<li>已启用 启动菜单 显示：<code>Misc =&gt; Boot =&gt; ShowPicker = true</code></li>
</ul>
<p>如果你在日志中看不出明显的错误，请逐一检查 Quirks 部分中可用的 hacks。例如，对于 Early Boot 出现的问题（如 OpenCore 启动菜单无法显示），通过 UEFI Shell（随 OpenCore 打包在一起）可以查看相关调试信息。</p>
<h3 id="2-如何自定义启动项？">2. 如何自定义启动项？</h3>
<p>OpenCore 遵循 Apple Bless 标准模型、从引导目录中的 <code>.contentDetails</code> 和 <code>.disk_label.contentDetails</code> 文件中提取条目名称。这些文件包含带有输入标题的 ASCII 字符串，你可以修改它们。</p>
<h3 id="3-如何选择默认启动的系统？">3. 如何选择默认启动的系统？</h3>
<p>OpenCore 使用 UEFI 首选启动项 来选择默认的启动项。设置的方式随 BIOS 不同而不同，具体请参考 macOS <a target="_blank" rel="noopener" href="https://support.apple.com/HT202796">启动磁盘</a> 或 Windows <a target="_blank" rel="noopener" href="https://support.apple.com/guide/bootcamp-control-panel/start-up-your-mac-in-windows-or-macos-bcmp29b8ac66/mac">Boot Camp</a> 控制面板。</p>
<p>由于使用 OpenCore 提供的 <code>BOOTx64.efi</code> 作为首选启动项会限制这项功能（可能还会导致一些固件删除不兼容的引导选项），我们强烈建议你启用 <code>RequestBootVarRouting</code> quirk，这会将你所做的选择保留在 OpenCore 变量空间中。请注意，<code>RequestBootVarRouting</code> 需要单独的 <code>.efi</code> 驱动文件（译者注：即 OpenRuntime.efi）。</p>
<h3 id="4-安装-macOS-最简单的方法是什么？">4. 安装 macOS 最简单的方法是什么？</h3>
<p>在线安装。将 Recovery 镜像（<code>*.dmg</code> 和 <code>*.chunklist</code> 文件）和 OpenCore 一起复制到一个 FAT32 分区中。加载 OpenCore 的启动菜单并选择后缀为 <code>.dmg</code> 的条目。如果你有强迫症，你可以修改 <code>.contentDetails</code> 文件改变条目显示的文字。</p>
<p>你可能会用到 <code>AppleModels</code> 内置的 <a target="_blank" rel="noopener" href="https://github.com/acidanthera/OpenCorePkg/blob/master/Utilities/macrecovery/macrecovery.py">macrecovery.py</a> 来下载 Recovery 镜像。</p>
<p>如果你需要进行离线安装，请参考 <a target="_blank" rel="noopener" href="https://support.apple.com/HT201372">How to create a bootable installer for macOS</a>。除了通过 App Store 或 系统更新，你还可以使用 <a target="_blank" rel="noopener" href="https://github.com/corpnewt/gibMacOS">第三方工具</a> 下载 macOS 镜像文件。</p>
<h3 id="5-为什么无法加载-Recovery-恢复镜像-进行在线安装？">5. 为什么无法加载 Recovery 恢复镜像 进行在线安装？</h3>
<p>可能是因为你没带 HFS+ 驱动。目前我们所知道的 Recovery 分区全都是 HFS+ 文件系统。</p>
<h3 id="6-我可以在-Apple-的硬件、或虚拟机中使用-OpenCore-吗？">6. 我可以在 Apple 的硬件、或虚拟机中使用 OpenCore 吗？</h3>
<p><s>可以，没有必要，但请加大力度</s></p>
<p>OpenCore 支持包括 MacPro 5,1 和虚拟机在内的大部分较新的 Mac 想好。不过，OpenCore 有关在 Mac 硬件上使用的具体细节微乎其微。你可以在 <a target="_blank" rel="noopener" href="https://forums.macrumors.com/threads/opencore-on-the-mac-pro.2207814">MacRumors.com</a> 查看相关讨论。</p>
<h3 id="7-为什么-Find-和-Replace-的补丁的长度必须相等？">7. 为什么 Find 和 Replace 的补丁的长度必须相等？</h3>
<p>对于 x86 机器码来说，<a target="_blank" rel="noopener" href="https://en.wikipedia.org/w/index.php?title=Relative_addressing">相对寻址</a> 无法进行大小不同的替换。对于 ACPI 代码来说这是有风险的，而且在技术上这与替换 ACPI 表等价，所以 OpenCore 没有实现。更多详细的解答可以在 <a target="_blank" rel="noopener" href="https://applelife.ru/posts/819790">AppleLife.ru</a> 上和本文档的 ACPI 章节找到。</p>
<h3 id="8-我应该如何决定哪些-Booter-Quirk-需要被启用？">8. 我应该如何决定哪些 <code>Booter</code> Quirk 需要被启用？</h3>
<p>这些 Quirk 源自 <code>AptioMemoryFix</code> 驱动，为更多的固件提供了广泛支持。如果你正在使用 <code>OpenRuntime</code>，并且想要获得和 <code>AptioMemoryFix</code> 类似的行为，请启用下述 Quirks：</p>
<ul>
<li><code>ProvideConsoleGop</code> （UEFI Quirk）</li>
<li><code>AvoidRuntimeDefrag</code></li>
<li><code>DiscardHibernateMap</code></li>
<li><code>EnableSafeModeSlide</code></li>
<li><code>EnableWriteUnprotector</code></li>
<li><code>ForceExitBootServices</code></li>
<li><code>ProtectMemoryRegions</code></li>
<li><code>ProvideCustomSlide</code></li>
<li><code>RebuildAppleMemoryMap</code></li>
<li><code>SetupVirtualMap</code></li>
</ul>
<p>但是，对于大部分现代的设备来说，上述 Quirks 不一定是必须的。比如 <code>DevirtualiseMmio</code> 和 <code>ProtectUefiServices</code> 通常是需要启用的，但是 <code>DiscardHibernateMap</code> 和 <code>ForceExitBootServices</code> 一般不建议启用。</p>
<p>不幸的是，对于某些 Quirks 来说（<code>RebuildAppleMemoryMap</code>, <code>EnableWriteUnprotector</code>, <code>ProtectMemoryRegions</code>, <code>RebuildAppleMemoryMap</code>, <code>SetupVirtualMap</code> 和 <code>SyncRuntimePermissions</code>）由于没有明确的参考，因此需要自行尝试最佳组合。详细内容请参考本文档中对这些 Quirks 的描述。</p>
<hr>
<h1>附录 1. OpenCore 兼容 Kext 列表</h1>
<hr>
<h2 id="有线网卡">有线网卡</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.realtek.com/en/directly-download">AppleRTL8169Ethernet</a> — Realtek RTL8169 官方驱动，通过电子邮件发送下载链接</li>
<li><a target="_blank" rel="noopener" href="https://github.com/Mieze/AtherosE2200Ethernet">AtherosE2200Ethernet.kext</a> — 高通 Atheros Killer E2200 系列驱动</li>
<li><a target="_blank" rel="noopener" href="https://github.com/al3xtjames/AtherosL1cEthernet">AtherosL1cEthernet.kext</a> — 高通 Atheros AR813x/815x 驱动</li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/IntelMausi">IntelMausi.kext</a> — 由 Acidanthera 维护的英特尔有线网卡驱动</li>
<li><a target="_blank" rel="noopener" href="https://github.com/Mieze/IntelMausiEthernet">IntelMausiEthernet.kext</a> — 由原作者（Mieze）英特尔有线网卡</li>
<li><a target="_blank" rel="noopener" href="https://github.com/RehabMan/OS-X-Null-Ethernet">NullEthernetInjector.kext</a> — RehabMan 提供的仿冒内建网卡</li>
<li><a target="_blank" rel="noopener" href="https://github.com/SergeySlice/RealtekLANv3">RealtekR1000SL.kext</a> — Realtek 8111B/C/D/E/EP/F/G/GU/8411B 系列驱动</li>
<li><a target="_blank" rel="noopener" href="https://github.com/Mieze/RealtekRTL8100">RealtekRTL8100.kext</a> — Realtek RTL810X 系列驱动</li>
<li><a target="_blank" rel="noopener" href="https://github.com/Mieze/RTL8111_driver_for_OS_X">RealtekRTL8111.kext</a> — Realtek RTL8111/8168 系列驱动</li>
</ul>
<h2 id="Wi-Fi-和蓝牙">Wi-Fi 和蓝牙</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://i.applelife.ru/2018/12/442854_AirPortAtheros40.kext.zip">AirPortAtheros40.kext</a> — 高通 Atheros AR92xx/AR93xx 驱动，仅适用于 macOS 10.13.6 和 macOS 10.14+</li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/AirportBrcmFixup">AirportBrcmFixup.kext</a> — 非苹果官方博通网卡修复</li>
<li><a target="_blank" rel="noopener" href="https://github.com/chunnann/ATH9KFixup">ATH9KFixup.kext</a> — 高通 Atheros AR9xxx 无线网卡修复</li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/BrcmPatchRAM">BrcmPatchRAM.kext</a> — 博通网卡蓝牙固件</li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/BT4LEContinuityFixup">BT4LEContinuityFixup.kext</a> — IOBluetoothFamily 修补</li>
<li><a target="_blank" rel="noopener" href="https://github.com/zxystd/IntelBluetoothFirmware">IntelBluetoothFirmware</a> — Intel 蓝牙固件驱动</li>
<li><a target="_blank" rel="noopener" href="https://d86o2zu8ugzlg.cloudfront.net/mediatek-craft/drivers/MT7612_7610U_D5.0.1.25_SDK1.0.2.18_UI5.0.0.27_20151209.zip">MT7610</a> — 联发科 MT7610 官方驱动</li>
<li><a target="_blank" rel="noopener" href="https://d86o2zu8ugzlg.cloudfront.net/mediatek-craft/drivers/RTUSB_D2870-4.2.9.2_UI-4.0.9.6_2013_11_29.zip">RT5370</a> — 联发科 RT5370 官方驱动</li>
<li><a target="_blank" rel="noopener" href="https://drive.google.com/file/d/1ZtdMqlvKBbHULJhl1u9omuLOy6j0vx48/view?usp=sharing">RTL8192CU</a> — Realtek RTL8192CU 驱动</li>
</ul>
<blockquote>
<p>译者注：上述链接为 Google Drive 分享，直链下载地址：</p>
<ul>
<li><a href="/download/RTL8192CU/10.6/RTL8192CUs.kext.zip">macOS 10.6</a></li>
<li><a href="/download/RTL8192CU/10.9/RTL8192CU9.kext.zip">macOS 10.9</a></li>
</ul>
</blockquote>
<h2 id="键盘、鼠标和触摸设备">键盘、鼠标和触摸设备</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://osxlatitude.com/forums/topic/1948-elan-focaltech-and-synaptics-smart-touchpad-driver-mac-os-x/">ApplePS2SmartTouchPad.kext</a> — 触摸板和键盘</li>
<li><a target="_blank" rel="noopener" href="https://github.com/osy86/GK701HIDDevice">GK701HIDDevice.kext</a> — 华硕 Fn 键、键盘背光灯和环境光传感器 驱动</li>
<li><a target="_blank" rel="noopener" href="https://github.com/al3xtjames/NoTouchID">NoTouchID.kext</a> — 禁用 Touch ID 检测</li>
<li><a target="_blank" rel="noopener" href="https://github.com/Goldfish64/SerialMouse">SerialMouse.kext</a> — 使用 Microsoft 串行鼠标协议的串行鼠标驱动</li>
<li><a target="_blank" rel="noopener" href="https://github.com/alexandred/VoodooI2C">VoodooI2C.kext</a> — I2C 触摸板/屏 驱动</li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/VoodooPS2">VoodooPS2Controller.kext</a> — PS2 键盘/触摸板 驱动</li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/VoodooInput">VoodooInput.kext</a> — 为 PS2 键盘/触摸板 提供模拟 Magic TrackPad 2 触控模拟</li>
<li><a target="_blank" rel="noopener" href="https://github.com/leo-labs/VoodooSMBus">VoodooSMBus.kext</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/blankmac/AlpsT4USB">AlpsT4USB.kext</a> — VoodooI2C 的卫星插件 kext，为 Alps T4 USB 触控板提供原生苹果手势支持。</li>
</ul>
<h2 id="音频和视频">音频和视频</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/AppleALC">AppleALC.kext</a> — 定制声卡驱动</li>
<li><a target="_blank" rel="noopener" href="https://github.com/Wouter1/EMU-driver">EMUUSBAudio.kext</a> — 适用于 Creative Labs EMU USB 的驱动程序</li>
<li><a target="_blank" rel="noopener" href="https://github.com/kxproject/kx-audio-driver">kXAudioDriver.kext</a> — 适用于 kX 音频设备的驱动</li>
<li><a target="_blank" rel="noopener" href="https://www.nvidia.com/object/mac-driver-archive.html">Nvidia CUDA drivers</a> — NVIDIA CUDA 官方驱动</li>
<li><a target="_blank" rel="noopener" href="https://gfe.nvidia.com/mac-update">Nvidia Web-drivers</a> — NVIDIA 显卡官方驱动</li>
<li><a target="_blank" rel="noopener" href="https://github.com/Andrej-Antipov/SNBGraphicsMojaveInstaller">SNBGraphicsMojaveInstaller</a> — 二代酷睿核显驱动，仅适用于 macOS 10.13.6 和 macOS 10.14+</li>
<li><a target="_blank" rel="noopener" href="https://sourceforge.net/projects/voodoohda/">VoodooHDA.kext</a> — 万能声卡驱动</li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/WhateverGreen">WhateverGreen.kext</a> — 显卡补丁驱动</li>
<li><a target="_blank" rel="noopener" href="https://github.com/osy86/Polaris22Fixup">Polaris22Fixup.kext</a> — Polaris22/VegaM 显卡修复</li>
</ul>
<h2 id="CPU-和-SMC">CPU 和 SMC</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/bugtracker/issues/424#issuecomment-535624313">AppleMCEReporterDisabler.kext</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/hieplpvip/AsusSMC">AsusSMC.kext</a> — 为 ASUS 笔记本电脑上的 ALS、键盘背光、Fn 键提供支持 VirtualSMC 插件</li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/CPUFriend">CPUFriend.kext</a> - CPU 变频管理</li>
<li><a target="_blank" rel="noopener" href="https://github.com/CloverHackyColor/FakeSMC3_with_plugins">FakeSMC.kext 以及配套传感器驱动</a> — Clover 官方的 FakeSMC</li>
<li><a target="_blank" rel="noopener" href="https://github.com/headkaze/HWPEnable">HWPEnabler.kext</a> — 启用 HWP 驱动</li>
<li><a target="_blank" rel="noopener" href="https://www.insanelymac.com/forum/topic/329704-opcode-emulator-opemu-plug-in-project/">OpcodeEmulator.kext</a> — Opcode 模拟驱动</li>
<li><a target="_blank" rel="noopener" href="https://github.com/interferenc/TSCAdjustReset">TSCAdjustReset.kext</a> — TSC 频率同步驱动</li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/VirtualSMC">VirtualSMC.kext 以及配套传感器驱动</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/RehabMan/VoodooTSCSync">VoodooTSCSync.kext</a> — 由 Rehabman 提供的 TSC 频率同步驱动</li>
</ul>
<h2 id="USB-and-other-ports">USB and other ports</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/the-darkvoid/macOS-IOElectrify">IOElectrify.kext</a> — 在雷电 3 设备上启用常开电源</li>
<li><a target="_blank" rel="noopener" href="https://applelife.ru/posts/537459">Legacy_InternalHub-EHCx.kext</a></li>
<li><a target="_blank" rel="noopener" href="https://applelife.ru/posts/537459">Legacy_USB3.kext</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/NVMeFix">NVMeFix.kext</a> — 由 acidanthera 提供的改善第三方 SSD 兼容性的驱动程序</li>
<li><a target="_blank" rel="noopener" href="https://github.com/osy86/USBWakeFixup">USBWakeFixup.kext</a> — 修复 Skylake 平台 USB 唤醒黑屏</li>
<li><a target="_blank" rel="noopener" href="https://github.com/dukzcry/osx-goodies">SASMegaRAID.kext</a> — LSI MegaRAID SAS 系列 RAID 控制器驱动</li>
<li><a target="_blank" rel="noopener" href="https://www.insanelymac.com/forum/topic/321080-sineteks-driver-for-realtek-rtsx-sdhc-card-readers/?do=findComment&amp;comment=2376387">Sinetek-rtsx.kext</a> — Realtek RTSX SDHC 读卡器驱动</li>
<li><a target="_blank" rel="noopener" href="https://github.com/lvs1974/VoodooSDHCMod">VoodooSDHC.kext</a> — SDHC 读卡器驱动</li>
</ul>
<h2 id="Other-kexts">Other kexts</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/headkaze/AppleIntelInfo">AppleIntelInfo.kext</a> — CPU / 核显 变频测试</li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/DebugEnhancer">DebugEnhancer.kext</a> — macOS 内核调试输出驱动</li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/HibernationFixup">HibernationFixup.kext</a> — 修复因 RTC 变量和 NVRAM 造成的睡眠问题</li>
<li><a target="_blank" rel="noopener" href="https://github.com/acidanthera/Lilu">Lilu.kext</a> — SDK &amp; Library</li>
<li><a target="_blank" rel="noopener" href="https://github.com/PMheart/LiluFriend">LiluFriend.kext</a> — 用于确保 Lilu 在 L/E 下正常加载</li>
<li><a target="_blank" rel="noopener" href="https://github.com/lvs1974/RTCMemoryFixup">RTCMemoryFixup.kext</a> — 修复 BIOS CMOS (RTC) 内存和 AppleRTC 之间的冲突问题</li>
<li><a target="_blank" rel="noopener" href="https://github.com/cdf/NightShiftEnabler">NightShiftEnabler.kext</a> — 解锁 NightShift</li>
<li><a target="_blank" rel="noopener" href="https://www.applelife.ru/threads/asus-x550vc-i-asus-x550cc.41752/page-130#post-593586">WebCamera.kext</a> — 某些旧设备的摄像头驱动</li>
<li><a target="_blank" rel="noopener" href="https://github.com/jslegendre/TOSMotionSensor">TOSMotionSensor.kext</a> — 东芝设备的加速度传感器驱动</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">haisky</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.hai2020.cn/phxprq/">https://www.hai2020.cn/phxprq/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.hai2020.cn" target="_blank">haisky的草堂</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/opencore/">opencore</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/xiaobaisky/2020cdn@master/imgs/timg.gif" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/kd5k88/"><img class="prev-cover" data-lazy-src="https://cdn.jsdelivr.net/gh/xiaobaisky/cdn/image/OC.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">OpenCore 配置详解</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/ukmkn7/" title="butterfly主题配置（一）"><img class="cover" data-lazy-src="https://cdn.jsdelivr.net/gh/xiaobaisky/cdn/image/hexo-theme-butterfly-doc-cover.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-06-13</div><div class="title">butterfly主题配置（一）</div></div></a></div><div><a href="/kd5k88/" title="OpenCore 配置详解"><img class="cover" data-lazy-src="https://cdn.jsdelivr.net/gh/xiaobaisky/cdn/image/OC.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-06-12</div><div class="title">OpenCore 配置详解</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" data-lazy-src="https://cdn.jsdelivr.net/gh/xiaobaisky/cdn/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">haisky</div><div class="author-info__description">Will, work and wait are the pyramidal cornerstones for success.</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://xiaobaisky.417225230.workers.dev/hpp/admin/login"><i class="fas fa-edit"></i><span>点我写文章！</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:417225230@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/img/weixinimg.jpg" target="_blank" title="微信"><i class="fab fa-weixin"></i></a><a class="social-icon" href="https://demo.jerryc.me/" target="_blank" title="butterfly"><i class="fas fa-hand-holding-heart"></i></a><a class="social-icon" href="https://github.com/xiaobaisky/myblog" target="_blank" title="我的主题"><i class="fab fa-github"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%85%E8%AF%BB%E9%A1%BB%E7%9F%A5"><span class="toc-text">阅读须知</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E7%94%A8%E7%9A%84%E9%93%BE%E6%8E%A5"><span class="toc-text">有用的链接</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%B4%E6%8A%A4%E8%80%85"><span class="toc-text">维护者</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">1. 简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E9%80%9A%E7%94%A8%E6%9C%AF%E8%AF%AD"><span class="toc-text">1.1 通用术语</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">2. 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E9%85%8D%E7%BD%AE%E6%9C%AF%E8%AF%AD"><span class="toc-text">2.1 配置术语</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E9%85%8D%E7%BD%AE%E5%A4%84%E7%90%86"><span class="toc-text">2.2 配置处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%84"><span class="toc-text">2.3 配置结构</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">3. 目录讲解</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-text">3.1 目录结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E5%AE%89%E8%A3%85%E5%92%8C%E5%8D%87%E7%BA%A7"><span class="toc-text">3.2 安装和升级</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E8%B4%A1%E7%8C%AE%E4%BB%A3%E7%A0%81"><span class="toc-text">3.3 贡献代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E4%BB%A3%E7%A0%81%E7%BA%A6%E5%AE%9A"><span class="toc-text">3.4 代码约定</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">4. ACPI</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E7%AE%80%E4%BB%8B"><span class="toc-text">4.1 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8"><span class="toc-text">4.2 属性列表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-Add"><span class="toc-text">4.2.1 Add</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-Delete"><span class="toc-text">4.2.2 Delete</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-Patch"><span class="toc-text">4.2.3 Patch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-4-Quirks"><span class="toc-text">4.2.4 Quirks</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-Add-%E5%B1%9E%E6%80%A7"><span class="toc-text">4.3 Add 属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-Comment"><span class="toc-text">4.2.1 Comment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-Enabled"><span class="toc-text">4.2.2 Enabled</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-Path"><span class="toc-text">4.2.3 Path</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-Delete-%E5%B1%9E%E6%80%A7"><span class="toc-text">4.4 Delete 属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-All"><span class="toc-text">4.2.1 All</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-Comment"><span class="toc-text">4.2.2 Comment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-Enabled"><span class="toc-text">4.2.3 Enabled</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-4-OemTableId"><span class="toc-text">4.2.4 OemTableId</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-5-TableLength"><span class="toc-text">4.2.5 TableLength</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-6-TableSignature"><span class="toc-text">4.2.6 TableSignature</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5-Patch-%E5%B1%9E%E6%80%A7"><span class="toc-text">4.5 Patch 属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-1-Comment"><span class="toc-text">4.5.1 Comment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-2-Count"><span class="toc-text">4.5.2 Count</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-3-Enabled"><span class="toc-text">4.5.3 Enabled</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-4-Find"><span class="toc-text">4.5.4 Find</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-5-Limit"><span class="toc-text">4.5.5 Limit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-6-Mask"><span class="toc-text">4.5.6 Mask</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-7-OemTableId"><span class="toc-text">4.5.7 OemTableId</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-8-Replace"><span class="toc-text">4.5.8 Replace</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-9-ReplaceMark"><span class="toc-text">4.5.9 ReplaceMark</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-10-Skip"><span class="toc-text">4.5.10 Skip</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-11-TableLength"><span class="toc-text">4.5.11 TableLength</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-11-TableSignature"><span class="toc-text">4.5.11 TableSignature</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-6-Quirks-%E5%B1%9E%E6%80%A7"><span class="toc-text">4.6 Quirks 属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-1-FadtEnableReset"><span class="toc-text">4.6.1 FadtEnableReset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-2-NormalizeHeaders"><span class="toc-text">4.6.2 NormalizeHeaders</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-3-RebaseRegions"><span class="toc-text">4.6.3 RebaseRegions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-4-ResetHwSig"><span class="toc-text">4.6.4 ResetHwSig</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-5-ResetLogoStatus"><span class="toc-text">4.6.5 ResetLogoStatus</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">5. Booter</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E7%AE%80%E4%BB%8B"><span class="toc-text">5.1 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8"><span class="toc-text">5.2 属性列表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-1-MmioWhitelist"><span class="toc-text">5.2.1 MmioWhitelist</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-2-Quirks"><span class="toc-text">5.2.2 Quirks</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-MmioWhitelist-%E5%B1%9E%E6%80%A7"><span class="toc-text">5.3 MmioWhitelist 属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-1-Address"><span class="toc-text">5.3.1 Address</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-2-Comment"><span class="toc-text">5.3.2 Comment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-3-Enabled"><span class="toc-text">5.3.3 Enabled</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-Quirks-%E5%B1%9E%E6%80%A7"><span class="toc-text">5.4 Quirks 属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AvoidRuntimeDefrag"><span class="toc-text">AvoidRuntimeDefrag</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DevirtualiseMmio"><span class="toc-text">DevirtualiseMmio</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DisableSingleUser"><span class="toc-text">DisableSingleUser</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DisableVariableWrite"><span class="toc-text">DisableVariableWrite</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DiscardHibernateMap"><span class="toc-text">DiscardHibernateMap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EnableSafeModeSlide"><span class="toc-text">EnableSafeModeSlide</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EnableWriteUnprotector"><span class="toc-text">EnableWriteUnprotector</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ForceExitBootServices"><span class="toc-text">ForceExitBootServices</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ProtectMemoryRegions"><span class="toc-text">ProtectMemoryRegions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ProtectSecureBoot"><span class="toc-text">ProtectSecureBoot</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ProtectUefiServices"><span class="toc-text">ProtectUefiServices</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ProvideCustomSlide"><span class="toc-text">ProvideCustomSlide</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RebuildAppleMemoryMap"><span class="toc-text">RebuildAppleMemoryMap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SetupVirtualMap"><span class="toc-text">SetupVirtualMap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SignalAppleOS"><span class="toc-text">SignalAppleOS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SyncRuntimePermissions"><span class="toc-text">SyncRuntimePermissions</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">6. DeviceProperties</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E7%AE%80%E4%BB%8B"><span class="toc-text">6.1 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8"><span class="toc-text">6.2 属性列表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-1-Add"><span class="toc-text">6.2.1 Add</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-2-Delete"><span class="toc-text">6.2.2 Delete</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-%E5%B8%B8%E8%A7%81%E5%B1%9E%E6%80%A7"><span class="toc-text">6.3 常见属性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">7. Kernel</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-%E7%AE%80%E4%BB%8B"><span class="toc-text">7.1 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8"><span class="toc-text">7.2 属性列表</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-1-Add"><span class="toc-text">7.2.1 Add</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-2-Delete"><span class="toc-text">7.2.2 Delete</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-3-Emulate"><span class="toc-text">7.2.3 Emulate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-4-Patch"><span class="toc-text">7.2.4 Patch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-5-Quirks"><span class="toc-text">7.2.5 Quirks</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-Add-%E5%B1%9E%E6%80%A7"><span class="toc-text">7.3 Add 属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-1-BundlePath"><span class="toc-text">7.3.1 BundlePath</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-2-Comment"><span class="toc-text">7.3.2 Comment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-3-Enabled"><span class="toc-text">7.3.3 Enabled</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-4-ExecutablePath"><span class="toc-text">7.3.4 ExecutablePath</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-5-MaxKernel"><span class="toc-text">7.3.5 MaxKernel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-6-MinKernel"><span class="toc-text">7.3.6 MinKernel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-7-PlistPath"><span class="toc-text">7.3.7 PlistPath</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-4-Delete-%E5%B1%9E%E6%80%A7"><span class="toc-text">7.4 Delete 属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-1-Comment"><span class="toc-text">7.4.1 Comment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-2-Enabled"><span class="toc-text">7.4.2 Enabled</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-3-Identifier"><span class="toc-text">7.4.3 Identifier</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-4-MaxKernel"><span class="toc-text">7.4.4 MaxKernel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-5-MinKernel"><span class="toc-text">7.4.5 MinKernel</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-5-Emulate-%E5%B1%9E%E6%80%A7"><span class="toc-text">7.5 Emulate 属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-1-Cpuid1Data"><span class="toc-text">7.5.1 Cpuid1Data</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-2-Cpuid1Mask"><span class="toc-text">7.5.2 Cpuid1Mask</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-6-Patch-%E5%B1%9E%E6%80%A7"><span class="toc-text">7.6 Patch 属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-6-1-Base"><span class="toc-text">7.6.1 Base</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-6-2-Comment"><span class="toc-text">7.6.2 Comment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-6-3-Count"><span class="toc-text">7.6.3 Count</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-6-4-Enabled"><span class="toc-text">7.6.4 Enabled</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-6-5-Find"><span class="toc-text">7.6.5 Find</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-6-6-Identifier"><span class="toc-text">7.6.6 Identifier</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-6-7-Limit"><span class="toc-text">7.6.7 Limit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-6-8-Mask"><span class="toc-text">7.6.8 Mask</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-6-9-MaxKernel"><span class="toc-text">7.6.9 MaxKernel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-6-10-MinKernel"><span class="toc-text">7.6.10 MinKernel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-6-11-Replace"><span class="toc-text">7.6.11 Replace</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-6-12-ReplaceMask"><span class="toc-text">7.6.12 ReplaceMask</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-6-13-Skip"><span class="toc-text">7.6.13 Skip</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-7-Quirks-%E5%B1%9E%E6%80%A7"><span class="toc-text">7.7 Quirks 属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AppleCpuPmCfgLock"><span class="toc-text">AppleCpuPmCfgLock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AppleXcpmCfgLock"><span class="toc-text">AppleXcpmCfgLock</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AppleXcpmExtraMsrs"><span class="toc-text">AppleXcpmExtraMsrs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AppleXcpmForceBoost"><span class="toc-text">AppleXcpmForceBoost</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CustomSMBIOSGuid"><span class="toc-text">CustomSMBIOSGuid</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DisableIoMapper"><span class="toc-text">DisableIoMapper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DisableRtcChecksum"><span class="toc-text">DisableRtcChecksum</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DummyPowerManagement"><span class="toc-text">DummyPowerManagement</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ExternalDiskIcons"><span class="toc-text">ExternalDiskIcons</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IncreasePciBarSize"><span class="toc-text">IncreasePciBarSize</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LapicKernelPanic"><span class="toc-text">LapicKernelPanic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PanicNoKextDump"><span class="toc-text">PanicNoKextDump</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PowerTimeoutKernelPanic"><span class="toc-text">PowerTimeoutKernelPanic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ThirdPartyDrives"><span class="toc-text">ThirdPartyDrives</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XhciPortLimit"><span class="toc-text">XhciPortLimit</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">8. Misc</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-Introduction"><span class="toc-text">8.1 Introduction</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-Properties"><span class="toc-text">8.2 Properties</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Boot"><span class="toc-text">Boot</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BlessOverride"><span class="toc-text">BlessOverride</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Debug"><span class="toc-text">Debug</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Entries"><span class="toc-text">Entries</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Security"><span class="toc-text">Security</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tools"><span class="toc-text">Tools</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-Boot-Properties"><span class="toc-text">8.3 Boot Properties</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ConsoleAttributes"><span class="toc-text">ConsoleAttributes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HibernateMode"><span class="toc-text">HibernateMode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HideAuxiliary"><span class="toc-text">HideAuxiliary</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HideSelf"><span class="toc-text">HideSelf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PickerAttributes"><span class="toc-text">PickerAttributes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PickerAudioAssist"><span class="toc-text">PickerAudioAssist</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PollAppleHotKeys"><span class="toc-text">PollAppleHotKeys</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ShowPicker"><span class="toc-text">ShowPicker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TakeoffDelay"><span class="toc-text">TakeoffDelay</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Timeout"><span class="toc-text">Timeout</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PickerMode"><span class="toc-text">PickerMode</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4-Debug-Properties"><span class="toc-text">8.4 Debug Properties</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AppleDebug"><span class="toc-text">AppleDebug</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ApplePanic"><span class="toc-text">ApplePanic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DisableWatchDog"><span class="toc-text">DisableWatchDog</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DisplayDelay"><span class="toc-text">DisplayDelay</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-DisplayLevel"><span class="toc-text">3.DisplayLevel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Target"><span class="toc-text">Target</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-5-Security-Properties"><span class="toc-text">8.5 Security Properties</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AllowNvramReset"><span class="toc-text">AllowNvramReset</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AllowSetDefault"><span class="toc-text">AllowSetDefault</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AuthRestart"><span class="toc-text">AuthRestart</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BootProtect"><span class="toc-text">BootProtect</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ExposeSensitiveData"><span class="toc-text">ExposeSensitiveData</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HaltLevel"><span class="toc-text">HaltLevel</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Vault"><span class="toc-text">Vault</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ScanPolicy"><span class="toc-text">ScanPolicy</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-6-Entry-Properties"><span class="toc-text">8.6 Entry Properties</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Arguments"><span class="toc-text">Arguments</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Auxiliary"><span class="toc-text">Auxiliary</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Comment"><span class="toc-text">Comment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Enabled"><span class="toc-text">Enabled</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Name"><span class="toc-text">Name</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Path"><span class="toc-text">Path</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">9. NVRAM</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-Introduction"><span class="toc-text">9.1 Introduction</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2-Properties"><span class="toc-text">9.2 Properties</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Add"><span class="toc-text">1. Add</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Delete"><span class="toc-text">2. Delete</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-LegacyEnable"><span class="toc-text">3. LegacyEnable</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-LegacyOverwrite"><span class="toc-text">4. LegacyOverwrite</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-LegacySchema"><span class="toc-text">5. LegacySchema</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-WriteFlash"><span class="toc-text">6. WriteFlash</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-3-Mandatory-Variables"><span class="toc-text">9.3 Mandatory Variables</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-4-Recommended-Variables"><span class="toc-text">9.4 Recommended Variables</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-5-Other-Variables"><span class="toc-text">9.5 Other Variables</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">10. PlatformInfo</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-Properties"><span class="toc-text">10.1 Properties</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Automatic"><span class="toc-text">1. Automatic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-UpdateDataHub"><span class="toc-text">2. UpdateDataHub</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-UpdateNVRAM"><span class="toc-text">3. UpdateNVRAM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-UpdateSMBIOS"><span class="toc-text">4. UpdateSMBIOS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-UpdateSMBIOSMode"><span class="toc-text">5. UpdateSMBIOSMode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-Generic"><span class="toc-text">6. Generic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-DataHub"><span class="toc-text">7. DataHub</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-PlatformNVRAM"><span class="toc-text">8. PlatformNVRAM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-SMBIOS"><span class="toc-text">9. SMBIOS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-Generic-Properties"><span class="toc-text">10.2 Generic Properties</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-SpoofVendor"><span class="toc-text">1. SpoofVendor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-AdviseWindows"><span class="toc-text">2. AdviseWindows</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-SystemProductName"><span class="toc-text">3. SystemProductName</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-SystemSerialNumber"><span class="toc-text">4. SystemSerialNumber</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-SystemUUID"><span class="toc-text">5. SystemUUID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-MLB"><span class="toc-text">6. MLB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-ROM"><span class="toc-text">7. ROM</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-3-DataHub-Properties"><span class="toc-text">10.3 DataHub Properties</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-PlatformName"><span class="toc-text">1. PlatformName</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-SystemProductName"><span class="toc-text">2. SystemProductName</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-SystemSerialNumber"><span class="toc-text">3. SystemSerialNumber</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-SystemUUID"><span class="toc-text">4. SystemUUID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-BoardProduct"><span class="toc-text">5. BoardProduct</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-BoardRevision"><span class="toc-text">6. BoardRevision</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-StartupPowerEvents"><span class="toc-text">7. StartupPowerEvents</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-InitialTSC"><span class="toc-text">8. InitialTSC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-FSBFrequency"><span class="toc-text">9. FSBFrequency</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-ARTFrequency"><span class="toc-text">10. ARTFrequency</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-DevicePathsSupported"><span class="toc-text">11. DevicePathsSupported</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-SmcRevision"><span class="toc-text">12. SmcRevision</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-SmcBranch"><span class="toc-text">13. SmcBranch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-SmcPlatform"><span class="toc-text">14. SmcPlatform</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-4-PlatformNVRAM-Properties"><span class="toc-text">10.4 PlatformNVRAM Properties</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-BID"><span class="toc-text">1. BID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-ROM"><span class="toc-text">2. ROM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-MLB"><span class="toc-text">3. MLB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-FirmwareFeatures"><span class="toc-text">4. FirmwareFeatures</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-FirmwareFeaturesMask"><span class="toc-text">5. FirmwareFeaturesMask</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-5-SMBIOS-Properties"><span class="toc-text">10.5 SMBIOS Properties</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-BIOSVendor"><span class="toc-text">1. BIOSVendor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-BIOSVersion"><span class="toc-text">2. BIOSVersion</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-3-Tools"><span class="toc-text">11.3 Tools</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-4-OpenCanopy"><span class="toc-text">11.4 OpenCanopy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-5-OpenRuntime"><span class="toc-text">11.5 OpenRuntime</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-6-Properties"><span class="toc-text">11.6 Properties</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#APFS"><span class="toc-text">APFS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Audio"><span class="toc-text">Audio</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ConnectDrivers"><span class="toc-text">ConnectDrivers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Drivers"><span class="toc-text">Drivers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Input"><span class="toc-text">Input</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Output"><span class="toc-text">Output</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ProtocolOverrides"><span class="toc-text">ProtocolOverrides</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Quirks"><span class="toc-text">Quirks</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ReservedMemory"><span class="toc-text">ReservedMemory</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-7-APFS-Properties"><span class="toc-text">11.7 APFS Properties</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#EnableJumpstart"><span class="toc-text">EnableJumpstart</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HideVerbose"><span class="toc-text">HideVerbose</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JumpstartHotPlug"><span class="toc-text">JumpstartHotPlug</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MinDate"><span class="toc-text">MinDate</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MinVersion"><span class="toc-text">MinVersion</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-8-Audio-Properties"><span class="toc-text">11.8 Audio Properties</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AudioCodec"><span class="toc-text">AudioCodec</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AudioDevice"><span class="toc-text">AudioDevice</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AudioOut"><span class="toc-text">AudioOut</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AudioSupport"><span class="toc-text">AudioSupport</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MinimumVolume"><span class="toc-text">MinimumVolume</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PlayChime"><span class="toc-text">PlayChime</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VolumeAmplifier"><span class="toc-text">VolumeAmplifier</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-9-Input-Properties"><span class="toc-text">11.9 Input Properties</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#KeyFiltering"><span class="toc-text">KeyFiltering</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#KeyForgetThreshold"><span class="toc-text">KeyForgetThreshold</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#KeyMergeThreshold"><span class="toc-text">KeyMergeThreshold</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#KeySupport"><span class="toc-text">KeySupport</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#KeySupportMode"><span class="toc-text">KeySupportMode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#KeySwap"><span class="toc-text">KeySwap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PointerSupport"><span class="toc-text">PointerSupport</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PointerSupportMode"><span class="toc-text">PointerSupportMode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TimerResolution"><span class="toc-text">TimerResolution</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-10-Output-Properties"><span class="toc-text">11.10 Output Properties</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TextRenderer"><span class="toc-text">TextRenderer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ConsoleMode"><span class="toc-text">ConsoleMode</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Resolution"><span class="toc-text">Resolution</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ClearScreenOnModeSwitch"><span class="toc-text">ClearScreenOnModeSwitch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DirectGopRendering"><span class="toc-text">DirectGopRendering</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IgnoreTextInGraphics"><span class="toc-text">IgnoreTextInGraphics</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ReplaceTabWithSpace"><span class="toc-text">ReplaceTabWithSpace</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ProvideConsoleGop"><span class="toc-text">ProvideConsoleGop</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ReconnectOnResChange"><span class="toc-text">ReconnectOnResChange</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SanitiseClearScreen"><span class="toc-text">SanitiseClearScreen</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-11-Protocols-Properties"><span class="toc-text">11.11 Protocols Properties</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AppleAudio"><span class="toc-text">AppleAudio</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AppleBootPolicy"><span class="toc-text">AppleBootPolicy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AppleDebugLog"><span class="toc-text">AppleDebugLog</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AppleEvent"><span class="toc-text">AppleEvent</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AppleImageConversion"><span class="toc-text">AppleImageConversion</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AppleKeyMap"><span class="toc-text">AppleKeyMap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AppleRtcRam"><span class="toc-text">AppleRtcRam</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AppleSmcIo"><span class="toc-text">AppleSmcIo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AppleUserInterfaceTheme"><span class="toc-text">AppleUserInterfaceTheme</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DataHub"><span class="toc-text">DataHub</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DeviceProperties"><span class="toc-text">DeviceProperties</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FirmwareVolume"><span class="toc-text">FirmwareVolume</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HashServices"><span class="toc-text">HashServices</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OSInfo"><span class="toc-text">OSInfo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UnicodeCollation"><span class="toc-text">UnicodeCollation</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-12-Quirks"><span class="toc-text">11.12 Quirks</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DeduplicateBootOrder"><span class="toc-text">DeduplicateBootOrder</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ExitBootServicesDelay"><span class="toc-text">ExitBootServicesDelay</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IgnoreInvalidFlexRatio"><span class="toc-text">IgnoreInvalidFlexRatio</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ReleaseUsbOwnership"><span class="toc-text">ReleaseUsbOwnership</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RequestBootVarRouting"><span class="toc-text">RequestBootVarRouting</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UnblockFsConnect"><span class="toc-text">UnblockFsConnect</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-13-ReservedMemory-Properties"><span class="toc-text">11.13 ReservedMemory Properties</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Address"><span class="toc-text">Address</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Comment-2"><span class="toc-text">Comment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Size"><span class="toc-text">Size</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Enabled-2"><span class="toc-text">Enabled</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">12. 排错</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#12-1-Windows-%E6%94%AF%E6%8C%81"><span class="toc-text">12.1 Windows 支持</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%91%E8%83%BD%E5%AE%89%E8%A3%85-Windows-%E7%B3%BB%E7%BB%9F%E5%90%97%EF%BC%9F"><span class="toc-text">我能安装 Windows 系统吗？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%91%E9%9C%80%E8%A6%81%E5%AE%89%E8%A3%85%E5%85%B6%E4%BB%96%E4%BB%80%E4%B9%88%E8%BD%AF%E4%BB%B6%E5%90%97%EF%BC%9F"><span class="toc-text">我需要安装其他什么软件吗？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">获取当前设置</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">修改设置</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">鼠标滚动方向 相反 FlipFlopWheel 1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">鼠标滚动方向 自然滚动 FlipFlopWheel 0</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9-NTFS-%E9%A9%B1%E5%8A%A8%E7%A8%8B%E5%BA%8F"><span class="toc-text">如何选择 NTFS 驱动程序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-2-%E8%B0%83%E8%AF%95"><span class="toc-text">12.2 调试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-3-%E6%8A%80%E5%B7%A7%E5%92%8C%E7%AA%8D%E9%97%A8"><span class="toc-text">12.3 技巧和窍门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%95%8A%E5%91%80%E5%91%80%E5%91%80%E6%88%91%E7%B3%BB%E7%BB%9F%E6%B2%A1%E6%B3%95%E5%90%AF%E5%8A%A8%E4%BA%86%E6%88%91%E8%AF%A5%E6%80%8E%E4%B9%88%E7%9C%8B%E6%97%A5%E5%BF%97%E5%95%8A%EF%BC%9F"><span class="toc-text">1. 啊呀呀呀我系统没法启动了我该怎么看日志啊？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%A6%82%E4%BD%95%E8%87%AA%E5%AE%9A%E4%B9%89%E5%90%AF%E5%8A%A8%E9%A1%B9%EF%BC%9F"><span class="toc-text">2. 如何自定义启动项？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E9%BB%98%E8%AE%A4%E5%90%AF%E5%8A%A8%E7%9A%84%E7%B3%BB%E7%BB%9F%EF%BC%9F"><span class="toc-text">3. 如何选择默认启动的系统？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%AE%89%E8%A3%85-macOS-%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E6%96%B9%E6%B3%95%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">4. 安装 macOS 最简单的方法是什么？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E4%B8%BA%E4%BB%80%E4%B9%88%E6%97%A0%E6%B3%95%E5%8A%A0%E8%BD%BD-Recovery-%E6%81%A2%E5%A4%8D%E9%95%9C%E5%83%8F-%E8%BF%9B%E8%A1%8C%E5%9C%A8%E7%BA%BF%E5%AE%89%E8%A3%85%EF%BC%9F"><span class="toc-text">5. 为什么无法加载 Recovery 恢复镜像 进行在线安装？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E6%88%91%E5%8F%AF%E4%BB%A5%E5%9C%A8-Apple-%E7%9A%84%E7%A1%AC%E4%BB%B6%E3%80%81%E6%88%96%E8%99%9A%E6%8B%9F%E6%9C%BA%E4%B8%AD%E4%BD%BF%E7%94%A8-OpenCore-%E5%90%97%EF%BC%9F"><span class="toc-text">6. 我可以在 Apple 的硬件、或虚拟机中使用 OpenCore 吗？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E4%B8%BA%E4%BB%80%E4%B9%88-Find-%E5%92%8C-Replace-%E7%9A%84%E8%A1%A5%E4%B8%81%E7%9A%84%E9%95%BF%E5%BA%A6%E5%BF%85%E9%A1%BB%E7%9B%B8%E7%AD%89%EF%BC%9F"><span class="toc-text">7. 为什么 Find 和 Replace 的补丁的长度必须相等？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E6%88%91%E5%BA%94%E8%AF%A5%E5%A6%82%E4%BD%95%E5%86%B3%E5%AE%9A%E5%93%AA%E4%BA%9B-Booter-Quirk-%E9%9C%80%E8%A6%81%E8%A2%AB%E5%90%AF%E7%94%A8%EF%BC%9F"><span class="toc-text">8. 我应该如何决定哪些 Booter Quirk 需要被启用？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">附录 1. OpenCore 兼容 Kext 列表</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E7%BA%BF%E7%BD%91%E5%8D%A1"><span class="toc-text">有线网卡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Wi-Fi-%E5%92%8C%E8%93%9D%E7%89%99"><span class="toc-text">Wi-Fi 和蓝牙</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%AE%E7%9B%98%E3%80%81%E9%BC%A0%E6%A0%87%E5%92%8C%E8%A7%A6%E6%91%B8%E8%AE%BE%E5%A4%87"><span class="toc-text">键盘、鼠标和触摸设备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9F%B3%E9%A2%91%E5%92%8C%E8%A7%86%E9%A2%91"><span class="toc-text">音频和视频</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CPU-%E5%92%8C-SMC"><span class="toc-text">CPU 和 SMC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#USB-and-other-ports"><span class="toc-text">USB and other ports</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Other-kexts"><span class="toc-text">Other kexts</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/hexo/" title="hexo+蝴蝶主题美化记录"><img data-lazy-src="https://cdn.jsdelivr.net/gh/xiaobaisky/2020cdn@master/imgs/wusha.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="hexo+蝴蝶主题美化记录"/></a><div class="content"><a class="title" href="/hexo/" title="hexo+蝴蝶主题美化记录">hexo+蝴蝶主题美化记录</a><time datetime="2021-03-15T06:24:02.359Z" title="发表于 2021-03-15 06:24:02">2021-03-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/nkbyr9/" title="如何在两台路由器之间进行无线桥接？"><img data-lazy-src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="如何在两台路由器之间进行无线桥接？"/></a><div class="content"><a class="title" href="/nkbyr9/" title="如何在两台路由器之间进行无线桥接？">如何在两台路由器之间进行无线桥接？</a><time datetime="2021-01-01T01:31:05.000Z" title="发表于 2021-01-01 01:31:05">2021-01-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/yow2hd/" title="今日学习到的几个office小技巧"><img data-lazy-src="https://cdn.jsdelivr.net/gh/xiaobaisky/2020cdn@master/imgs/archive.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="今日学习到的几个office小技巧"/></a><div class="content"><a class="title" href="/yow2hd/" title="今日学习到的几个office小技巧">今日学习到的几个office小技巧</a><time datetime="2020-12-15T20:00:00.000Z" title="发表于 2020-12-15 20:00:00">2020-12-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/ebya24/" title="Deepin20安装Python3.9.0"><img data-lazy-src="https://cdn.jsdelivr.net/gh/xiaobaisky/2020cdn@master/imgs/python 0.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Deepin20安装Python3.9.0"/></a><div class="content"><a class="title" href="/ebya24/" title="Deepin20安装Python3.9.0">Deepin20安装Python3.9.0</a><time datetime="2020-12-06T04:54:43.000Z" title="发表于 2020-12-06 04:54:43">2020-12-06</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By haisky</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><p><a style="margin-inline:5px" target="_blank" href="https://hexo.io/"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="博客框架为Hexo"></a><a style="margin-inline:5px" target="_blank" href="https://butterfly.js.org/"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="主题采用butterfly"></a><a style="margin-inline:5px" target="_blank" href="https://www.jsdelivr.com/"><img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&logo=jsDelivr" title="本站使用JsDelivr为静态资源提供CDN加速"></a><a style="margin-inline:5px" target="_blank" href="https://vercel.com/ "><img src="https://img.shields.io/badge/Hosted-Vercel-brightgreen?style=flat&logo=Vercel" title="本站采用双线部署，默认线路托管于Vercel"></a><a style="margin-inline:5px" target="_blank" href="https://github.com/"><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="本站项目由Gtihub托管"></a><a style="margin-inline:5px" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"></a></p></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script><script defer src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script defer src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadWaline () {
  function initWaline () {
    let initData = {
      el: '#waline-wrap',
      serverURL: 'https://haisky.vercel.app/',
      avatar: 'wavatar',
      path: location.pathname,
      emojiCDN: '',
      emojiMaps: "",
    }
    
    if (false) {
      const otherData = false
      initData = Object.assign(initData, otherData)
    }
    
    const waline = new Waline(initData)
  }

  if (typeof Waline === 'function') initWaline() 
  else getScript('https://cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js').then(initWaline)
}

if ('Waline' === 'Waline' || !true) {
  if (true) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
  else setTimeout(loadWaline, 0)
} else {
  function loadOtherComment () {
    loadWaline()
  }
}</script></div><script defer src="https://cdn.jsdelivr.net/npm/hexo-theme-volantis@latest/source/js/issues.min.js"></script><div class="aplayer no-destroy" data-id="000PeZCQ1i4XVs" data-server="tencent" data-type="artist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="true" muted></div><script defer src="https://cdn.jsdelivr.net/gh/xiaobaisky/live2d-widget/autoload.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="true" data-text="I,LOVE,YOU" data-fontsize="25px" data-random="false" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><div class="app-refresh" id="app-refresh" style="position: fixed;top: -2.2rem;left: 0;right: 0;z-index: 99999;padding: 0 1rem;font-size: 15px;height: 2.2rem;transition: all 0.3s ease;"><div class="app-refresh-wrap" style=" display: flex;color: #fff;height: 100%;align-items: center;justify-content: center;"><label>✨ haisky上新啦！ 👉</label><a href="javascript:void(0)" onclick="location.reload()"><span style="color: #fff;text-decoration: underline;cursor: pointer;">🍭尝尝新品🍬</span></a></div></div><script>if ('serviceWorker' in navigator) {
if (navigator.serviceWorker.controller) {
navigator.serviceWorker.addEventListener('controllerchange', function() {
showNotification()
})
}
window.addEventListener('load', function() {
navigator.serviceWorker.register('/sw.js')
})
}
function showNotification() {
if (GLOBAL_CONFIG.Snackbar) {
var snackbarBg =
document.documentElement.getAttribute('data-theme') === 'light' ?
GLOBAL_CONFIG.Snackbar.bgLight :
GLOBAL_CONFIG.Snackbar.bgDark
var snackbarPos = GLOBAL_CONFIG.Snackbar.position
Snackbar.show({
text: '✨ haisky上新啦！ 👉',
backgroundColor: snackbarBg,
duration: 500000,
pos: snackbarPos,
actionText: '🍭品尝新品🍬',
actionTextColor: '#fff',
onActionClick: function(e) {
location.reload()
},
})
} else {
var showBg =
document.documentElement.getAttribute('data-theme') === 'light' ?
'#49b1f5' :
'#1f1f1f'
var cssText = `top: 0; background: ${showBg};`
document.getElementById('app-refresh').style.cssText = cssText
}
}</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start -->
  <script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.21/hexo_githubcalendar.js"></script>
  <script data-pjax>
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://python-github-calendar-api.vercel.app/api?xiaobaisky";
            var git_color =['#ebedf0', '#fdcdec', '#fc9bd9', '#fa6ac5', '#f838b2', '#f5089f', '#c4067e', '#92055e', '#540336', '#48022f', '#30021f'];
            var git_user ="xiaobaisky";
            var parent_div_git = document.getElementById('recent-posts');
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/'){
                console.log('已挂载github calendar')
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // 有报错，但不影响使用(支持pjax跳转)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementById('recent-posts')){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:280px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style></style><!-- hexo injector body_end end --><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>